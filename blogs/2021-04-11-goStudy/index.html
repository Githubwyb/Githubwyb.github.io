<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-diy.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-diy.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-diy.png"><link rel="mask-icon" href="/images/logo-diy.svg" color="#222"><meta name="baidu-site-verification" content="y1cfESbTt9nd3LsA"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/lib/pace/pace-theme-flash.min.css"><script src="/lib/pace/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"githubwyb.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!0,color:"#ff0000",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="一、前言此篇主要讲解go的通用语法和一些linux专属操作，windows专属操作可以看 go for windows 1. 环境12&#x3D;&gt; go versiongo version go1.16.4 linux&#x2F;amd64  2. 安装gvm版本管理工具2.1. 安装12wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;moovweb&#x2F;gvm&#x2F;master&#x2F;bin"><meta property="og:type" content="article"><meta property="og:title" content="go语言学习"><meta property="og:url" content="https://githubwyb.github.io/blogs/2021-04-11-goStudy/index.html"><meta property="og:site_name" content="技术的路上奔跑"><meta property="og:description" content="一、前言此篇主要讲解go的通用语法和一些linux专属操作，windows专属操作可以看 go for windows 1. 环境12&#x3D;&gt; go versiongo version go1.16.4 linux&#x2F;amd64  2. 安装gvm版本管理工具2.1. 安装12wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;moovweb&#x2F;gvm&#x2F;master&#x2F;bin"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://githubwyb.github.io/blogs/2021-04-11-goStudy/2022-02-18-01.jpg"><meta property="og:image" content="https://githubwyb.github.io/blogs/2021-04-11-goStudy/2022-04-02-02.jpg"><meta property="og:image" content="https://githubwyb.github.io/2023-06-16-01.png"><meta property="article:published_time" content="2021-04-10T18:06:33.000Z"><meta property="article:modified_time" content="2024-05-09T09:25:34.000Z"><meta property="article:author" content="王钰博"><meta property="article:tag" content="go"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://githubwyb.github.io/blogs/2021-04-11-goStudy/2022-02-18-01.jpg"><link rel="canonical" href="https://githubwyb.github.io/blogs/2021-04-11-goStudy/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>go语言学习 | 技术的路上奔跑</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">技术的路上奔跑</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">入门</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-fw fa-sitemap"></i>站点地图</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/Githubwyb" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://githubwyb.github.io/blogs/2021-04-11-goStudy/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/12.jpg"><meta itemprop="name" content="王钰博"><meta itemprop="description" content="个人博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="技术的路上奔跑"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">go语言学习</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-04-11 02:06:33" itemprop="dateCreated datePublished" datetime="2021-04-11T02:06:33+08:00">2021-04-11</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-05-09 17:25:34" itemprop="dateModified" datetime="2024-05-09T17:25:34+08:00">2024-05-09</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Program/" itemprop="url" rel="index"><span itemprop="name">Program</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Program/Web/" itemprop="url" rel="index"><span itemprop="name">Web</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/blogs/2021-04-11-goStudy/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/blogs/2021-04-11-goStudy/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>88k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>1:20</span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h1><p>此篇主要讲解go的通用语法和一些linux专属操作，windows专属操作可以看 <a href="/blogs/2023-06-05-go-for-windows">go for windows</a></p><h2 id="1-环境"><a href="#1-环境" class="headerlink" title="1. 环境"></a>1. 环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">=&gt; go version</span><br><span class="line">go version go1.16.4 linux/amd64</span><br></pre></td></tr></table></figure><h2 id="2-安装gvm版本管理工具"><a href="#2-安装gvm版本管理工具" class="headerlink" title="2. 安装gvm版本管理工具"></a>2. 安装gvm版本管理工具</h2><h3 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1. 安装"></a>2.1. 安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/moovweb/gvm/master/binscripts/gvm-installer</span><br><span class="line">bash gvm-installer</span><br></pre></td></tr></table></figure><ul><li>默认生效到<code>~/.bashrc</code>，生效到zsh需要将下面一句话加到<code>.zshrc</code>最后</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[ -s &quot;/home/test/.gvm/scripts/gvm&quot; ]] &amp;&amp; source &quot;/home/test/.gvm/scripts/gvm&quot;</span><br></pre></td></tr></table></figure><h3 id="2-2-使用"><a href="#2-2-使用" class="headerlink" title="2.2. 使用"></a>2.2. 使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看可安装的版本</span></span><br><span class="line">gvm listall</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前版本</span></span><br><span class="line">gvm list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装一个版本</span></span><br><span class="line">gvm install go1.18.3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用一个版本，回归默认就是 gvm use system</span></span><br><span class="line">gvm use go1.18.3</span><br></pre></td></tr></table></figure><h1 id="二、语法相关"><a href="#二、语法相关" class="headerlink" title="二、语法相关"></a>二、语法相关</h1><h2 id="1-基本类型"><a href="#1-基本类型" class="headerlink" title="1. 基本类型"></a>1. 基本类型</h2><h3 id="1-1-去除变量未定义提示"><a href="#1-1-去除变量未定义提示" class="headerlink" title="1.1. 去除变量未定义提示"></a>1.1. 去除变量未定义提示</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_ = varA</span><br></pre></td></tr></table></figure><h4 id="1-2-int"><a href="#1-2-int" class="headerlink" title="1.2. int"></a>1.2. int</h4><h5 id="1-大小"><a href="#1-大小" class="headerlink" title="1) 大小"></a>1) 大小</h5><ul><li>32位下int为4个字节，64位下int为8个字节</li></ul><h5 id="2-类型转换"><a href="#2-类型转换" class="headerlink" title="2) 类型转换"></a>2) 类型转换</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转string</span></span><br><span class="line">fmt.Sprint(<span class="number">123</span>)</span><br></pre></td></tr></table></figure><h3 id="1-2-类型转换"><a href="#1-2-类型转换" class="headerlink" title="1.2. 类型转换"></a>1.2. 类型转换</h3><h4 id="float32-float64"><a href="#float32-float64" class="headerlink" title="float32 float64"></a>float32 float64</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转int</span></span><br><span class="line"><span class="keyword">var</span> f <span class="type">float32</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> a <span class="type">int</span> = <span class="type">int</span>(f)</span><br></pre></td></tr></table></figure><h4 id="byte"><a href="#byte" class="headerlink" title="[]byte"></a>[]byte</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转string</span></span><br><span class="line">data := []<span class="type">byte</span>(<span class="string">&quot;aaa&quot;</span>)</span><br><span class="line">str := <span class="type">string</span>(data)</span><br></pre></td></tr></table></figure><h4 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h4><p><strong>类型判断</strong></p><p>类型断言</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok = f.(<span class="type">string</span>); !ok &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;f type is not string&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>switch类型判断</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> f <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> f := f.(<span class="keyword">type</span>) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="type">string</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;f type is string&quot;</span>)</span><br><span class="line">	f = <span class="string">&quot;xxx&quot;</span>	<span class="comment">// 这里的f为string类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;f type is int&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">	fmt.Println(<span class="string">&quot;f type is unknown&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-string"><a href="#1-2-string" class="headerlink" title="1.2. string"></a>1.2. string</h3><h4 id="1-转换"><a href="#1-转换" class="headerlink" title="1) 转换"></a>1) 转换</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 转[]byte</span></span><br><span class="line"><span class="keyword">var</span> jsonStr <span class="type">string</span></span><br><span class="line">jsonByte := []<span class="type">byte</span>(jsonStr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转byte</span></span><br><span class="line">testByte := jsonStr[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转uint64</span></span><br><span class="line"><span class="comment">// The bitSize argument specifies the integer type</span></span><br><span class="line"><span class="comment">// that the result must fit into. Bit sizes 0, 8, 16, 32, and 64</span></span><br><span class="line"><span class="comment">// correspond to uint, uint8, uint16, uint32, and uint64.</span></span><br><span class="line"><span class="keyword">var</span> num <span class="type">uint64</span></span><br><span class="line">num, err := strconv.ParseUint(<span class="string">&quot;1234&quot;</span>, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转int64</span></span><br><span class="line"><span class="comment">// The bitSize argument specifies the integer type</span></span><br><span class="line"><span class="comment">// that the result must fit into. Bit sizes 0, 8, 16, 32, and 64</span></span><br><span class="line"><span class="comment">// correspond to int, int8, int16, int32, and int64.</span></span><br><span class="line"><span class="keyword">var</span> num <span class="type">uint64</span></span><br><span class="line">num, err := strconv.ParseInt(<span class="string">&quot;1234&quot;</span>, <span class="number">10</span>, <span class="number">64</span>)</span><br></pre></td></tr></table></figure><h4 id="2-单引号，双引号，反引号的区别"><a href="#2-单引号，双引号，反引号的区别" class="headerlink" title="2) 单引号，双引号，反引号的区别"></a>2) 单引号，双引号，反引号的区别</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;%c %d\n&quot;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>)	<span class="comment">// 单引号代表byte</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;a\n&quot;</span>)				<span class="comment">// 双引号可以输入转义字符</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;%s\n&quot;</span>, <span class="string">`a\n`</span>)		<span class="comment">// 反引号会忽略转义</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a 97</span><br><span class="line">a</span><br><span class="line">a\n</span><br></pre></td></tr></table></figure><h4 id="2-字符串截取"><a href="#2-字符串截取" class="headerlink" title="2) 字符串截取"></a>2) 字符串截取</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">outStr := <span class="string">&quot;abcdefg&quot;</span></span><br><span class="line">fmt.Println(outStr[<span class="number">0</span>])		<span class="comment">// 97，被识别成byte打印了</span></span><br><span class="line">fmt.Println(outStr[:<span class="number">3</span>])		<span class="comment">// abc</span></span><br><span class="line">fmt.Println(outStr[<span class="number">3</span>:<span class="number">5</span>])	<span class="comment">// de</span></span><br><span class="line">fmt.Println(outStr[<span class="number">5</span>:])		<span class="comment">// fg</span></span><br><span class="line"></span><br><span class="line">fmt.Println(outStr[:<span class="number">-2</span>])	<span class="comment">// 不支持，索引仅支持正数</span></span><br></pre></td></tr></table></figure><h4 id="3-遍历"><a href="#3-遍历" class="headerlink" title="3) 遍历"></a>3) 遍历</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">s := <span class="string">&quot;abc&quot;</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span>(s) &#123;</span><br><span class="line">	fmt.Println(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 输出</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, v := <span class="keyword">range</span>(s) &#123;</span><br><span class="line">	fmt.Println(i, <span class="type">byte</span>(v))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 输出</span></span><br><span class="line"><span class="comment">0 a</span></span><br><span class="line"><span class="comment">1 b</span></span><br><span class="line"><span class="comment">2 c</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="4-修改"><a href="#4-修改" class="headerlink" title="4) 修改"></a>4) 修改</h4><ul><li>string类型里面的元素是不可变的，除非赋值一个新的string</li><li>如果想要修改string中某一个元素，相当于拷贝了两次</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="string">&quot;abc&quot;</span></span><br><span class="line">tmp := []<span class="type">byte</span>(a)	<span class="comment">// 做了一次拷贝</span></span><br><span class="line">tmp[<span class="number">0</span>] = <span class="string">&#x27;z&#x27;</span></span><br><span class="line">fmt.Println(a)		<span class="comment">// abc</span></span><br><span class="line">a = <span class="type">string</span>(tmp)		<span class="comment">// 又拷贝了一次</span></span><br><span class="line">fmt.Println(a)		<span class="comment">// zbc</span></span><br></pre></td></tr></table></figure><h2 id="2-map"><a href="#2-map" class="headerlink" title="2. map"></a>2. map</h2><ul><li>底层使用哈希map实现而非红黑树</li></ul><h3 id="2-1-一些基本操作"><a href="#2-1-一些基本操作" class="headerlink" title="2.1. 一些基本操作"></a>2.1. 一些基本操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** map初始化 ******/</span></span><br><span class="line">xxxMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">check := <span class="keyword">map</span>[<span class="type">byte</span>]<span class="type">byte</span>&#123;</span><br><span class="line">	<span class="string">&#x27;)&#x27;</span>: <span class="string">&#x27;(&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;[&#x27;</span>: <span class="string">&#x27;]&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;&#123;&#x27;</span>: <span class="string">&#x27;&#125;&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 判断map是否存在key ******/</span></span><br><span class="line"><span class="keyword">if</span> _, ok := xxxMap[key]; ok &#123;</span><br><span class="line">    <span class="comment">// 存在key</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 遍历map ******/</span></span><br><span class="line"><span class="comment">// key, value</span></span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> xxxMap &#123;</span><br><span class="line">    <span class="comment">// 操作map</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只要key</span></span><br><span class="line"><span class="keyword">for</span> key := <span class="keyword">range</span> xxxMap &#123;</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-map取不存在的值"><a href="#2-2-map取不存在的值" class="headerlink" title="2.2. map取不存在的值"></a>2.2. map取不存在的值</h3><ul><li>对map取值可以获取一个返回值也可以获取两个返回值用于判断是否存在</li><li>如果不存在采用一个返回值会返回对应value的类型的默认值</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	boolMap := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">bool</span>&#123;&#125;</span><br><span class="line">	intMap := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>&#123;&#125;</span><br><span class="line">	stringMap := <span class="keyword">map</span>[<span class="type">int</span>]<span class="type">string</span>&#123;&#125;</span><br><span class="line">	sliceMap := <span class="keyword">map</span>[<span class="type">int</span>][]<span class="type">int</span>&#123;&#125;</span><br><span class="line">	mapMap := <span class="keyword">map</span>[<span class="type">int</span>]<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">int</span>&#123;&#125;</span><br><span class="line">	interfaceMap := <span class="keyword">map</span>[<span class="type">int</span>]<span class="keyword">interface</span>&#123;&#125;&#123;&#125;</span><br><span class="line">	fmt.Println(boolMap[<span class="number">1</span>])                      <span class="comment">// false</span></span><br><span class="line">	fmt.Println(intMap[<span class="number">1</span>])                       <span class="comment">// 0</span></span><br><span class="line">	fmt.Println(stringMap[<span class="number">1</span>])                    <span class="comment">//</span></span><br><span class="line">	fmt.Println(sliceMap[<span class="number">1</span>], sliceMap[<span class="number">1</span>] == <span class="literal">nil</span>) <span class="comment">// [] true</span></span><br><span class="line">	fmt.Println(mapMap[<span class="number">1</span>], mapMap[<span class="number">1</span>] == <span class="literal">nil</span>)     <span class="comment">// map[] true</span></span><br><span class="line">	fmt.Println(interfaceMap[<span class="number">1</span>])                 <span class="comment">// &lt;nil&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-底层实现"><a href="#2-3-底层实现" class="headerlink" title="2.3. 底层实现"></a>2.3. 底层实现</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /usr/lib/go/src/cmd/compile/internal/types/type.go</span></span><br><span class="line"><span class="comment">// Map contains Type fields specific to maps.</span></span><br><span class="line"><span class="keyword">type</span> Map <span class="keyword">struct</span> &#123;</span><br><span class="line">	Key  *Type <span class="comment">// Key type</span></span><br><span class="line">	Elem *Type <span class="comment">// Val (elem) type</span></span><br><span class="line"></span><br><span class="line">	Bucket *Type <span class="comment">// internal struct type representing a hash bucket</span></span><br><span class="line">	Hmap   *Type <span class="comment">// internal struct type representing the Hmap (map header object)</span></span><br><span class="line">	Hiter  *Type <span class="comment">// internal struct type representing hash iterator state</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/lib/go/src/runtime/map.go</span></span><br><span class="line"><span class="comment">// A header for a Go map.</span></span><br><span class="line"><span class="keyword">type</span> hmap <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Note: the format of the hmap is also encoded in cmd/compile/internal/reflectdata/reflect.go.</span></span><br><span class="line">	<span class="comment">// Make sure this stays in sync with the compiler&#x27;s definition.</span></span><br><span class="line">	count     <span class="type">int</span> <span class="comment">// # live cells == size of map.  Must be first (used by len() builtin)</span></span><br><span class="line">	flags     <span class="type">uint8</span></span><br><span class="line">	B         <span class="type">uint8</span>  <span class="comment">// log_2 of # of buckets (can hold up to loadFactor * 2^B items)</span></span><br><span class="line">	noverflow <span class="type">uint16</span> <span class="comment">// approximate number of overflow buckets; see incrnoverflow for details</span></span><br><span class="line">	hash0     <span class="type">uint32</span> <span class="comment">// hash seed</span></span><br><span class="line"></span><br><span class="line">	buckets    unsafe.Pointer <span class="comment">// array of 2^B Buckets. may be nil if count==0.</span></span><br><span class="line">	oldbuckets unsafe.Pointer <span class="comment">// previous bucket array of half the size, non-nil only when growing</span></span><br><span class="line">	nevacuate  <span class="type">uintptr</span>        <span class="comment">// progress counter for evacuation (buckets less than this have been evacuated)</span></span><br><span class="line"></span><br><span class="line">	extra *mapextra <span class="comment">// optional fields</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/lib/go/src/cmd/compile/internal/types/type.go</span></span><br><span class="line"><span class="comment">// NewMap returns a new map Type with key type k and element (aka value) type v.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMap</span><span class="params">(k, v *Type)</span></span> *Type &#123;</span><br><span class="line">	t := newType(TMAP)</span><br><span class="line">	mt := t.MapType()</span><br><span class="line">	mt.Key = k</span><br><span class="line">	mt.Elem = v</span><br><span class="line">	<span class="keyword">if</span> k.HasTParam() || v.HasTParam() &#123;</span><br><span class="line">		t.SetHasTParam(<span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> k.HasShape() || v.HasShape() &#123;</span><br><span class="line">		t.SetHasShape(<span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/lib/go/src/cmd/compile/internal/types/type.go</span></span><br><span class="line"><span class="comment">// New returns a new Type of the specified kind.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newType</span><span class="params">(et Kind)</span></span> *Type &#123;</span><br><span class="line">	t := &amp;Type&#123;</span><br><span class="line">		kind:  et,</span><br><span class="line">		width: BADWIDTH,</span><br><span class="line">	&#125;</span><br><span class="line">	t.underlying = t</span><br><span class="line">	<span class="comment">// TODO(josharian): lazily initialize some of these?</span></span><br><span class="line">	<span class="keyword">switch</span> t.kind &#123;</span><br><span class="line">	<span class="keyword">case</span> TMAP:</span><br><span class="line">		t.extra = <span class="built_in">new</span>(Map)</span><br><span class="line">    ...</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li><code>var xxx map[string]interface&#123;&#125;</code>定义的xxx是一个空指针，没有指向任何地址，不能进行赋值</li><li>初始化map需要使用make</li></ul><h2 id="3-array"><a href="#3-array" class="headerlink" title="3. array"></a>3. array</h2><h3 id="3-1-一些基本操作"><a href="#3-1-一些基本操作" class="headerlink" title="3.1. 一些基本操作"></a>3.1. 一些基本操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** array初始化 ******/</span></span><br><span class="line">arr0 := [...]<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line">arr1 := [...]<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 遍历 ******/</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> arr0 &#123;</span><br><span class="line">	fmt.Println(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-流程控制语句"><a href="#5-流程控制语句" class="headerlink" title="5. 流程控制语句"></a>5. 流程控制语句</h2><h3 id="5-1-for-循环"><a href="#5-1-for-循环" class="headerlink" title="5.1. for 循环"></a>5.1. for 循环</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 死循环</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// for i 形式</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(a); i++ &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span>(arr) &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// do while</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">if</span> expression &#123;</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// while</span></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> expression &#123;</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-switch"><a href="#5-2-switch" class="headerlink" title="5.2. switch"></a>5.2. switch</h3><ul><li>case多条件写成逗号形式，c那样的写法不适用</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> v.key &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;Maker&quot;</span>:</span><br><span class="line">	...</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;OS&quot;</span>:</span><br><span class="line">	...</span><br><span class="line"><span class="comment">// 多条件判断</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;linuxOS&quot;</span>, <span class="string">&quot;linuxKernel&quot;</span>, <span class="string">&quot;linuxArch&quot;</span>:</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-函数"><a href="#6-函数" class="headerlink" title="6. 函数"></a>6. 函数</h2><h3 id="6-1-定义和返回值"><a href="#6-1-定义和返回值" class="headerlink" title="6.1. 定义和返回值"></a>6.1. 定义和返回值</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 正常定义</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 多返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a <span class="type">int</span>)</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> a+<span class="number">1</span>, a<span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// nil 返回初始化定义，仅对slice和map生效</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a <span class="type">int</span>)</span></span> []<span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>	<span class="comment">// 相当于return []int&#123;&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回值提前声明</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(a <span class="type">int</span>)</span></span> (result <span class="type">int</span>) &#123;</span><br><span class="line">	result = a + <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-值传递"><a href="#6-2-值传递" class="headerlink" title="6.2. 值传递"></a>6.2. 值传递</h3><h4 id="1-go函数都是值传递"><a href="#1-go函数都是值传递" class="headerlink" title="(1) go函数都是值传递"></a>(1) go函数都是值传递</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">changeDatas</span><span class="params">(intData <span class="type">int</span>, strData <span class="type">string</span>, arrData [3]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	intData += <span class="number">2</span></span><br><span class="line">	strData += <span class="string">&quot;bbb&quot;</span></span><br><span class="line">	arrData[<span class="number">0</span>] = <span class="number">999</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	intData := <span class="number">1</span></span><br><span class="line">	strData := <span class="string">&quot;aaa&quot;</span></span><br><span class="line">	arrData := [...]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	fmt.Println(intData, strData, arrData)</span><br><span class="line">	changeDatas(intData, strData, arrData)</span><br><span class="line">	fmt.Println(intData, strData, arrData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 aaa [1 2 3]</span><br><span class="line">1 aaa [1 2 3]</span><br></pre></td></tr></table></figure><h4 id="2-slice、map、channel类型的看似引用传递的解释"><a href="#2-slice、map、channel类型的看似引用传递的解释" class="headerlink" title="(2) slice、map、channel类型的看似引用传递的解释"></a>(2) slice、map、channel类型的看似引用传递的解释</h4><h5 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h5><ul><li>slice本质是一个结构体，内部包含三要素：长度、容量、数据首地址</li><li>所以传递的也是这三个值，数据内容改变改的是地址里面的内容，外部可见，但是改了长度和容量，外部就不会变</li></ul><img src="2022-02-18-01.jpg"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">changeDatas</span><span class="params">(sliceData []<span class="type">int</span>, mapData <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	sliceData[<span class="number">0</span>] = <span class="number">999</span></span><br><span class="line">	mapData[<span class="string">&quot;test&quot;</span>] = <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sliceData := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">	mapData := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">	fmt.Println(sliceData, mapData)</span><br><span class="line">	changeDatas(sliceData, mapData)</span><br><span class="line">	fmt.Println(sliceData, mapData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[1 2 3] map[]</span><br><span class="line">[999 2 3] map[test:123]</span><br></pre></td></tr></table></figure><h5 id="map和channel都是指针"><a href="#map和channel都是指针" class="headerlink" title="map和channel都是指针"></a>map和channel都是指针</h5><ul><li>本质上map和channel都是指针，所以改动外部都可见</li></ul><h2 id="7-组合赋值"><a href="#7-组合赋值" class="headerlink" title="7. 组合赋值"></a>7. 组合赋值</h2><ul><li>组合赋值会先将值取出再赋值给前面的变量，所以go不需要swap方法</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a, b := <span class="number">1</span>+<span class="number">1</span>, <span class="number">2</span>+<span class="number">2</span></span><br><span class="line"><span class="comment">// 交换两个元素的值</span></span><br><span class="line">a, b = b, a</span><br></pre></td></tr></table></figure><h2 id="8-i-、i–"><a href="#8-i-、i–" class="headerlink" title="8. i++、i–"></a>8. i++、i–</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i++		<span class="comment">// 理解成 i+=1</span></span><br><span class="line">j=i++	<span class="comment">// error，i++是i+=1，是语句，非表达式，不能赋值</span></span><br><span class="line">++i		<span class="comment">// error，不存在++i</span></span><br></pre></td></tr></table></figure><h2 id="9-const-iota"><a href="#9-const-iota" class="headerlink" title="9. const &amp; iota"></a>9. const &amp; iota</h2><h3 id="9-1-itoa"><a href="#9-1-itoa" class="headerlink" title="9.1. itoa"></a>9.1. itoa</h3><p>参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/aad37a6c81a2">golang const 内itoa 用法详解及优劣分析</a></p><h4 id="1-每次-const-出现时，都会让-iota-初始化为0"><a href="#1-每次-const-出现时，都会让-iota-初始化为0" class="headerlink" title="(1) 每次 const 出现时，都会让 iota 初始化为0"></a>(1) 每次 const 出现时，都会让 iota 初始化为0</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="literal">iota</span> <span class="comment">// a = 0</span></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">  b = <span class="literal">iota</span>     <span class="comment">// b = 0</span></span><br><span class="line">  c            <span class="comment">// c = 1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="2-自定义类型"><a href="#2-自定义类型" class="headerlink" title="(2) 自定义类型"></a>(2) 自定义类型</h4><p>自增长常量经常包含一个自定义枚举类型，允许你依靠编译器完成自增设置。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Newtype <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    T1 Newtype = <span class="literal">iota</span> <span class="comment">// 0</span></span><br><span class="line">    T2                <span class="comment">// 1</span></span><br><span class="line">    T3                <span class="comment">// 2</span></span><br><span class="line">    T4                <span class="comment">// 3</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="3-可跳过的值"><a href="#3-可跳过的值" class="headerlink" title="(3) 可跳过的值"></a>(3) 可跳过的值</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AudioOutput <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    OutMute AudioOutput = <span class="literal">iota</span> <span class="comment">// 0</span></span><br><span class="line">    OutMono                    <span class="comment">// 1</span></span><br><span class="line">    OutStereo                  <span class="comment">// 2</span></span><br><span class="line">    _</span><br><span class="line">    _</span><br><span class="line">    OutSurround                <span class="comment">// 5</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="4-位掩码表达式"><a href="#4-位掩码表达式" class="headerlink" title="(4) 位掩码表达式"></a>(4) 位掩码表达式</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Allergen <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    IgEggs Allergen = <span class="number">1</span> &lt;&lt; <span class="literal">iota</span> <span class="comment">// 1 &lt;&lt; 0 which is 00000001</span></span><br><span class="line">    IgChocolate                         <span class="comment">// 1 &lt;&lt; 1 which is 00000010</span></span><br><span class="line">    IgNuts                              <span class="comment">// 1 &lt;&lt; 2 which is 00000100</span></span><br><span class="line">    IgStrawberries                      <span class="comment">// 1 &lt;&lt; 3 which is 00001000</span></span><br><span class="line">    IgShellfish                         <span class="comment">// 1 &lt;&lt; 4 which is 00010000</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="5-定义数量级"><a href="#5-定义数量级" class="headerlink" title="(5) 定义数量级"></a>(5) 定义数量级</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ByteSize <span class="type">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    _           = <span class="literal">iota</span>                   <span class="comment">// ignore first value by assigning to blank identifier</span></span><br><span class="line">    KB ByteSize = <span class="number">1</span> &lt;&lt; (<span class="number">10</span> * <span class="literal">iota</span>)       <span class="comment">// 1 &lt;&lt; (10*1)</span></span><br><span class="line">    MB                                   <span class="comment">// 1 &lt;&lt; (10*2)</span></span><br><span class="line">    GB                                   <span class="comment">// 1 &lt;&lt; (10*3)</span></span><br><span class="line">    TB                                   <span class="comment">// 1 &lt;&lt; (10*4)</span></span><br><span class="line">    PB                                   <span class="comment">// 1 &lt;&lt; (10*5)</span></span><br><span class="line">    EB                                   <span class="comment">// 1 &lt;&lt; (10*6)</span></span><br><span class="line">    ZB                                   <span class="comment">// 1 &lt;&lt; (10*7)</span></span><br><span class="line">    YB                                   <span class="comment">// 1 &lt;&lt; (10*8)</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="6-定义在一行的情况"><a href="#6-定义在一行的情况" class="headerlink" title="(6) 定义在一行的情况"></a>(6) 定义在一行的情况</h4><ul><li>跟普通形式 没什么不同</li><li>iota 在下一行增长，而不是立即取得它的引用。</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	Apple, Banana     = <span class="literal">iota</span> + <span class="number">1</span>, <span class="literal">iota</span> + <span class="number">2</span> <span class="comment">// 0+1, 0+2</span></span><br><span class="line">	Cherimoya, Durian                      <span class="comment">// 1+1, 1+2</span></span><br><span class="line">	Elderberry, Fig                        <span class="comment">// 2+1, 2+2</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1, 2</span></span><br><span class="line"><span class="comment">2, 3</span></span><br><span class="line"><span class="comment">3, 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="7-中间插队"><a href="#7-中间插队" class="headerlink" title="(7) 中间插队"></a>(7) 中间插队</h4><p>中间插队时，iota 会被覆盖掉 不再继续自增。但是用另一个 iota 接一下，又会继续自增。<br>示例如下，中间插入了5、3和6，3下面有itoa接，6没有。</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span>(</span><br><span class="line">    a = <span class="literal">iota</span>		<span class="comment">// 0	itoa = 0</span></span><br><span class="line">    b = <span class="number">5</span>			<span class="comment">// 5	itoa = 1</span></span><br><span class="line">    c = <span class="number">3</span>			<span class="comment">// 3	itoa = 2</span></span><br><span class="line">    d = <span class="literal">iota</span>		<span class="comment">// 3	itoa = 3</span></span><br><span class="line">    e = <span class="number">6</span>			<span class="comment">// 6</span></span><br><span class="line">    f				<span class="comment">// 6</span></span><br><span class="line">    g				<span class="comment">// 6</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="10-并发"><a href="#10-并发" class="headerlink" title="10. 并发"></a>10. 并发</h2><h3 id="10-1-基础概念"><a href="#10-1-基础概念" class="headerlink" title="10.1. 基础概念"></a>10.1. 基础概念</h3><ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/27056944">go调度详解</a></li></ul><p><strong>和线程的区别</strong></p><ul><li>OS线程（操作系统线程）一本都有固定的栈内存（通常为2MB）</li><li>一个 goroutine 的栈在其生命周期开始时只有很小的栈（典型情况下2KB），goroutine 的栈不是固定的，他可以按需增大和缩小，grorutine的栈大小限制可以达到1GB，但极少情况下会到1GB。所以在Go语言中一次创建十万左右的 grorutine 也是可以的。</li></ul><p><strong>和线程的关系</strong></p><ul><li>一个操作系统线程对应用户态多个goroutine。</li><li>go程序可以同时使用多个操作系统线程。</li><li>goroutine和OS线程是多对多的关系，即m:n。</li></ul><p><strong>其他</strong></p><ul><li>1.5版本之前，go仅占用一个核执行</li><li>1.5之后，默认使用所有核</li></ul><h3 id="10-2-sync-WaitGroup-等待退出"><a href="#10-2-sync-WaitGroup-等待退出" class="headerlink" title="10.2. sync.WaitGroup 等待退出"></a>10.2. <code>sync.WaitGroup</code> 等待退出</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello&quot;</span>, i)</span><br><span class="line">    wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello world, main&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> hello(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-3-runtime-GOMAXPROCS-i-int-限定占用核心数"><a href="#10-3-runtime-GOMAXPROCS-i-int-限定占用核心数" class="headerlink" title="10.3. runtime.GOMAXPROCS(i int) 限定占用核心数"></a>10.3. <code>runtime.GOMAXPROCS(i int)</code> 限定占用核心数</h3><ul><li>go可以设定goroutine占用的核心数</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hello</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello&quot;</span>, i)</span><br><span class="line">    wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	runtime.GOMAXPROCS(<span class="number">1</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;Hello world, main&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> hello(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-4-互斥锁"><a href="#10-4-互斥锁" class="headerlink" title="10.4. 互斥锁"></a>10.4. 互斥锁</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h2 id="11-面向对象编程"><a href="#11-面向对象编程" class="headerlink" title="11. 面向对象编程"></a>11. 面向对象编程</h2><h3 id="11-1-属性和方法"><a href="#11-1-属性和方法" class="headerlink" title="11.1. 属性和方法"></a>11.1. 属性和方法</h3><ul><li>go中使用结构体可以代表类</li><li>定义接受者代表方法</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rectangle define class</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    X <span class="type">int</span></span><br><span class="line">    Y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Area define method</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Rectangle)</span></span> Area() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.X * r.Y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rec := Rectangle&#123;</span><br><span class="line">        X: <span class="number">5</span>,</span><br><span class="line">        Y: <span class="number">10</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(rec.Area())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-2-访问权限"><a href="#11-2-访问权限" class="headerlink" title="11.2. 访问权限"></a>11.2. 访问权限</h3><ul><li>首字母大小写可以控制访问权限</li><li>不过小写对整个package都可以访问，外部不可以访问</li></ul><h3 id="11-3-继承"><a href="#11-3-继承" class="headerlink" title="11.3. 继承"></a>11.3. 继承</h3><ul><li>结构体里面直接定义另一个结构体就可以实现继承</li><li>但是初始化不能直接初始化父类的属性</li><li>同一个包内，大小写都可以访问到</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Rectangle define class</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    x <span class="type">int</span></span><br><span class="line">    Y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Area define method</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Rectangle)</span></span> Area() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.x * r.Y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> testRec <span class="keyword">struct</span> &#123;</span><br><span class="line">    Rectangle	<span class="comment">// 继承属性，不写不会继承属性，但是可以实现方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Area 可以调用，也可以像下面这样直接重写</span></span><br><span class="line"><span class="comment">// func (r *testRec) Area() int &#123;</span></span><br><span class="line"><span class="comment">//     return r.x * r.Y</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rec := testRec&#123;&#125;</span><br><span class="line">    rec.x = <span class="number">10</span></span><br><span class="line">    rec.Y = <span class="number">4</span></span><br><span class="line">    fmt.Println(rec.Area())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-4-多态"><a href="#11-4-多态" class="headerlink" title="11.4. 多态"></a>11.4. 多态</h3><ul><li>多态在go里面更多把思想转成接口</li><li>对外提供接口，但是存在不同实现</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义接口Product，定义接口存在方法Use</span></span><br><span class="line"><span class="keyword">type</span> Product <span class="keyword">interface</span> &#123;</span><br><span class="line">	Use()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// productA继承接口</span></span><br><span class="line"><span class="keyword">type</span> productA <span class="keyword">struct</span> &#123;</span><br><span class="line">	Product</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以继承另一个结构体</span></span><br><span class="line"><span class="keyword">type</span> productB <span class="keyword">struct</span> &#123;</span><br><span class="line">	productA</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-5-析构函数"><a href="#11-5-析构函数" class="headerlink" title="11.5. 析构函数"></a>11.5. 析构函数</h3><ul><li>go可以给类设置析构函数，但是析构时机是GC触发的时机</li><li>如果进程直接退出，由操作系统回收内存，不会触发析构函数</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> testT <span class="keyword">struct</span> &#123;</span><br><span class="line">	a    <span class="type">int</span></span><br><span class="line">	next *testT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> root testT</span><br><span class="line">	runtime.SetFinalizer(&amp;root, <span class="function"><span class="keyword">func</span> <span class="params">(tmp *testT)</span></span>  &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;hhh&quot;</span>, tmp.a)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="11-6-纯虚函数"><a href="#11-6-纯虚函数" class="headerlink" title="11.6. 纯虚函数"></a>11.6. 纯虚函数</h3><ul><li>对于go来说，不存在虚函数的概念，但是如果想要使用父类指针指向子类指针，必须实现父类定义的所有接口</li><li>接口类指向子类需要取地址，接口类可以直接调用自己的方法，会根据内存找到子类的方法调用</li><li><strong><font color="red">接口类指向子类内部只保存了子类的地址，所以参数传递可以值传递，改动会改动到内部子类的属性</font></strong></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TestI <span class="keyword">interface</span> &#123;</span><br><span class="line">	TestFunc()</span><br><span class="line">	Print()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TestImpl <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TestImpl)</span></span> Print() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;TestImpl Print&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TestImpl1 <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">()</span></span> TestI &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;TestImpl1&#123;&#125;		<span class="comment">// 这里取地址</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TestImpl1)</span></span> TestFunc() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;TestImpl1 TestFunc&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TestImpl1)</span></span> Print() &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;TestImpl1 Print&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := &amp;TestImpl&#123;&#125; <span class="comment">// 不会报错，没有实现不会认为是继承关系</span></span><br><span class="line">	a.Print()</span><br><span class="line">	<span class="keyword">var</span> b TestI = &amp;TestImpl&#123;&#125;	<span class="comment">// 有这句话就会报错，因为TestImpl没有完全实现TestI</span></span><br><span class="line">	<span class="keyword">var</span> c TestI = Constructor()</span><br><span class="line">	<span class="keyword">var</span> d *TestI = &amp;c</span><br><span class="line">	c.Print()	<span class="comment">// 可以正常调用，调用的是子类的方法</span></span><br><span class="line">	d.Print()	<span class="comment">// 报错，因为找不到 func (t *TestI)Print() 的实现</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-指针"><a href="#12-指针" class="headerlink" title="12. 指针"></a>12. 指针</h2><h3 id="12-1-int转指针"><a href="#12-1-int转指针" class="headerlink" title="12.1. int转指针"></a>12.1. int转指针</h3><ul><li>go中限制了指针类型的转换，不允许将int转成指针类型</li><li>但是，转换一下想法，用二级指针进行赋值即可</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tmp **testT</span><br><span class="line">tmp1 := <span class="number">0x111111111</span></span><br><span class="line">tmp = (**testT)(unsafe.Pointer(&amp;tmp1))</span><br><span class="line">fmt.Printf(<span class="string">&quot;%p&quot;</span>, *tmp)</span><br></pre></td></tr></table></figure><h2 id="13-GC-垃圾回收机制"><a href="#13-GC-垃圾回收机制" class="headerlink" title="13. GC 垃圾回收机制"></a>13. GC 垃圾回收机制</h2><ul><li>GC（Garbage Collection）</li><li>下面内容参考自 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/390926887">图解golang垃圾回收机制</a></li></ul><h3 id="13-1-内存管理"><a href="#13-1-内存管理" class="headerlink" title="13.1. 内存管理"></a>13.1. 内存管理</h3><p>程序在内存上被分为堆区、栈区、全局数据区、代码段、数据区五个部分。对于C++等早期编程语言栈上的内存由编译器管理回收，堆上的内存空间需要编程人员负责申请与释放。在Go中栈上内存仍由编译器负责管理回收，而堆上的内存由编译器和垃圾收集器负责管理回收，给编程人员带来了极大的便利性。</p><img src="2022-04-02-02.jpg"><h3 id="13-2-GC触发时机"><a href="#13-2-GC触发时机" class="headerlink" title="13.2. GC触发时机"></a>13.2. GC触发时机</h3><p>触发GC有俩个条件，一是堆内存的分配达到控制器计算的触发堆大小，初始大小环境变量GOGC，之后堆内存达到上一次垃圾收集的2倍时才会触发GC。二是如果一定时间内没有触发，就会触发新的循环，该触发条件由runtime.forcegcperiod变量控制，默认为2分钟。</p><h3 id="13-3-GC带来的便利和坑"><a href="#13-3-GC带来的便利和坑" class="headerlink" title="13.3. GC带来的便利和坑"></a>13.3. GC带来的便利和坑</h3><h4 id="1-便利"><a href="#1-便利" class="headerlink" title="1) 便利"></a>1) 便利</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;unsafe&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> testT <span class="keyword">struct</span> &#123;</span><br><span class="line">	a    <span class="type">int</span></span><br><span class="line">	next *testT</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testFunc</span><span class="params">(root *testT)</span></span> (arr []<span class="type">string</span>) &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">var</span> tmp testT</span><br><span class="line">		tmp.a = i</span><br><span class="line">		<span class="comment">// 引用了局部变量的地址，此变量在编译时会放到堆上而不是栈上</span></span><br><span class="line">		root.next = &amp;tmp</span><br><span class="line">		arr = <span class="built_in">append</span>(arr, fmt.Sprintf(<span class="string">&quot;%p&quot;</span>, &amp;tmp))</span><br><span class="line">		<span class="comment">// 这里加上析构函数查看触发时机</span></span><br><span class="line">		runtime.SetFinalizer(&amp;tmp, <span class="function"><span class="keyword">func</span> <span class="params">(tmp *testT)</span></span>  &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;hhh&quot;</span>, tmp.a)</span><br><span class="line">		&#125;)</span><br><span class="line">		root = root.next</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> root testT</span><br><span class="line"></span><br><span class="line">	arr := testFunc(&amp;root)</span><br><span class="line">	<span class="comment">// 手动触发GC，这里什么都回收不掉，因为后面还在使用</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		runtime.GC()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> e := &amp;root; e != <span class="literal">nil</span>; e = e.next &#123;</span><br><span class="line">		fmt.Println(e.a)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 手动触发GC，GC一次回收一个变量</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		runtime.GC()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 如果没有下面这一句使用了root，上面就会连带root的内存也回收掉，不会等到函数退出，因为分析后续没有再使用局部变量</span></span><br><span class="line">	<span class="comment">// 有下面这一句使用了root，上面就不会回收root和子节点</span></span><br><span class="line">	fmt.Println(root.a)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="14-struct"><a href="#14-struct" class="headerlink" title="14. struct"></a>14. struct</h2><h3 id="14-1-String-默认打印方法"><a href="#14-1-String-默认打印方法" class="headerlink" title="14.1. String() 默认打印方法"></a>14.1. String() 默认打印方法</h3><ul><li>使用值传递实现的，打印原始和指针类型都可以输出</li><li>使用指针传递实现的，必须使用指针类型打印才能输出，值传递输出不出来</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">	name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现String方法后，打印时会默认调用此方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a A)</span></span> String() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;A name: &quot;</span> + a.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 原型模式就是需要提供clone的接口，实现对对象的拷贝</span></span><br><span class="line">	a := A&#123;name: <span class="string">&quot;a&quot;</span>&#125;</span><br><span class="line">	fmt.Println(a) <span class="comment">// A name: a 默认调用String方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-2-初始化父类属性"><a href="#14-2-初始化父类属性" class="headerlink" title="14.2. 初始化父类属性"></a>14.2. 初始化父类属性</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ProductA <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ProductB <span class="keyword">struct</span> &#123;</span><br><span class="line">	ProductA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p := ProductB&#123;</span><br><span class="line">		ProductA: ProductA&#123;</span><br><span class="line">			Name: <span class="string">&quot;ProductB&quot;</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(p.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15-常量"><a href="#15-常量" class="headerlink" title="15. 常量"></a>15. 常量</h2><ul><li>go中常量只能是数字、布尔、字符串，其他类型无法定义成常量</li></ul><h2 id="16-package-包"><a href="#16-package-包" class="headerlink" title="16. package 包"></a>16. package 包</h2><h3 id="16-1-init函数"><a href="#16-1-init函数" class="headerlink" title="16.1. init函数"></a>16.1. init函数</h3><ul><li>init函数不可被调用，是golang提供的引入包就会调用的一个初始化函数</li><li>对于<code>package main</code>来说也是一样的，会在main函数调用前进行调用</li><li>init可以定义多个，按照定义顺序执行</li></ul><h2 id="17-channel"><a href="#17-channel" class="headerlink" title="17. channel"></a>17. channel</h2><h3 id="17-1-基本知识"><a href="#17-1-基本知识" class="headerlink" title="17.1. 基本知识"></a>17.1. 基本知识</h3><ul><li>天生的观察者消费者模式，支持多写多读</li><li>自带防止惊群效应的实现，读协程只会唤醒一个</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"><span class="keyword">var</span> wgW sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">read</span><span class="params">(i <span class="type">int</span>, ch <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">	<span class="comment">// 这里防止了惊群，不会同一个数据给到多个消费者</span></span><br><span class="line">	<span class="keyword">for</span> a := <span class="keyword">range</span> ch &#123;</span><br><span class="line">		fmt.Println(i, a)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">write</span><span class="params">(i <span class="type">int</span>, ch <span class="keyword">chan</span> <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">	ch &lt;- i</span><br><span class="line">	fmt.Println(i, <span class="string">&quot; write&quot;</span>)</span><br><span class="line">	wgW.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">100</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">500</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> read(i, ch)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">50</span>; i++ &#123;</span><br><span class="line">		wgW.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> write(i, ch)</span><br><span class="line">	&#125;</span><br><span class="line">	wgW.Wait()</span><br><span class="line">	<span class="built_in">close</span>(ch)	<span class="comment">// 这里立刻退出，不能再写数据了，但是可以读</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;close channel&quot;</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="17-2-close后的特性"><a href="#17-2-close后的特性" class="headerlink" title="17.2. close后的特性"></a>17.2. close后的特性</h3><ul><li>close不会阻塞，关闭后可读不可写，写会崩溃</li><li>close后，正在阻塞的消费者可以拿到一个默认值，for的方式会直接退出循环</li><li>close后，正在阻塞的生产者会崩溃</li></ul><h4 id="1-close之后不能写，正在写的会崩溃"><a href="#1-close之后不能写，正在写的会崩溃" class="headerlink" title="1) close之后不能写，正在写的会崩溃"></a>1) close之后不能写，正在写的会崩溃</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;begin write&quot;</span>)</span><br><span class="line">		ch &lt;- <span class="number">1</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;end write&quot;</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	time.Sleep(time.Second)</span><br><span class="line">	<span class="built_in">close</span>(ch)</span><br><span class="line">	fmt.Println(<span class="string">&quot;close done&quot;</span>)</span><br><span class="line">	time.Sleep(time.Second)</span><br><span class="line">	fmt.Println(<span class="string">&quot;main done&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">begin write</span></span><br><span class="line"><span class="comment">close done</span></span><br><span class="line"><span class="comment">panic: send on closed channel</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">goroutine 18 [running]:</span></span><br><span class="line"><span class="comment">main.main.func1()</span></span><br><span class="line"><span class="comment">        /path/to/main.go:12 +0x6c</span></span><br><span class="line"><span class="comment">created by main.main</span></span><br><span class="line"><span class="comment">        /path/to/main.go:10 +0x6c</span></span><br><span class="line"><span class="comment">exit status 2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="2-close之后可以读，把没读完的读完就退出了，for就读完退出，没数据直接读拿到默认值"><a href="#2-close之后可以读，把没读完的读完就退出了，for就读完退出，没数据直接读拿到默认值" class="headerlink" title="2) close之后可以读，把没读完的读完就退出了，for就读完退出，没数据直接读拿到默认值"></a>2) close之后可以读，把没读完的读完就退出了，for就读完退出，没数据直接读拿到默认值</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;begin write&quot;</span>)</span><br><span class="line">		ch &lt;- <span class="number">1</span></span><br><span class="line">		ch &lt;- <span class="number">2</span></span><br><span class="line">		ch &lt;- <span class="number">3</span></span><br><span class="line">		ch &lt;- <span class="number">4</span></span><br><span class="line">		ch &lt;- <span class="number">5</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;end write&quot;</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	time.Sleep(time.Second)</span><br><span class="line">	<span class="built_in">close</span>(ch)</span><br><span class="line">	fmt.Println(<span class="string">&quot;close done&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> v := <span class="keyword">range</span> ch &#123;</span><br><span class="line">		fmt.Println(v)</span><br><span class="line">	&#125;</span><br><span class="line">	v := &lt;-ch <span class="comment">// 没数据拿到默认值</span></span><br><span class="line">	fmt.Println(v)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">begin write</span></span><br><span class="line"><span class="comment">end write</span></span><br><span class="line"><span class="comment">close done</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="17-3-缓冲与无缓冲"><a href="#17-3-缓冲与无缓冲" class="headerlink" title="17.3. 缓冲与无缓冲"></a>17.3. 缓冲与无缓冲</h3><ul><li>无缓冲channel只负责数据的流转不负责存储数据，所以发送前必须有数据的接收者，否则发送会阻塞</li><li>缓冲channel可以储存部分数据，发送在缓冲区满之前可以发完继续运行</li></ul><h3 id="17-4-只读和只写chan"><a href="#17-4-只读和只写chan" class="headerlink" title="17.4. 只读和只写chan"></a>17.4. 只读和只写chan</h3><ul><li>只读和只写一般由一个可读可写的channel转化而来</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">productor</span><span class="params">(wch <span class="keyword">chan</span>&lt;- <span class="type">int</span>)</span></span> &lt;-<span class="keyword">chan</span> <span class="type">bool</span> &#123;</span><br><span class="line">	quit := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;product&quot;</span>, i)</span><br><span class="line">			wch &lt;- i</span><br><span class="line">		&#125;</span><br><span class="line">		quit &lt;- <span class="literal">true</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">return</span> quit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(rch &lt;-<span class="keyword">chan</span> <span class="type">int</span>)</span></span> &lt;-<span class="keyword">chan</span> <span class="type">bool</span> &#123;</span><br><span class="line">	quit := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">bool</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> v := <span class="keyword">range</span> rch &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;consumer&quot;</span>, v)</span><br><span class="line">			time.Sleep(<span class="number">100</span> * time.Millisecond)</span><br><span class="line">		&#125;</span><br><span class="line">		quit &lt;- <span class="literal">true</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">return</span> quit</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	rwCh := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>, <span class="number">10</span>)</span><br><span class="line">	qw := productor(rwCh)</span><br><span class="line">	qr := consumer(rwCh)</span><br><span class="line">	&lt;-qw</span><br><span class="line">	<span class="built_in">close</span>(rwCh)</span><br><span class="line">	&lt;-qr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="17-5-底层原理"><a href="#17-5-底层原理" class="headerlink" title="17.5. 底层原理"></a>17.5. 底层原理</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /usr/lib/go/src/runtime/chan.go</span></span><br><span class="line"><span class="keyword">type</span> hchan <span class="keyword">struct</span> &#123;</span><br><span class="line">	qcount   <span class="type">uint</span>           <span class="comment">// total data in the queue</span></span><br><span class="line">	dataqsiz <span class="type">uint</span>           <span class="comment">// size of the circular queue</span></span><br><span class="line">	buf      unsafe.Pointer <span class="comment">// points to an array of dataqsiz elements</span></span><br><span class="line">	elemsize <span class="type">uint16</span></span><br><span class="line">	closed   <span class="type">uint32</span></span><br><span class="line">	elemtype *_type <span class="comment">// element type</span></span><br><span class="line">	sendx    <span class="type">uint</span>   <span class="comment">// send index</span></span><br><span class="line">	recvx    <span class="type">uint</span>   <span class="comment">// receive index</span></span><br><span class="line">	recvq    waitq  <span class="comment">// list of recv waiters</span></span><br><span class="line">	sendq    waitq  <span class="comment">// list of send waiters</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// lock protects all fields in hchan, as well as several</span></span><br><span class="line">	<span class="comment">// fields in sudogs blocked on this channel.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Do not change another G&#x27;s status while holding this lock</span></span><br><span class="line">	<span class="comment">// (in particular, do not ready a G), as this can deadlock</span></span><br><span class="line">	<span class="comment">// with stack shrinking.</span></span><br><span class="line">	lock mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/lib/go/src/cmd/compile/internal/types/type.go</span></span><br><span class="line"><span class="comment">// Chan contains Type fields specific to channel types.</span></span><br><span class="line"><span class="keyword">type</span> Chan <span class="keyword">struct</span> &#123;</span><br><span class="line">	Elem *Type   <span class="comment">// element type</span></span><br><span class="line">	Dir  ChanDir <span class="comment">// channel direction</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/lib/go/src/cmd/compile/internal/types/type.go</span></span><br><span class="line"><span class="comment">// NewChan returns a new chan Type with direction dir.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewChan</span><span class="params">(elem *Type, dir ChanDir)</span></span> *Type &#123;</span><br><span class="line">	t := newType(TCHAN)</span><br><span class="line">	ct := t.ChanType()</span><br><span class="line">	ct.Elem = elem</span><br><span class="line">	ct.Dir = dir</span><br><span class="line">	<span class="keyword">if</span> elem.HasTParam() &#123;</span><br><span class="line">		t.SetHasTParam(<span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> elem.HasShape() &#123;</span><br><span class="line">		t.SetHasShape(<span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/lib/go/src/cmd/compile/internal/types/type.go</span></span><br><span class="line"><span class="comment">// New returns a new Type of the specified kind.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newType</span><span class="params">(et Kind)</span></span> *Type &#123;</span><br><span class="line">	t := &amp;Type&#123;</span><br><span class="line">		kind:  et,</span><br><span class="line">		width: BADWIDTH,</span><br><span class="line">	&#125;</span><br><span class="line">	t.underlying = t</span><br><span class="line">	<span class="comment">// TODO(josharian): lazily initialize some of these?</span></span><br><span class="line">	<span class="keyword">switch</span> t.kind &#123;</span><br><span class="line">    ...</span><br><span class="line">	<span class="keyword">case</span> TCHAN:</span><br><span class="line">		t.extra = <span class="built_in">new</span>(Chan)</span><br><span class="line">    ...</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>底层也是指针，所以传参传入的是指针，不用担心被拷贝</li></ul><h2 id="18-slice"><a href="#18-slice" class="headerlink" title="18. slice"></a>18. slice</h2><h3 id="18-1-一些基本操作"><a href="#18-1-一些基本操作" class="headerlink" title="18.1. 一些基本操作"></a>18.1. 一些基本操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/****** slice初始化 ******/</span></span><br><span class="line">s0 := []<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line">s1 := []<span class="type">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line">s2 := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">5</span>)		<span class="comment">// len 5, cap 5</span></span><br><span class="line">s3 := <span class="built_in">make</span>([]<span class="type">int</span>, <span class="number">0</span>, <span class="number">10</span>)	<span class="comment">// len 0, cap 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****** slice添加元素 ******/</span></span><br><span class="line"><span class="comment">// go对append有处理，如果赋值给原切片，且切片空间足够，不会新申请内存</span></span><br><span class="line"><span class="comment">// 赋值给原切片，空间不够，会申请cap的两倍大小空间</span></span><br><span class="line"><span class="comment">// 如果赋值给不同切片，会新申请内存，不会更改原切片</span></span><br><span class="line">s0 = <span class="built_in">append</span>(s0, <span class="number">2</span>)</span><br><span class="line">s0 = <span class="built_in">append</span>(s0, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">// 切片合并，其中s1...意味着将s1拆分成元素传入append</span></span><br><span class="line"><span class="comment">// 相当于调用添加多个元素</span></span><br><span class="line">s0 = <span class="built_in">append</span>(s0, s1...)</span><br><span class="line"></span><br><span class="line"><span class="comment">/****** slice删除元素 ******/</span></span><br><span class="line">s0 = s0[<span class="number">2</span>:]				<span class="comment">// 截取2到末尾，删除前两个元素</span></span><br><span class="line">s1 = s1[:<span class="built_in">len</span>(s1)<span class="number">-2</span>]		<span class="comment">// 开头到倒数第3个元素，删除后两个元素</span></span><br><span class="line">s0 = s0[:<span class="number">0</span>]				<span class="comment">// 清理slice，不改变cap</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****** 遍历 ******/</span></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> s0 &#123;</span><br><span class="line">	fmt.Println(v)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18-2-切片截取"><a href="#18-2-切片截取" class="headerlink" title="18.2. 切片截取"></a>18.2. 切片截取</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">testArr := []<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">8</span>&#125;</span><br><span class="line">fmt.Println(<span class="built_in">cap</span>(testArr), testArr) <span class="comment">// 7 [2 7 4 9 1 4 8]</span></span><br><span class="line">testArr = testArr[:<span class="built_in">len</span>(testArr)<span class="number">-1</span>]</span><br><span class="line">fmt.Println(<span class="built_in">cap</span>(testArr), testArr) <span class="comment">// 7 [2 7 4 9 1 4]</span></span><br><span class="line">testArr = testArr[<span class="number">1</span>:]</span><br><span class="line">fmt.Println(<span class="built_in">cap</span>(testArr), testArr) <span class="comment">// 6 [7 4 9 1 4]</span></span><br><span class="line">testArr = testArr[:<span class="number">0</span>]              <span class="comment">// 清理slice，不改变容量</span></span><br><span class="line">fmt.Println(<span class="built_in">cap</span>(testArr), testArr) <span class="comment">// 6 []</span></span><br></pre></td></tr></table></figure><ul><li>可以认为切片的截取就是在原切片的基础上，返回了一个切片，data的首地址、len、cap分别改了一下，本质上复用了原始的地址空间</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := []<span class="type">int</span>&#123;</span><br><span class="line">		<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(&amp;a[<span class="number">0</span>], &amp;a[<span class="number">1</span>])	<span class="comment">// 0x40000160c0 0x40000160c8</span></span><br><span class="line">	b := a[:<span class="number">3</span>]</span><br><span class="line">	fmt.Println(&amp;b[<span class="number">0</span>], &amp;b[<span class="number">1</span>]) 	<span class="comment">// 0x40000160c0 0x40000160c8 和a完全一样</span></span><br><span class="line">	b[<span class="number">0</span>] = <span class="number">3</span></span><br><span class="line">	fmt.Println(a)	<span class="comment">// [3 2 3 4 5]	改动会改动到a里面</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18-3-动态初始化二维数组（矩阵）"><a href="#18-3-动态初始化二维数组（矩阵）" class="headerlink" title="18.3. 动态初始化二维数组（矩阵）"></a>18.3. 动态初始化二维数组（矩阵）</h3><ul><li>矩阵的长宽不确定，构建的时候就需要一个一个进行构建，类似下面这样</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seen := <span class="built_in">make</span>([][]<span class="type">bool</span>, r)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; r; i++ &#123;</span><br><span class="line">	seen[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, c)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="18-4-底层实现原理"><a href="#18-4-底层实现原理" class="headerlink" title="18.4. 底层实现原理"></a>18.4. 底层实现原理</h3><h4 id="底层数据结构"><a href="#底层数据结构" class="headerlink" title="底层数据结构"></a>底层数据结构</h4><ul><li>slice本身是一个结构体</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /usr/lib/go/src/runtime/slice.go</span></span><br><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</span><br><span class="line">	array unsafe.Pointer</span><br><span class="line">	<span class="built_in">len</span>   <span class="type">int</span></span><br><span class="line">	<span class="built_in">cap</span>   <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// /usr/lib/go/src/cmd/compile/internal/types/type.go</span></span><br><span class="line"><span class="comment">// NewSlice returns the slice Type with element type elem.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSlice</span><span class="params">(elem *Type)</span></span> *Type &#123;</span><br><span class="line">	<span class="keyword">if</span> t := elem.cache.slice; t != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> t.Elem() != elem &#123;</span><br><span class="line">			base.Fatalf(<span class="string">&quot;elem mismatch&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> elem.HasTParam() != t.HasTParam() || elem.HasShape() != t.HasShape() &#123;</span><br><span class="line">			base.Fatalf(<span class="string">&quot;Incorrect HasTParam/HasShape flag for cached slice type&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> t</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	t := newType(TSLICE)</span><br><span class="line">	t.extra = Slice&#123;Elem: elem&#125;</span><br><span class="line">	elem.cache.slice = t</span><br><span class="line">	<span class="keyword">if</span> elem.HasTParam() &#123;</span><br><span class="line">		t.SetHasTParam(<span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> elem.HasShape() &#123;</span><br><span class="line">		t.SetHasShape(<span class="literal">true</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h4><ul><li>基于<code>golang v1.20.3</code>版本代码</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /usr/lib/go/src/runtime/slice.go</span></span><br><span class="line"><span class="comment">// growslice allocates new backing store for a slice.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// arguments:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	oldPtr = pointer to the slice&#x27;s backing array</span></span><br><span class="line"><span class="comment">//	newLen = new length (= oldLen + num)</span></span><br><span class="line"><span class="comment">//	oldCap = original slice&#x27;s capacity.</span></span><br><span class="line"><span class="comment">//	   num = number of elements being added</span></span><br><span class="line"><span class="comment">//	    et = element type</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// return values:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	newPtr = pointer to the new backing store</span></span><br><span class="line"><span class="comment">//	newLen = same value as the argument</span></span><br><span class="line"><span class="comment">//	newCap = capacity of the new backing store</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Requires that uint(newLen) &gt; uint(oldCap).</span></span><br><span class="line"><span class="comment">// Assumes the original slice length is newLen - num</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// A new backing store is allocated with space for at least newLen elements.</span></span><br><span class="line"><span class="comment">// Existing entries [0, oldLen) are copied over to the new backing store.</span></span><br><span class="line"><span class="comment">// Added entries [oldLen, newLen) are not initialized by growslice</span></span><br><span class="line"><span class="comment">// (although for pointer-containing element types, they are zeroed). They</span></span><br><span class="line"><span class="comment">// must be initialized by the caller.</span></span><br><span class="line"><span class="comment">// Trailing entries [newLen, newCap) are zeroed.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// growslice&#x27;s odd calling convention makes the generated code that calls</span></span><br><span class="line"><span class="comment">// this function simpler. In particular, it accepts and returns the</span></span><br><span class="line"><span class="comment">// new length so that the old length is not live (does not need to be</span></span><br><span class="line"><span class="comment">// spilled/restored) and the new length is returned (also does not need</span></span><br><span class="line"><span class="comment">// to be spilled/restored).</span></span><br><span class="line"><span class="comment">// newLen 期望多少</span></span><br><span class="line"><span class="comment">// num    要添加多少</span></span><br><span class="line"><span class="comment">// oldCap 原来有多少容量</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">growslice</span><span class="params">(oldPtr unsafe.Pointer, newLen, oldCap, num <span class="type">int</span>, et *_type)</span></span> slice &#123;</span><br><span class="line">	oldLen := newLen - num  <span class="comment">// 原来有多少数据（非容量）</span></span><br><span class="line">    ...     <span class="comment">// 省略检查</span></span><br><span class="line">	newcap := oldCap</span><br><span class="line">	doublecap := newcap + newcap    <span class="comment">// 原始容量double</span></span><br><span class="line">	<span class="keyword">if</span> newLen &gt; doublecap &#123;</span><br><span class="line">		newcap = newLen             <span class="comment">// 要添加的超过double，要多少给多少</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">const</span> threshold = <span class="number">256</span></span><br><span class="line">		<span class="keyword">if</span> oldCap &lt; threshold &#123;</span><br><span class="line">			newcap = doublecap      <span class="comment">// 不超过double，并且小于256，直接double容量</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// Check 0 &lt; newcap to detect overflow</span></span><br><span class="line">			<span class="comment">// and prevent an infinite loop.</span></span><br><span class="line">			<span class="keyword">for</span> <span class="number">0</span> &lt; newcap &amp;&amp; newcap &lt; newLen &#123;</span><br><span class="line">				<span class="comment">// Transition from growing 2x for small slices</span></span><br><span class="line">				<span class="comment">// to growing 1.25x for large slices. This formula</span></span><br><span class="line">				<span class="comment">// gives a smooth-ish transition between the two.</span></span><br><span class="line">				newcap += (newcap + <span class="number">3</span>*threshold) / <span class="number">4</span>        <span class="comment">// 超过256，每次添加 1/4的当前容量 + 3/4的256也就是192 容量</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// Set newcap to the requested cap when</span></span><br><span class="line">			<span class="comment">// the newcap calculation overflowed.</span></span><br><span class="line">			<span class="keyword">if</span> newcap &lt;= <span class="number">0</span> &#123;</span><br><span class="line">				newcap = newLen</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    ...     <span class="comment">// 省略内存对齐和溢出检查，capmem 是 newcap * sizeof(item) 内存对齐后的大小（字节）</span></span><br><span class="line">	<span class="keyword">var</span> p unsafe.Pointer</span><br><span class="line">	<span class="keyword">if</span> et.ptrdata == <span class="number">0</span> &#123;</span><br><span class="line">		p = mallocgc(capmem, <span class="literal">nil</span>, <span class="literal">false</span>)</span><br><span class="line">		<span class="comment">// The append() that calls growslice is going to overwrite from oldLen to newLen.</span></span><br><span class="line">		<span class="comment">// Only clear the part that will not be overwritten.</span></span><br><span class="line">		<span class="comment">// The reflect_growslice() that calls growslice will manually clear</span></span><br><span class="line">		<span class="comment">// the region not cleared here.</span></span><br><span class="line">		memclrNoHeapPointers(add(p, newlenmem), capmem-newlenmem)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// Note: can&#x27;t use rawmem (which avoids zeroing of memory), because then GC can scan uninitialized memory.</span></span><br><span class="line">		p = mallocgc(capmem, et, <span class="literal">true</span>)</span><br><span class="line">		<span class="keyword">if</span> lenmem &gt; <span class="number">0</span> &amp;&amp; writeBarrier.enabled &#123;</span><br><span class="line">			<span class="comment">// Only shade the pointers in oldPtr since we know the destination slice p</span></span><br><span class="line">			<span class="comment">// only contains nil pointers because it has been cleared during alloc.</span></span><br><span class="line">			bulkBarrierPreWriteSrcOnly(<span class="type">uintptr</span>(p), <span class="type">uintptr</span>(oldPtr), lenmem-et.size+et.ptrdata)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	memmove(p, oldPtr, lenmem)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> slice&#123;p, newLen, newcap&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="19-import-导入包"><a href="#19-import-导入包" class="headerlink" title="19. import 导入包"></a>19. import 导入包</h2><h3 id="19-1-普通导入"><a href="#19-1-普通导入" class="headerlink" title="19.1. 普通导入"></a>19.1. 普通导入</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Hello, world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-2-别名导入"><a href="#19-2-别名导入" class="headerlink" title="19.2. 别名导入"></a>19.2. 别名导入</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	f <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f.Println(<span class="string">&quot;Hello, world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-3-隐藏导入"><a href="#19-3-隐藏导入" class="headerlink" title="19.3. 隐藏导入"></a>19.3. 隐藏导入</h3><ul><li>不调用，仅导入</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="19-4-不需要使用包名字调用"><a href="#19-4-不需要使用包名字调用" class="headerlink" title="19.4. 不需要使用包名字调用"></a>19.4. 不需要使用包名字调用</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	. <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	Println(<span class="string">&quot;Hello, world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="20-泛型"><a href="#20-泛型" class="headerlink" title="20. 泛型"></a>20. 泛型</h2><h3 id="20-1-泛型函数"><a href="#20-1-泛型函数" class="headerlink" title="20.1. 泛型函数"></a>20.1. 泛型函数</h3><ul><li>类似于c++的模板函数</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(l T)</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20-2-泛型的限制"><a href="#20-2-泛型的限制" class="headerlink" title="20.2. 泛型的限制"></a>20.2. 泛型的限制</h3><ul><li>泛型不能使用<code>a.(type)</code>获取类型，只能使用<code>reflect.TypeOf()</code>来获取</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetType</span>[<span class="title">T</span> <span class="title">any</span>]<span class="params">(a T)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 编译不允许</span></span><br><span class="line">	b := a.(<span class="type">int</span>)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	<span class="comment">// 编译不允许</span></span><br><span class="line">	<span class="keyword">switch</span> a.(<span class="keyword">type</span>) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="type">int</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;a is int&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用下面方式获取类型</span></span><br><span class="line">	b := reflect.TypeOf(a)</span><br><span class="line">	fmt.Println(<span class="string">&quot;a is&quot;</span>, b)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> b.Kind() &#123;</span><br><span class="line">	<span class="keyword">case</span> reflect.Int:</span><br><span class="line">		fmt.Println(<span class="string">&quot;a is int&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> reflect.Bool:</span><br><span class="line">		fmt.Println(<span class="string">&quot;a is bool&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20-3-自定义泛型类型"><a href="#20-3-自定义泛型类型" class="headerlink" title="20.3. 自定义泛型类型"></a>20.3. 自定义泛型类型</h3><h4 id="comparable"><a href="#comparable" class="headerlink" title="comparable"></a>comparable</h4><ul><li>comparable只能针对<code>!=</code>和<code>==</code>两个操作符</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CompareSlice</span>[<span class="title">T</span> <span class="title">comparable</span>]<span class="params">(l, r []T)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(l) != <span class="built_in">len</span>(r) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(l) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> l &#123;</span><br><span class="line">		<span class="keyword">if</span> l[i] != r[i] &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="自定义其他类型"><a href="#自定义其他类型" class="headerlink" title="自定义其他类型"></a>自定义其他类型</h4><ul><li>使用下面的方式定义限定只能下面几种类型传递</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> compareType <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="type">int</span> | <span class="type">int8</span> | <span class="type">int16</span> | <span class="type">int32</span> | <span class="type">int64</span> | <span class="type">uint</span> | <span class="type">uint8</span> | <span class="type">uint16</span> | <span class="type">uint32</span> | <span class="type">uint64</span> | <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CompareUnorderSlice</span>[<span class="title">T</span> <span class="title">compareType</span>]<span class="params">(l, r []T)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(l) != <span class="built_in">len</span>(r) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(l) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	a := DeepCopy(l)</span><br><span class="line">	b := DeepCopy(r)</span><br><span class="line">	sort.Slice(a, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a[i] &lt; a[j]</span><br><span class="line">	&#125;)</span><br><span class="line">	sort.Slice(b, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> b[i] &lt; b[j]</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> CompareSlice(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="衍生类型"><a href="#衍生类型" class="headerlink" title="衍生类型"></a>衍生类型</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span>[<span class="title">T</span> <span class="title">int</span>]<span class="params">(a, b T)</span></span> T &#123;</span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TestInt <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a TestInt = <span class="number">1</span></span><br><span class="line">	<span class="keyword">var</span> b TestInt = <span class="number">2</span></span><br><span class="line">	fmt.Println(Add(a, b))  <span class="comment">// 编译报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用<code>~</code>修饰的类型，可以使用其衍生类型</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add</span>[<span class="title">T</span> ~<span class="title">int</span>]<span class="params">(a, b T)</span></span> T &#123;</span><br><span class="line">	<span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TestInt <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> a TestInt = <span class="number">1</span></span><br><span class="line">	<span class="keyword">var</span> b TestInt = <span class="number">2</span></span><br><span class="line">	fmt.Println(Add(a, b))  <span class="comment">// 编译通过</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="官方定义的衍生类型-golang-org-x-exp-constraints"><a href="#官方定义的衍生类型-golang-org-x-exp-constraints" class="headerlink" title="官方定义的衍生类型 golang.org/x/exp/constraints"></a>官方定义的衍生类型 <code>golang.org/x/exp/constraints</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Signed is a constraint that permits any signed integer type.</span></span><br><span class="line"><span class="comment">// If future releases of Go add new predeclared signed integer types,</span></span><br><span class="line"><span class="comment">// this constraint will be modified to include them.</span></span><br><span class="line"><span class="keyword">type</span> Signed <span class="keyword">interface</span> &#123;</span><br><span class="line">	~<span class="type">int</span> | ~<span class="type">int8</span> | ~<span class="type">int16</span> | ~<span class="type">int32</span> | ~<span class="type">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unsigned is a constraint that permits any unsigned integer type.</span></span><br><span class="line"><span class="comment">// If future releases of Go add new predeclared unsigned integer types,</span></span><br><span class="line"><span class="comment">// this constraint will be modified to include them.</span></span><br><span class="line"><span class="keyword">type</span> Unsigned <span class="keyword">interface</span> &#123;</span><br><span class="line">	~<span class="type">uint</span> | ~<span class="type">uint8</span> | ~<span class="type">uint16</span> | ~<span class="type">uint32</span> | ~<span class="type">uint64</span> | ~<span class="type">uintptr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Integer is a constraint that permits any integer type.</span></span><br><span class="line"><span class="comment">// If future releases of Go add new predeclared integer types,</span></span><br><span class="line"><span class="comment">// this constraint will be modified to include them.</span></span><br><span class="line"><span class="keyword">type</span> Integer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Signed | Unsigned</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Float is a constraint that permits any floating-point type.</span></span><br><span class="line"><span class="comment">// If future releases of Go add new predeclared floating-point types,</span></span><br><span class="line"><span class="comment">// this constraint will be modified to include them.</span></span><br><span class="line"><span class="keyword">type</span> Float <span class="keyword">interface</span> &#123;</span><br><span class="line">	~<span class="type">float32</span> | ~<span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Complex is a constraint that permits any complex numeric type.</span></span><br><span class="line"><span class="comment">// If future releases of Go add new predeclared complex numeric types,</span></span><br><span class="line"><span class="comment">// this constraint will be modified to include them.</span></span><br><span class="line"><span class="keyword">type</span> Complex <span class="keyword">interface</span> &#123;</span><br><span class="line">	~<span class="type">complex64</span> | ~<span class="type">complex128</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ordered is a constraint that permits any ordered type: any type</span></span><br><span class="line"><span class="comment">// that supports the operators &lt; &lt;= &gt;= &gt;.</span></span><br><span class="line"><span class="comment">// If future releases of Go add new ordered types,</span></span><br><span class="line"><span class="comment">// this constraint will be modified to include them.</span></span><br><span class="line"><span class="keyword">type</span> Ordered <span class="keyword">interface</span> &#123;</span><br><span class="line">	Integer | Float | ~<span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="21-defer"><a href="#21-defer" class="headerlink" title="21. defer"></a>21. defer</h2><h3 id="21-1-defer调用时机和顺序"><a href="#21-1-defer调用时机和顺序" class="headerlink" title="21.1. defer调用时机和顺序"></a>21.1. defer调用时机和顺序</h3><ul><li>defer是出函数作用域才调用，下面的调用是在<code>main end</code>之后</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">			fmt.Println(i)</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;main end&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="21-2-defer和命名返回值"><a href="#21-2-defer和命名返回值" class="headerlink" title="21.2. defer和命名返回值"></a>21.2. defer和命名返回值</h3><ul><li>命名返回值，就算没有显式赋值，defer拿到的也是最终的返回值</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">aaa</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testFunc</span><span class="params">()</span></span> (a <span class="type">int</span>) &#123;</span><br><span class="line">	a = <span class="number">4</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(a)	<span class="comment">// 5</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">return</span> aaa()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	testFunc()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="22-作用域"><a href="#22-作用域" class="headerlink" title="22. 作用域"></a>22. 作用域</h2><h3 id="22-1-作用域变化的"><a href="#22-1-作用域变化的" class="headerlink" title="22.1. 作用域变化的:="></a>22.1. 作用域变化的<code>:=</code></h3><ul><li>作用域相同，不会新建同名变量</li><li>作用域不相同，同名变量会新建，外面的不会更改</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">aaa</span><span class="params">()</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>, <span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="number">4</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(a) <span class="comment">// 5</span></span><br><span class="line">	&#125;()</span><br><span class="line">	a, b := aaa()</span><br><span class="line">	fmt.Println(a, b) <span class="comment">// 5 6</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">aaa</span><span class="params">()</span></span> (<span class="type">int</span>, <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>, <span class="number">6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="number">4</span></span><br><span class="line">	<span class="keyword">if</span> <span class="literal">true</span> &#123;</span><br><span class="line">		a, b := aaa()</span><br><span class="line">		fmt.Println(a, b) <span class="comment">// 5 6</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(a) <span class="comment">// 4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="23-跨平台"><a href="#23-跨平台" class="headerlink" title="23. 跨平台"></a>23. 跨平台</h2><ul><li>go可以在文件头部指定特定平台编译文件</li><li>具体支持的平台和架构使用<code>go tool dist list</code>查看</li></ul><p><strong>仅在linux的amd64下编译</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:build linux &amp;&amp; amd64</span></span><br><span class="line"><span class="comment">// +build linux,amd64</span></span><br></pre></td></tr></table></figure><p><strong>在linux或mac下编译</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:build linux || darwin</span></span><br><span class="line"><span class="comment">// +build linux darwin</span></span><br></pre></td></tr></table></figure><h1 id="三、GMP运行模型"><a href="#三、GMP运行模型" class="headerlink" title="三、GMP运行模型"></a>三、GMP运行模型</h1><p>参考一些好的帖子</p><ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/288017699">全文图解Golang 调度器 GMP 原理与调度</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/261057034">Golang并发模型GMP</a></li><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/385371995?utm_id=0">Golang 系统调用与阻塞处理</a></li></ul><p><img src="/2023-06-16-01.png"></p><h2 id="1-几个原则"><a href="#1-几个原则" class="headerlink" title="1. 几个原则"></a>1. 几个原则</h2><ul><li>G goroutine</li><li>M machine 也是线程的抽象</li><li>P process 协程调度器</li><li>M必须绑定一个P才能执行</li><li>P默认是cpu核心数，可以使用<code>runtime.GOMAXPROCS(2)</code>设置P的数量</li><li>每个P上面有一个G的队列不超过256个，M绑定P后，从P的队列中取G运行</li><li>新的G创建出来后，先加入P的本地队列中，P的本地队列满了就取一半放到全局队列中</li><li>M把某个P上面的G队列执行完了，会从全局队列拿一批放到本地队列或者从其他P的本地队列偷一半到自己的本地队列中</li><li>如果G中某个系统调用阻塞了M，go底层hook了相关系统调用，会阻塞的将会把G和M绑定一起从P中排除，然后找空闲的M，没有空闲的M就直接新建一个M</li><li>go程序启动会设置M的最大数量，默认10000. 但是内核很难支持这么多的线程数，所以这个限制可以忽略</li><li>可以手动设置M的最大数量，使用<code>debug.SetMaxThreads(6)</code>设置，但是超过此数量会直接崩溃而不是不建立继续运行</li></ul><h2 id="2-调试方法"><a href="#2-调试方法" class="headerlink" title="2. 调试方法"></a>2. 调试方法</h2><ul><li>设置环境变量后，执行程序就会显示调度器的状态</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export GODEBUG=schedtrace=1000</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SCHED 1001ms: gomaxprocs=16 idleprocs=15 threads=9 spinningthreads=0 needspinning=0 idlethreads=2 runqueue=0 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</span><br></pre></td></tr></table></figure><ul><li><code>SCHED</code>：调试信息输出标志字符串，代表本行是 goroutine 调度器的输出；</li><li><code>1001ms</code>：即从程序启动到输出这行日志的时间；</li><li><code>gomaxprocs=16</code>: P的数量，默认的 P 的属性是和 cpu 核心数量默认一致</li><li><code>idleprocs=15</code>: 处于 idle 状态的 P 的数量；通过 gomaxprocs 和 idleprocs 的差值，我们就可知道执行 go 代码的 P 的数量；</li><li><code>threads=9</code>: os threads&#x2F;M 的数量，包含 scheduler 使用的 m 数量，加上 runtime 自用的类似 sysmon 这样的 thread 的数量；</li><li><code>spinningthreads=0</code>: 处于自旋状态的 os thread 数量；</li><li><code>needspinning=0</code>: 需要自旋的 os thread 数量；</li><li><code>idlethreads=2</code>: 处于 idle 状态的 os thread 的数量；</li><li><code>runqueue=0</code>： Scheduler 全局队列中 G 的数量；</li><li><code>[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</code>: 16个P的本地队列中的G的数量。</li></ul><h1 id="四、标准库"><a href="#四、标准库" class="headerlink" title="四、标准库"></a>四、标准库</h1><h2 id="1-encoding-json"><a href="#1-encoding-json" class="headerlink" title="1. encoding&#x2F;json"></a>1. encoding&#x2F;json</h2><h3 id="1-1-一些基本操作"><a href="#1-1-一些基本操作" class="headerlink" title="1.1. 一些基本操作"></a>1.1. 一些基本操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/****** 将json字符串序列化成go对象 ******/</span></span><br><span class="line">	<span class="comment">// 先marshal在unmarshal可以让一个未知的interface确定内部类型</span></span><br><span class="line">	<span class="comment">// Unmarshal可以将一个json字符串解析到一个特定的格式下</span></span><br><span class="line">	<span class="comment">// json.Unmarshal会将数字解析成float64</span></span><br><span class="line">	json.Unmarshal(jsonBytes, &amp;target)</span><br><span class="line"></span><br><span class="line">	<span class="comment">/****** 将go对象转成json字符串 ******/</span></span><br><span class="line">	<span class="keyword">var</span> f <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	jsonBytes, err := json.Marshal(&amp;f)</span><br><span class="line">	<span class="comment">// 格式化的字符串，第二个是前缀，第三个是缩进符号</span></span><br><span class="line">	jsonIndentBytes, err := json.MarshalIndent(&amp;f, <span class="string">&quot;&quot;</span>, <span class="string">&quot;    &quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-key排序转json"><a href="#1-2-key排序转json" class="headerlink" title="1.2. key排序转json"></a>1.2. key排序转json</h3><ul><li>go默认对<code>map[string]interface&#123;&#125;</code>转json按照key升序转化</li><li>想要对key排序只能通过结构体的方式，转json会按照结构体的顺序转化</li><li>为空的key不想输出，可以加上<code>omitempty</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> outT <span class="keyword">struct</span> &#123;</span><br><span class="line">	Type <span class="type">string</span> <span class="string">`json:&quot;type,omitempty&quot;`</span></span><br><span class="line">	Name <span class="type">string</span> <span class="string">`json:&quot;name,omitempty&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> f outT</span><br><span class="line">	str, _ := json.Marshal(&amp;f)	<span class="comment">// &#123;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-单纯想压缩json不修改key顺序"><a href="#1-3-单纯想压缩json不修改key顺序" class="headerlink" title="1.3. 单纯想压缩json不修改key顺序"></a>1.3. 单纯想压缩json不修改key顺序</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="string">`&#123; &quot;z&quot;: 1, &quot;a&quot;: 2 &#125;`</span></span><br><span class="line">	<span class="comment">// 使用下面的方式会排序</span></span><br><span class="line">	<span class="keyword">var</span> tmp <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	json.Unmarshal([]<span class="type">byte</span>(a), &amp;tmp)</span><br><span class="line">	out, _ := json.Marshal(tmp)</span><br><span class="line">	fmt.Println(<span class="type">string</span>(out)) <span class="comment">// &#123;&quot;a&quot;:2,&quot;z&quot;:1&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用这种方式就可以直接压缩</span></span><br><span class="line">	out2 := &amp;bytes.Buffer&#123;&#125;</span><br><span class="line">	json.Compact(out2, []<span class="type">byte</span>(a))</span><br><span class="line">	fmt.Println(out2.String()) <span class="comment">// &#123;&quot;z&quot;:1,&quot;a&quot;:2&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>数字类型在Unmarshal之后会转成float64，只能断言为float64</li></ul><h2 id="2-testing-单测"><a href="#2-testing-单测" class="headerlink" title="2. testing 单测"></a>2. testing 单测</h2><ul><li>单测文件要以<code>xxx_test.go</code>的格式，函数名以<code>Testxxx</code>的格式，package和要测试的文件属于同一个</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">	<span class="string">&quot;sort&quot;</span></span><br><span class="line">	<span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line"></span><br><span class="line">	. <span class="string">&quot;github.com/agiledragon/gomonkey&quot;</span></span><br><span class="line">	. <span class="string">&quot;github.com/smartystreets/goconvey/convey&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestFunc</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	sess := session.Session&#123;&#125;</span><br><span class="line">	<span class="keyword">var</span> s *session.Session</span><br><span class="line"></span><br><span class="line">    <span class="comment">// hook类的成员函数Commit</span></span><br><span class="line">	patch := ApplyMethod(reflect.TypeOf(s), <span class="string">&quot;Commit&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(_ *session.Session)</span></span> <span class="type">error</span> &#123; <span class="keyword">return</span> <span class="literal">nil</span> &#125;)</span><br><span class="line">	<span class="keyword">defer</span> patch.Reset()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用Convey包裹，可以按照分组测试</span></span><br><span class="line">	Convey(<span class="string">&quot;TestFunc&quot;</span>, t, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		Convey(<span class="string">&quot;正常流程&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			Convey(<span class="string">&quot;插入单个数据&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">				sess.New()</span><br><span class="line">                ...</span><br><span class="line">                <span class="comment">// So确定</span></span><br><span class="line">				So(tmp, ShouldResemble, []<span class="type">string</span>&#123;<span class="string">&quot;aaa&quot;</span>&#125;)</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">		Convey(<span class="string">&quot;异常流程&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			Convey(<span class="string">&quot;GetSessionData出错&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">				sess.New()</span><br><span class="line">				...</span><br><span class="line">				patch1 := ApplyMethod(reflect.TypeOf(s), <span class="string">&quot;GetSessionData&quot;</span>,</span><br><span class="line">					<span class="function"><span class="keyword">func</span><span class="params">(_ *session.Session, _ <span class="type">string</span>)</span></span> (<span class="keyword">interface</span>&#123;&#125;, <span class="type">error</span>) &#123;</span><br><span class="line">						<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;testErr&quot;</span>)</span><br><span class="line">					&#125;)</span><br><span class="line">				...</span><br><span class="line">				So(tmp, ShouldResemble, []<span class="type">string</span>&#123;&#125;)</span><br><span class="line">				patch1.Reset()</span><br><span class="line">				...</span><br><span class="line">				So(tmp, ShouldResemble, []<span class="type">string</span>&#123;<span class="string">&quot;bbb&quot;</span>&#125;)</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-性能分析"><a href="#2-2-性能分析" class="headerlink" title="2.2. 性能分析"></a>2.2. 性能分析</h3><p>参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/332613357">go 性能优化之 benchmark + pprof</a></p><ul><li>函数需要使用下面的定义</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkXXX</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用<code>go test</code>命令跑</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-bench xxx 测试哪个函数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-run none 不跑单测函数</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-benchmem 表示打印函数执行过程中的内存分配</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-cpuprofile xxx.out cpu文件路径</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-memprofile xxx.out 内存文件路径</span></span><br><span class="line">go test -bench BenchmarkXXX -run none -benchmem -cpuprofile cpuprofile.out -memprofile memprofile.out [package]</span><br></pre></td></tr></table></figure><ul><li>正常结束后可以使用下面命令生成报告，会自动打开浏览器</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof -http=&quot;:8081&quot; cpuprofile.out</span><br></pre></td></tr></table></figure><h2 id="3-flag-控制台参数解析"><a href="#3-flag-控制台参数解析" class="headerlink" title="3. flag 控制台参数解析"></a>3. flag 控制台参数解析</h2><h3 id="3-1-获取命令行参数"><a href="#3-1-获取命令行参数" class="headerlink" title="3.1. 获取命令行参数"></a>3.1. 获取命令行参数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 在使用前先调用此函数解析参数，不然会返回空</span></span><br><span class="line">	flag.Parse()</span><br><span class="line">	<span class="comment">// 打印第一个参数</span></span><br><span class="line">	fmt.Println(flag.Arg(<span class="number">0</span>))</span><br><span class="line">	<span class="comment">// 打印所有非flag的参数</span></span><br><span class="line">	fmt.Println(flag.Args())</span><br><span class="line">	<span class="comment">// 打印参数个数</span></span><br><span class="line">	fmt.Println(flag.NArg())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">=&gt; go run main.go a -a -b -asdfsaf cccc</span><br><span class="line">a</span><br><span class="line">[a -a -b -asdfsaf ccc]</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h2 id="4-path-filepath-目录操作库"><a href="#4-path-filepath-目录操作库" class="headerlink" title="4. path&#x2F;filepath 目录操作库"></a>4. path&#x2F;filepath 目录操作库</h2><h3 id="4-1-遍历目录下所有文件和目录，类似-find-xxx"><a href="#4-1-遍历目录下所有文件和目录，类似-find-xxx" class="headerlink" title="4.1. 遍历目录下所有文件和目录，类似 find xxx"></a>4.1. 遍历目录下所有文件和目录，类似 <code>find xxx</code></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;flag&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">    <span class="string">&quot;path/filepath&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getFileList</span><span class="params">(path <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">    err := filepath.Walk(path, <span class="function"><span class="keyword">func</span><span class="params">(path <span class="type">string</span>, f os.FileInfo, err <span class="type">error</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> f == <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> f.IsDir() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">println</span>(path)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;filepath.Walk() return %v\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    flag.Parse()</span><br><span class="line">	<span class="keyword">var</span> root <span class="type">string</span></span><br><span class="line">    root = flag.Arg(<span class="number">0</span>)</span><br><span class="line">    getFileList(root)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">=&gt; go run main.go .</span><br><span class="line">go.mod</span><br><span class="line">main.go</span><br><span class="line">=&gt; go run main.go ./</span><br><span class="line">go.mod</span><br><span class="line">main.go</span><br><span class="line">=&gt; go run main.go ../</span><br><span class="line">../test/go.mod</span><br><span class="line">../test/main.go</span><br><span class="line">=&gt; go run main.go /path/to/test</span><br><span class="line">/path/to/test/go.mod</span><br><span class="line">/path/to/test/main.go</span><br></pre></td></tr></table></figure><h3 id="4-2-路径处理"><a href="#4-2-路径处理" class="headerlink" title="4.2. 路径处理"></a>4.2. 路径处理</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	filePath := <span class="string">&quot;/home/test/aaaa/test.txt&quot;</span></span><br><span class="line">	fmt.Println(filepath.Base(filePath))	<span class="comment">// 文件名 test.txt</span></span><br><span class="line">	fmt.Println(filepath.Dir(filePath))		<span class="comment">// 路径名 /home/test/aaaa</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-os-exec-命令行调用"><a href="#5-os-exec-命令行调用" class="headerlink" title="5. os&#x2F;exec 命令行调用"></a>5. os&#x2F;exec 命令行调用</h2><h3 id="5-1-阻塞式等待返回，并输出stdout"><a href="#5-1-阻塞式等待返回，并输出stdout" class="headerlink" title="5.1. 阻塞式等待返回，并输出stdout"></a>5.1. 阻塞式等待返回，并输出stdout</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;bytes&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;os/exec&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">execShell</span><span class="params">(s <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">    cmd := exec.Command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, s)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> out bytes.Buffer</span><br><span class="line">    cmd.Stdout = &amp;out</span><br><span class="line"></span><br><span class="line">    err := cmd.Run()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;%v\n&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> out.String(), err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(execShell(<span class="string">&quot;ls /&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-net-http-http网络请求库"><a href="#6-net-http-http网络请求库" class="headerlink" title="6. net&#x2F;http http网络请求库"></a>6. net&#x2F;http http网络请求库</h2><h3 id="6-1-发送post请求"><a href="#6-1-发送post请求" class="headerlink" title="6.1. 发送post请求"></a>6.1. 发送post请求</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	resp, err := http.Post(<span class="string">&quot;https://1.1.1.1:1234/a/b&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, strings.NewReader(<span class="string">&quot;mobileId=!@#$%^&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">    body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-忽略https的证书错误"><a href="#6-2-忽略https的证书错误" class="headerlink" title="6.2. 忽略https的证书错误"></a>6.2. 忽略https的证书错误</h3><h4 id="1-修改默认客户端"><a href="#1-修改默认客户端" class="headerlink" title="(1) 修改默认客户端"></a>(1) 修改默认客户端</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">    <span class="string">&quot;crypto/tls&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.DefaultClient.Transport = &amp;http.Transport&#123;</span><br><span class="line">        TLSClientConfig: &amp;tls.Config&#123;</span><br><span class="line">            InsecureSkipVerify: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	resp, err := http.Post(<span class="string">&quot;https://1.1.1.1:1234/a/b&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>, strings.NewReader(<span class="string">&quot;mobileId=!@#$%^&quot;</span>))</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-302不跳转"><a href="#6-3-302不跳转" class="headerlink" title="6.3. 302不跳转"></a>6.3. 302不跳转</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	tr := http.Transport&#123;</span><br><span class="line">		TLSClientConfig: &amp;tls.Config&#123;</span><br><span class="line">			InsecureSkipVerify: <span class="literal">true</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	c := http.Client&#123;</span><br><span class="line">		Transport: &amp;tr,</span><br><span class="line">		CheckRedirect: <span class="function"><span class="keyword">func</span><span class="params">(req *http.Request, via []*http.Request)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">			<span class="comment">// 返回这个错误，302就不会继续跳转</span></span><br><span class="line">			<span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	resp, err := c.Get(<span class="string">&quot;https://10.240.17.108:8080&quot;</span>)</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-4-获取tcp的四元组"><a href="#6-4-获取tcp的四元组" class="headerlink" title="6.4. 获取tcp的四元组"></a>6.4. 获取tcp的四元组</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 修改DialContext才能拿到连接信息，将conn返回前赋值给conn变量</span></span><br><span class="line">	<span class="keyword">var</span> conn net.Conn</span><br><span class="line">	<span class="keyword">var</span> connLock sync.Mutex</span><br><span class="line">	tr := http.Transport&#123;</span><br><span class="line">		TLSClientConfig: &amp;tls.Config&#123;</span><br><span class="line">			InsecureSkipVerify: <span class="literal">true</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		DialContext: <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, network, addr <span class="type">string</span>)</span></span> (net.Conn, <span class="type">error</span>) &#123;</span><br><span class="line">			<span class="keyword">var</span> dialer net.Dialer</span><br><span class="line">			c, err := dialer.DialContext(ctx, network, addr)</span><br><span class="line">			<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">				connLock.Lock()</span><br><span class="line">				conn = c</span><br><span class="line">				connLock.Unlock()</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> c, err</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c := http.Client&#123; Transport: &amp;tr &#125;</span><br><span class="line">	c.Get(<span class="string">&quot;https://10.240.17.108:8080&quot;</span>)</span><br><span class="line">	connLock.Lock()</span><br><span class="line">	fmt.Println(conn.LocalAddr().String(), conn.RemoteAddr().String())</span><br><span class="line">	connLock.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-strings-字符串操作库"><a href="#7-strings-字符串操作库" class="headerlink" title="7. strings 字符串操作库"></a>7. strings 字符串操作库</h2><h3 id="7-1-字符串替换"><a href="#7-1-字符串替换" class="headerlink" title="7.1. 字符串替换"></a>7.1. 字符串替换</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	outStr := <span class="string">&#x27;&#123;&quot;a&quot;:&quot;123&quot;&#125;&#x27;</span></span><br><span class="line">	<span class="comment">// 将json中的双引号全部替换为单引号</span></span><br><span class="line">	outStr = strings.ReplaceAll(outStr, <span class="string">`&quot;`</span>, <span class="string">`&#x27;`</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2-裁剪两端字符串"><a href="#7-2-裁剪两端字符串" class="headerlink" title="7.2. 裁剪两端字符串"></a>7.2. 裁剪两端字符串</h3><ul><li>只能裁剪两端的字符串，中间的不会裁剪</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">outStr := <span class="string">&quot;abffffffffabfffffffab&quot;</span></span><br><span class="line">outStr = strings.Trim(outStr, <span class="string">&quot;ab&quot;</span>)		<span class="comment">// ffffffffabfffffff</span></span><br></pre></td></tr></table></figure><h3 id="7-3-字符串分割"><a href="#7-3-字符串分割" class="headerlink" title="7.3. 字符串分割"></a>7.3. 字符串分割</h3><p><strong>Split</strong></p><ul><li>根据某字符串分割</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr := strings.Split(<span class="string">&quot;a,b,c&quot;</span>, <span class="string">&quot;,&quot;</span>)	<span class="comment">// [a b c]</span></span><br></pre></td></tr></table></figure><p><strong>Fields</strong></p><ul><li>根据空格分割，多个空格视为一个</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr := strings.Fields(<span class="string">&quot;a b  c   d&quot;</span>) <span class="comment">// [a b c d]</span></span><br></pre></td></tr></table></figure><h3 id="7-4-字符串比较"><a href="#7-4-字符串比较" class="headerlink" title="7.4. 字符串比较"></a>7.4. 字符串比较</h3><p><strong>Compare</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> strings.Compare(event1[<span class="number">1</span>], event2[<span class="number">0</span>]) &lt; <span class="number">0</span> &#123;</span><br><span class="line">	<span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-encoding-hex-十六进制操作库"><a href="#8-encoding-hex-十六进制操作库" class="headerlink" title="8. encoding&#x2F;hex 十六进制操作库"></a>8. encoding&#x2F;hex 十六进制操作库</h2><h3 id="8-1-将十六进制字符串转成数组"><a href="#8-1-将十六进制字符串转成数组" class="headerlink" title="8.1. 将十六进制字符串转成数组"></a>8.1. 将十六进制字符串转成数组</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr, err := hex.DecodeString(<span class="string">&quot;aabbcc&quot;</span>)	<span class="comment">// [170 187 204]</span></span><br></pre></td></tr></table></figure><h3 id="8-2-将-byte按照十六进制打印成字符串"><a href="#8-2-将-byte按照十六进制打印成字符串" class="headerlink" title="8.2. 将[]byte按照十六进制打印成字符串"></a>8.2. 将[]byte按照十六进制打印成字符串</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexStr := hex.EncodeToString([]<span class="type">byte</span>(<span class="string">&quot;123456&quot;</span>))	<span class="comment">// 313233343536</span></span><br></pre></td></tr></table></figure><h2 id="9-io-ioutil-io操作（到go1-16之后可以使用io或os库替代）"><a href="#9-io-ioutil-io操作（到go1-16之后可以使用io或os库替代）" class="headerlink" title="9. io&#x2F;ioutil io操作（到go1.16之后可以使用io或os库替代）"></a>9. io&#x2F;ioutil io操作（到go1.16之后可以使用io或os库替代）</h2><h3 id="9-1-文件读取"><a href="#9-1-文件读取" class="headerlink" title="9.1. 文件读取"></a>9.1. 文件读取</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contentBytes, err := ioutil.ReadFile(<span class="string">&quot;/a/b/c.txt&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="10-os-系统操作"><a href="#10-os-系统操作" class="headerlink" title="10. os 系统操作"></a>10. os 系统操作</h2><h3 id="10-1-目录操作"><a href="#10-1-目录操作" class="headerlink" title="10.1. 目录操作"></a>10.1. 目录操作</h3><h4 id="1-基本操作"><a href="#1-基本操作" class="headerlink" title="1) 基本操作"></a>1) 基本操作</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断目录是否存在</span></span><br><span class="line">_, err := os.Stat(<span class="string">&quot;./&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; os.IsNotExist(err) &#123;</span><br><span class="line">	<span class="comment">// 目录不存在</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前二进制执行路径</span></span><br><span class="line">execFilePath, _ := os.Executable()</span><br><span class="line">fmt.Println(execFilePath)	<span class="comment">// /home/xxx/local/go/tools/tool</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取temp目录路径</span></span><br><span class="line">os.TempDir()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换工作目录</span></span><br><span class="line">err := os.Chdir(<span class="string">&quot;/tmp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建目录</span></span><br><span class="line">err := os.Mkdir(currentPath+<span class="string">&quot;/tmp&quot;</span>, <span class="number">0777</span>)			<span class="comment">// 类似mkdir xxx/tmp</span></span><br><span class="line">err := os.MkdirAll(currentPath+<span class="string">&quot;/tmp/a/b&quot;</span>, <span class="number">0777</span>)	<span class="comment">// 类似mkdir -p xxx/tmp/a/b</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除目录</span></span><br><span class="line">err := os.Remove(currentPath + <span class="string">&quot;/tmp&quot;</span>)		<span class="comment">// 删除文件或空文件夹</span></span><br><span class="line">err := os.RemoveAll(currentPath + <span class="string">&quot;/tmp&quot;</span>)	<span class="comment">// 删除目录及其子目录</span></span><br></pre></td></tr></table></figure><h3 id="10-2-文件操作"><a href="#10-2-文件操作" class="headerlink" title="10.2. 文件操作"></a>10.2. 文件操作</h3><h4 id="1-整个文件读取"><a href="#1-整个文件读取" class="headerlink" title="1) 整个文件读取"></a>1) 整个文件读取</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contentBytes, err := os.ReadFile(<span class="string">&quot;/a/b/c.txt&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="2-按行读取"><a href="#2-按行读取" class="headerlink" title="2) 按行读取"></a>2) 按行读取</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *defaultParser)</span></span> ParseFile(filePath <span class="type">string</span>, handler <span class="function"><span class="keyword">func</span><span class="params">(log <span class="type">string</span>)</span></span>) &#123;</span><br><span class="line">	f, err := os.Open(filePath)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">	rd := bufio.NewReader(f)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		line, err := rd.ReadString(<span class="string">&#x27;\n&#x27;</span>) <span class="comment">//以&#x27;\n&#x27;为结束符读入一行</span></span><br><span class="line">		fmt.Println(line)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> || io.EOF == err &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-写入文件"><a href="#3-写入文件" class="headerlink" title="3) 写入文件"></a>3) 写入文件</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	f, err := os.OpenFile(outpath, os.O_WRONLY|os.O_CREATE, <span class="number">0644</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line">	nw, err := f.Write(buf.Bytes())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> nw != buf.Len() &#123;</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Errorf(<span class="string">&quot;need to write %d, but write %d&quot;</span>, buf.Len(), nw))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-stronv"><a href="#11-stronv" class="headerlink" title="11. stronv"></a>11. stronv</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 使用ParseFloat解析浮点数，64是说明使用多少位</span></span><br><span class="line">    <span class="comment">// 精度来解析</span></span><br><span class="line">    f, _ := strconv.ParseFloat(<span class="string">&quot;1.234&quot;</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对于ParseInt函数，0 表示从字符串推断整型进制，</span></span><br><span class="line">    <span class="comment">// 则表示返回结果的位数</span></span><br><span class="line">    i, _ := strconv.ParseInt(<span class="string">&quot;123&quot;</span>, <span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(i)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ParseInt能够解析出16进制的数字</span></span><br><span class="line">    d, _ := strconv.ParseInt(<span class="string">&quot;0x1c8&quot;</span>, <span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(d)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 还可以使用ParseUint函数</span></span><br><span class="line">    u, _ := strconv.ParseUint(<span class="string">&quot;789&quot;</span>, <span class="number">0</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Println(u)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Atoi是解析10进制整型的快捷方法</span></span><br><span class="line">    k, _ := strconv.Atoi(<span class="string">&quot;135&quot;</span>)</span><br><span class="line">    fmt.Println(k)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析函数在遇到无法解析的输入时，会返回错误</span></span><br><span class="line">    _, e := strconv.Atoi(<span class="string">&quot;wat&quot;</span>)</span><br><span class="line">    fmt.Println(e)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-net-网络库"><a href="#12-net-网络库" class="headerlink" title="12. net 网络库"></a>12. net 网络库</h2><h3 id="12-1-udp发送和接收"><a href="#12-1-udp发送和接收" class="headerlink" title="12.1. udp发送和接收"></a>12.1. udp发送和接收</h3><p><strong>客户端</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line">	<span class="keyword">if</span> flag.NArg() &lt; <span class="number">2</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;Must input 2 params&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	serverAddr := flag.Arg(<span class="number">0</span>)</span><br><span class="line">	filePath := flag.Arg(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;client, serverAddr: %s, filePath: %s\r\n&quot;</span>, serverAddr, filePath)</span><br><span class="line"></span><br><span class="line">	conn, err := net.Dial(<span class="string">&quot;udp&quot;</span>, serverAddr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">	f, err := os.Open(filePath)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">	buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">50</span>*<span class="number">1024</span>)</span><br><span class="line">	count := <span class="number">0</span></span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		n, err := f.Read(buf)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err == io.EOF &#123;</span><br><span class="line">				<span class="keyword">break</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				log.Fatalln(err)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		sendSize, err := conn.Write(buf[:n])</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line">		count += sendSize</span><br><span class="line"></span><br><span class="line">		msg := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">128</span>)</span><br><span class="line">		_, err = conn.Read(msg)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatalln(err)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		fmt.Printf(<span class="string">&quot;%d, Send %d, check %s\r\n&quot;</span>, i, n, <span class="type">string</span>(msg))</span><br><span class="line">		i++</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Send %s to %s success, size %d&quot;</span>, serverAddr, filePath, count)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>服务端</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;flag&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	flag.Parse()</span><br><span class="line">	<span class="keyword">if</span> flag.NArg() &lt; <span class="number">2</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;Must input 2 params&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	serverAddr := flag.Arg(<span class="number">0</span>)</span><br><span class="line">	filePath := flag.Arg(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hello, main, serverAddr: %s, filePath: %s\r\n&quot;</span>, serverAddr, filePath)</span><br><span class="line"></span><br><span class="line">	f, err := os.Create(filePath)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">	addr, err := net.ResolveUDPAddr(<span class="string">&quot;udp&quot;</span>, serverAddr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	conn, err := net.ListenUDP(<span class="string">&quot;udp&quot;</span>, addr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line"></span><br><span class="line">	i := <span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		data := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">100</span>*<span class="number">1024</span>)</span><br><span class="line">		n, rAddr, err := conn.ReadFromUDP(data)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		fmt.Printf(<span class="string">&quot;%d, Recieved from %s size %d\r\n&quot;</span>, i, rAddr.String(), n)</span><br><span class="line"></span><br><span class="line">		f.Write(data[:n])</span><br><span class="line">		i++</span><br><span class="line"></span><br><span class="line">		_, err = conn.WriteToUDP([]<span class="type">byte</span>(fmt.Sprintf(<span class="string">&quot;%d&quot;</span>, n)), rAddr)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="12-2-给socket设置opt"><a href="#12-2-给socket设置opt" class="headerlink" title="12.2. 给socket设置opt"></a>12.2. 给socket设置opt</h3><h4 id="1-普通类型设置"><a href="#1-普通类型设置" class="headerlink" title="1) 普通类型设置"></a>1) 普通类型设置</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-自定义结构体设置"><a href="#2-自定义结构体设置" class="headerlink" title="2) 自定义结构体设置"></a>2) 自定义结构体设置</h4><ul><li>设置sockaddr结构体</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	...</span><br><span class="line">	dialer := &amp;net.Dialer&#123;</span><br><span class="line">		Control: <span class="function"><span class="keyword">func</span><span class="params">(network, address <span class="type">string</span>, c syscall.RawConn)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> c.Control(<span class="function"><span class="keyword">func</span><span class="params">(fd <span class="type">uintptr</span>)</span></span> &#123;</span><br><span class="line">				<span class="keyword">type</span> sockaddr <span class="keyword">struct</span> &#123;</span><br><span class="line">					family  <span class="type">uint16</span></span><br><span class="line">					port    <span class="type">uint16</span></span><br><span class="line">					addr    [<span class="number">4</span>]<span class="type">byte</span></span><br><span class="line">					sinZero [<span class="number">20</span>]<span class="type">byte</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 自定义结构体</span></span><br><span class="line">				addr := &amp;sockaddr&#123;</span><br><span class="line">					family: unix.AF_INET,</span><br><span class="line">					addr:   netip.MustParseAddr(<span class="string">&quot;1.2.3.4&quot;</span>).As4(),</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				cmd := <span class="number">0x248</span>	<span class="comment">// 自定义命令</span></span><br><span class="line">				_, _, e1 := unix.Syscall6(unix.SYS_SETSOCKOPT, fd, <span class="type">uintptr</span>(unix.IPPROTO_IP), <span class="type">uintptr</span>(cmd), <span class="type">uintptr</span>(unsafe.Pointer(addr)), unsafe.Sizeof(*addr), <span class="number">0</span>)</span><br><span class="line">				<span class="keyword">if</span> e1 != <span class="number">0</span> &#123;</span><br><span class="line">					<span class="built_in">panic</span>(e1.Error())</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	conn, err := dialer.Dial(<span class="string">&quot;tcp&quot;</span>, addr)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> conn.Close()</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-time-时间库"><a href="#13-time-时间库" class="headerlink" title="13. time 时间库"></a>13. time 时间库</h2><h3 id="13-1-基本操作"><a href="#13-1-基本操作" class="headerlink" title="13.1. 基本操作"></a>13.1. 基本操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 秒级时间戳</span></span><br><span class="line">	timestampS := time.Now().Unix()</span><br><span class="line">	<span class="comment">// 当前时间向前一天</span></span><br><span class="line">	yestoday := time.Now().Add(<span class="number">-24</span> * time.Hour)</span><br><span class="line">	<span class="comment">// 时间距离当前多久，不受系统时间变化而变化</span></span><br><span class="line">	du := time.Since(yestoday)</span><br><span class="line">	<span class="comment">// 当前到此时间经过多久，不受系统时间变化而变化</span></span><br><span class="line">	du := time.Util(yestoday)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="13-2-时钟说明"><a href="#13-2-时钟说明" class="headerlink" title="13.2. 时钟说明"></a>13.2. 时钟说明</h3><p>参考 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/341768740">go中使用单调时钟获得准确的时间间隔</a></p><ul><li>time结构体记录了墙上时间和单调时间</li><li>使用<code>time.Now()</code>获取的会保存墙上时间和单调时间一起，计算Since的时候会使用单调时间进行计算</li><li>使用时间字符串得到的不会有单调时间，会随着系统时间变化而变化</li></ul><h2 id="14-sort-排序"><a href="#14-sort-排序" class="headerlink" title="14. sort 排序"></a>14. sort 排序</h2><h3 id="14-1-基本类型排序"><a href="#14-1-基本类型排序" class="headerlink" title="14.1. 基本类型排序"></a>14.1. 基本类型排序</h3><h4 id="1-升序"><a href="#1-升序" class="headerlink" title="1) 升序"></a>1) 升序</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> queryKeyList []<span class="type">string</span></span><br><span class="line">	<span class="keyword">var</span> intList []<span class="type">int</span></span><br><span class="line"></span><br><span class="line">	sort.Strings(queryKeyList)</span><br><span class="line">	sort.Ints(intList)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-降序"><a href="#2-降序" class="headerlink" title="2) 降序"></a>2) 降序</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	testArr := []<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">8</span>&#125;</span><br><span class="line"></span><br><span class="line">	sort.Sort(sort.Reverse(sort.IntSlice(testArr)))</span><br><span class="line">	fmt.Println(testArr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>解释一下上面的代码，<code>sort.IntSlice(testArr)</code>是将<code>[]int</code>强转成<code>sort.IntSlice</code>类型，类型定义了sort需要的三个函数，本质上还是<code>[]int</code></li><li><code>sort.IntSlice</code>是<code>sort.Interface</code>的一个子类实现</li><li><code>sort.Reverse(xxx)</code>将传入的<code>sort.Interface</code>转成<code>sort.reverse</code>类型返回</li><li>同样<code>sort.reverse</code>也是<code>sort.Interface</code>的一个子类实现，将<code>Less()</code>方法重写，反着调用原方法</li><li><code>sort.Sort()</code>将<code>sort.Interface</code>进行排序</li></ul><h3 id="14-2-二分查找"><a href="#14-2-二分查找" class="headerlink" title="14.2. 二分查找"></a>14.2. 二分查找</h3><h4 id="1-普通类型"><a href="#1-普通类型" class="headerlink" title="1) 普通类型"></a>1) 普通类型</h4><ul><li>sort包提供两个函数进行二分查找，并提供了一些基本类型的查找</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sort&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 二分查找从最左边开始的第一个满足条件的索引</span></span><br><span class="line">	fmt.Println(sort.Search(<span class="built_in">len</span>(a), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123; <span class="keyword">return</span> a[i] &gt;= <span class="number">2</span> &#125;)) <span class="comment">// 1</span></span><br><span class="line">	<span class="comment">// 二分查找从最左边开始第一个 func(i) &lt;= 0 的索引，并返回对应索引是否 func(i) == 0</span></span><br><span class="line">	fmt.Println(sort.Find(<span class="built_in">len</span>(a), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">int</span> &#123; <span class="keyword">return</span> <span class="number">3</span> - a[i] &#125;)) <span class="comment">// 3, false</span></span><br><span class="line">	<span class="comment">// 基本类型可以直接调用，但是只支持升序的slice</span></span><br><span class="line">	<span class="comment">// 源码就是调用 sort.Search(len(a), func(i int) bool &#123; return a[i] &gt;= 2 &#125;</span></span><br><span class="line">	fmt.Println(sort.SearchInts(a, <span class="number">2</span>)) <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-字符串使用strings-Compare"><a href="#2-字符串使用strings-Compare" class="headerlink" title="2) 字符串使用strings.Compare()"></a>2) 字符串使用<code>strings.Compare()</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	all := []<span class="type">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 升序</span></span><br><span class="line">	sort.Slice(all, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> strings.Compare(all[i], all[j]) &lt; <span class="number">0</span></span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println(all)</span><br><span class="line">	fmt.Println(sort.Find(<span class="built_in">len</span>(all), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">		<span class="comment">// 升序，要查找的字符串放前面</span></span><br><span class="line">		<span class="keyword">return</span> strings.Compare(<span class="string">&quot;c&quot;</span>, all[i])</span><br><span class="line">	&#125;))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 降序</span></span><br><span class="line">	sort.Slice(all, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> strings.Compare(all[i], all[j]) &gt; <span class="number">0</span></span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println(all)</span><br><span class="line">	fmt.Println(sort.Find(<span class="built_in">len</span>(all), <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">		<span class="comment">// 降序，要查找的字符串放后面</span></span><br><span class="line">		<span class="keyword">return</span> strings.Compare(all[i], <span class="string">&quot;c&quot;</span>)</span><br><span class="line">	&#125;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-3-任意类型的slice排序"><a href="#14-3-任意类型的slice排序" class="headerlink" title="14.3. 任意类型的slice排序"></a>14.3. 任意类型的slice排序</h3><h4 id="1-数字类型"><a href="#1-数字类型" class="headerlink" title="1) 数字类型"></a>1) 数字类型</h4><ul><li>直接使用<code>sort.Slice</code>排序，需要实现Less的函数</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> item <span class="keyword">struct</span> &#123;</span><br><span class="line">	val, count <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line">itemSlice := <span class="built_in">make</span>([]item, <span class="number">10</span>)</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 为true，i向前；false，j向前。要满足相等时返回false</span></span><br><span class="line">sort.Slice(itemSlice, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123; <span class="keyword">return</span> itemSlice[i].val &lt; itemSlice[j].val &#125;)</span><br></pre></td></tr></table></figure><h4 id="2-字符串类型"><a href="#2-字符串类型" class="headerlink" title="2) 字符串类型"></a>2) 字符串类型</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	all := []<span class="type">string</span>&#123;<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>&#125;</span><br><span class="line">	sort.Slice(all, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="type">int</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">		<span class="comment">// 升序就是小于0</span></span><br><span class="line">		<span class="comment">// 降序就是大于0</span></span><br><span class="line">		<span class="keyword">return</span> strings.Compare(all[i], all[j]) &lt; <span class="number">0</span></span><br><span class="line">	&#125;)</span><br><span class="line">	fmt.Println(all)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-4-自定义类型排序"><a href="#14-4-自定义类型排序" class="headerlink" title="14.4. 自定义类型排序"></a>14.4. 自定义类型排序</h3><ul><li>需要定义一个类型的三个接口，然后调用<code>sort.Sort</code>即可</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> NameSlice <span class="keyword">struct</span> &#123;</span><br><span class="line">	names   []<span class="type">string</span></span><br><span class="line">	heights []<span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x NameSlice)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(x.names) &#125;</span><br><span class="line"><span class="comment">// 为true，i向前；false，j向前。要满足相等时返回false</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x NameSlice)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> x.heights[i] &gt; x.heights[j] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x NameSlice)</span></span> Swap(i, j <span class="type">int</span>) &#123;</span><br><span class="line">	x.heights[i], x.heights[j] = x.heights[j], x.heights[i]</span><br><span class="line">	x.names[i], x.names[j] = x.names[j], x.names[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sortPeople</span><span class="params">(names []<span class="type">string</span>, heights []<span class="type">int</span>)</span></span> []<span class="type">string</span> &#123;</span><br><span class="line">	tmp := NameSlice&#123;</span><br><span class="line">		names:   names,</span><br><span class="line">		heights: heights,</span><br><span class="line">	&#125;</span><br><span class="line">	sort.Sort(tmp)</span><br><span class="line">	<span class="keyword">return</span> tmp.names</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="14-5-sort内置类型"><a href="#14-5-sort内置类型" class="headerlink" title="14.5. sort内置类型"></a>14.5. sort内置类型</h3><ul><li>sort内置了几个基本类型的slice，实现了几个方法，可以直接用，如IntSlice</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /usr/lib/go/src/sort/sort.go</span></span><br><span class="line"><span class="comment">// IntSlice attaches the methods of Interface to []int, sorting in increasing order.</span></span><br><span class="line"><span class="keyword">type</span> IntSlice []<span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x IntSlice)</span></span> Len() <span class="type">int</span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(x) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x IntSlice)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123; <span class="keyword">return</span> x[i] &lt; x[j] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x IntSlice)</span></span> Swap(i, j <span class="type">int</span>)      &#123; x[i], x[j] = x[j], x[i] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sort is a convenience method: x.Sort() calls Sort(x).</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x IntSlice)</span></span> Sort() &#123; Sort(x) &#125;</span><br></pre></td></tr></table></figure><h2 id="15-image-图像库"><a href="#15-image-图像库" class="headerlink" title="15. image 图像库"></a>15. image 图像库</h2><h3 id="15-1-png处理"><a href="#15-1-png处理" class="headerlink" title="15.1. png处理"></a>15.1. png处理</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;image&quot;</span></span><br><span class="line">	<span class="string">&quot;image/color&quot;</span></span><br><span class="line">	<span class="string">&quot;image/png&quot;</span>		<span class="comment">// 包含这个才能解析png图片</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	originByte, _ := ioutil.ReadFile(<span class="string">&quot;./test.png&quot;</span>)</span><br><span class="line">	originBuffer := bytes.NewBuffer(originByte)</span><br><span class="line">	originImg, filename, err := image.Decode(originBuffer)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err.Error()</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(filename)	<span class="comment">// png</span></span><br><span class="line">	imgBounds := img.Bounds()</span><br><span class="line">	imgX := imgBounds.Dx()		<span class="comment">// 宽度</span></span><br><span class="line">	imgY := imgBounds.Dy()		<span class="comment">// 高度</span></span><br><span class="line"></span><br><span class="line">	firstRgba := img.At(<span class="number">0</span>, <span class="number">0</span>)	<span class="comment">// 获取一个位置的像素点</span></span><br><span class="line">	r, g, b, a := firstRgba.RGBA()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建一个新的图片，范围是100x100</span></span><br><span class="line">	newImg := image.NewRGBA(image.Rectangle&#123;</span><br><span class="line">		Min: image.Point&#123;X: <span class="number">0</span>, Y: <span class="number">0</span>&#125;,</span><br><span class="line">		Max: image.Point&#123;X: <span class="number">100</span>, Y: <span class="number">100</span>&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="comment">// 坐标 (5, 5) 涂黑</span></span><br><span class="line">	newImg.SetRGBA(<span class="number">5</span>, <span class="number">5</span>, color.RGBA&#123;</span><br><span class="line">		R: <span class="number">0</span>,</span><br><span class="line">		B: <span class="number">0</span>,</span><br><span class="line">		G: <span class="number">0</span>,</span><br><span class="line">		A: <span class="number">255</span>,		<span class="comment">// 不透明</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 保存到output.png</span></span><br><span class="line">	f, _ := os.Create(<span class="string">&quot;./output.png&quot;</span>)</span><br><span class="line">	png.Encode(f, newImg)</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="16-container-list-双向链表"><a href="#16-container-list-双向链表" class="headerlink" title="16. container&#x2F;list 双向链表"></a>16. container&#x2F;list 双向链表</h2><ul><li>value可以是任意类型的值</li><li><strong><font color="red">list本身不能拷贝，因为里面的element有一个指针指向root的地址，如果拷贝，root会被复制一份，将会导致element失效</font></strong></li><li>需要将list放到结构体时，建议使用指针放置</li></ul><h3 id="16-1-基本操作"><a href="#16-1-基本操作" class="headerlink" title="16.1. 基本操作"></a>16.1. 基本操作</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">tmp := list.New()</span><br><span class="line">tmp.PushBack(<span class="number">1</span>)  <span class="comment">// 向后插入</span></span><br><span class="line">tmp.PushFront(<span class="number">3</span>) <span class="comment">// 向前插入</span></span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">for</span> e := tmp.Front(); e != <span class="literal">nil</span>; e = e.Next() &#123;</span><br><span class="line">	fmt.Println(e.Value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="keyword">for</span> e := tmp.Front(); e != <span class="literal">nil</span>; e = e.Next() &#123;</span><br><span class="line">	<span class="keyword">if</span> e.Value == <span class="number">3</span> &#123;</span><br><span class="line">		tmp.Remove(e)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 中间插入</span></span><br><span class="line"><span class="keyword">for</span> e := tmp.Front(); e != <span class="literal">nil</span>; e = e.Next() &#123;</span><br><span class="line">	<span class="keyword">if</span> e.Value == <span class="number">3</span> &#123;</span><br><span class="line">		<span class="comment">// 向后插入</span></span><br><span class="line">		tmp.InsertAfter(<span class="number">1</span>, e)</span><br><span class="line">		<span class="comment">// 向前插入</span></span><br><span class="line">		tmp.InsertBefore(<span class="number">2</span>, e)</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="踩坑记"><a href="#踩坑记" class="headerlink" title="踩坑记"></a>踩坑记</h3><h4 id="1-list放到结构体里面一定要注意结构体拷贝的问题，建议在结构体里面使用指针"><a href="#1-list放到结构体里面一定要注意结构体拷贝的问题，建议在结构体里面使用指针" class="headerlink" title="1) list放到结构体里面一定要注意结构体拷贝的问题，建议在结构体里面使用指针"></a>1) list放到结构体里面一定要注意结构体拷贝的问题，建议在结构体里面使用指针</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> test <span class="keyword">struct</span> &#123;</span><br><span class="line">	head list.List</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	tmp := test&#123;&#125;</span><br><span class="line">	tmp.head.PushFront(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">	tmp2 := tmp	<span class="comment">// 拷贝会导致里面的元素的root指向错误，导致下面的插入语句错误</span></span><br><span class="line">	tmp2.head.InsertAfter(<span class="number">2</span>, tmp2.head.Front())</span><br><span class="line">	<span class="comment">// 这里打印只有一个1，前面的插入失效</span></span><br><span class="line">	<span class="keyword">for</span> e := tmp2.head.Front(); e != <span class="literal">nil</span>; e = e.Next() &#123;</span><br><span class="line">		fmt.Println(e.Value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>原因从源码查看</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/container/list/list.go</span></span><br><span class="line"><span class="comment">// Element is an element of a linked list.</span></span><br><span class="line"><span class="keyword">type</span> Element <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Next and previous pointers in the doubly-linked list of elements.</span></span><br><span class="line">	<span class="comment">// To simplify the implementation, internally a list l is implemented</span></span><br><span class="line">	<span class="comment">// as a ring, such that &amp;l.root is both the next element of the last</span></span><br><span class="line">	<span class="comment">// list element (l.Back()) and the previous element of the first list</span></span><br><span class="line">	<span class="comment">// element (l.Front()).</span></span><br><span class="line">	next, prev *Element</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The list to which this element belongs.</span></span><br><span class="line">	list *List</span><br><span class="line"></span><br><span class="line">	<span class="comment">// The value stored with this element.</span></span><br><span class="line">	Value any</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// List represents a doubly linked list.</span></span><br><span class="line"><span class="comment">// The zero value for List is an empty list ready to use.</span></span><br><span class="line"><span class="keyword">type</span> List <span class="keyword">struct</span> &#123;</span><br><span class="line">	root Element <span class="comment">// sentinel list element, only &amp;root, root.prev, and root.next are used</span></span><br><span class="line">	<span class="built_in">len</span>  <span class="type">int</span>     <span class="comment">// current list length excluding (this) sentinel element</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// InsertAfter inserts a new element e with value v immediately after mark and returns e.</span></span><br><span class="line"><span class="comment">// If mark is not an element of l, the list is not modified.</span></span><br><span class="line"><span class="comment">// The mark must not be nil.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span></span> InsertAfter(v any, mark *Element) *Element &#123;</span><br><span class="line">	<span class="keyword">if</span> mark.list != l &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// see comment in List.Remove about initialization of l</span></span><br><span class="line">	<span class="keyword">return</span> l.insertValue(v, mark)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>上面的Element里面有一个变量list指向root的地址，也就是下面InsertAfter判断的值</li><li>当进行了拷贝之后，root本身是拷贝的，地址处于新的地址上，里面的元素的list还指向拷贝前的地址，自然和当前不相等，就会插入失败</li><li>解决办法就是使用指针，这样拷贝的是指针，里面的内容不会变化</li><li>上面的写法只是实例，实际场景经常会出现在构造函数构造完元素后返回了一个拷贝，如下面的错误写法</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Allocator <span class="keyword">struct</span> &#123;</span><br><span class="line">	memMap  list.List</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(n <span class="type">int</span>)</span></span> Allocator &#123;</span><br><span class="line">	res := Allocator&#123;&#125;</span><br><span class="line">	res.memMap.PushFront(<span class="number">1</span>)</span><br><span class="line">	<span class="comment">// 返回拷贝，外层拷贝时将memMap的内容拷贝过去，导致元素的list失效</span></span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="17-runtime-一些运行需要的变量和方法"><a href="#17-runtime-一些运行需要的变量和方法" class="headerlink" title="17. runtime 一些运行需要的变量和方法"></a>17. runtime 一些运行需要的变量和方法</h2><h3 id="17-1-常用变量"><a href="#17-1-常用变量" class="headerlink" title="17.1. 常用变量"></a>17.1. 常用变量</h3><h4 id="1-runtime-GOOS-操作系统类型"><a href="#1-runtime-GOOS-操作系统类型" class="headerlink" title="1) runtime.GOOS 操作系统类型"></a>1) runtime.GOOS 操作系统类型</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> runtime.GOOS &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;windows&quot;</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;windows&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;linux&quot;</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;linux&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;darwin&quot;</span>:</span><br><span class="line">		fmt.Println(<span class="string">&quot;mac&quot;</span>)</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		log.Fatalln(<span class="string">&quot;unsupported os&quot;</span>, runtime.GOOS)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="18-io-io相关操作"><a href="#18-io-io相关操作" class="headerlink" title="18. io io相关操作"></a>18. io io相关操作</h2><h2 id="19-regexp-正则库"><a href="#19-regexp-正则库" class="headerlink" title="19. regexp 正则库"></a>19. regexp 正则库</h2><h3 id="19-1-提取字符串"><a href="#19-1-提取字符串" class="headerlink" title="19.1. 提取字符串"></a>19.1. 提取字符串</h3><ul><li>括号内的是要提取的字符串，输出为整体匹配到的字符串加括号匹配的字符串</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRegexDefault</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	line := <span class="string">&quot;[2022-12-26 18:49:24.631][ 25160:  6372][ info][aaa][bbb]testhhh\r\n&quot;</span></span><br><span class="line"></span><br><span class="line">	defaultRegexStr := <span class="string">`^\[(20[0-9]&#123;2&#125;-[0-9]&#123;2&#125;-[0-9]&#123;2&#125; [0-9]&#123;2&#125;:[0-9]&#123;2&#125;:[0-9]&#123;2&#125;\.[0-9]&#123;3&#125;)\]\[[ ]*(\w+):[ ]*(\w+)\]\[[ ]*(\w+)\]\[(\w+)\]\[[^\]]*\](.*)`</span></span><br><span class="line">	matchRegex := regexp.MustCompile(defaultRegexStr)</span><br><span class="line">	params := matchRegex.FindStringSubmatch(line)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(params) == <span class="number">0</span> &#123;</span><br><span class="line">		t.Fatal(defaultRegexStr, <span class="string">&quot; parse failed, params &quot;</span>, params)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(params)	<span class="comment">// [&quot;[2022-12-26 18:49:24.631][ 25160:  6372][ info][aaa][bbb]testhhh\r&quot; &quot;2022-12-26&quot; &quot;18:49:24.631&quot; &quot;25160&quot; &quot;6372&quot; &quot;info&quot; &quot;aaa&quot; &quot;testhhh&quot;]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="20-archive-zip-zip相关操作"><a href="#20-archive-zip-zip相关操作" class="headerlink" title="20. archive&#x2F;zip zip相关操作"></a>20. archive&#x2F;zip zip相关操作</h2><h3 id="20-1-解压缩"><a href="#20-1-解压缩" class="headerlink" title="20.1. 解压缩"></a>20.1. 解压缩</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">unzip</span><span class="params">(zipFile <span class="type">string</span>, destDir <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	zipReader, err := zip.OpenReader(zipFile)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> zipReader.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, f := <span class="keyword">range</span> zipReader.File &#123;</span><br><span class="line">		fpath := filepath.Join(destDir, f.Name)</span><br><span class="line">		<span class="keyword">if</span> f.FileInfo().IsDir() &#123;</span><br><span class="line">			os.MkdirAll(fpath, os.ModePerm)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err = os.MkdirAll(filepath.Dir(fpath), os.ModePerm); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> err</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			inFile, err := f.Open()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> err</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">defer</span> inFile.Close()</span><br><span class="line"></span><br><span class="line">			outFile, err := os.OpenFile(fpath, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, f.Mode())</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> err</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">defer</span> outFile.Close()</span><br><span class="line"></span><br><span class="line">			_, err = io.Copy(outFile, inFile)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> err</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="20-2-压缩"><a href="#20-2-压缩" class="headerlink" title="20.2. 压缩"></a>20.2. 压缩</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// srcFile could be a single file or a directory</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Zip</span><span class="params">(srcFile <span class="type">string</span>, destZip <span class="type">string</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">    zipfile, err := os.Create(destZip)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> zipfile.Close()</span><br><span class="line"></span><br><span class="line">    archive := zip.NewWriter(zipfile)</span><br><span class="line">    <span class="keyword">defer</span> archive.Close()</span><br><span class="line"></span><br><span class="line">    filepath.Walk(srcFile, <span class="function"><span class="keyword">func</span><span class="params">(path <span class="type">string</span>, info os.FileInfo, err <span class="type">error</span>)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        header, err := zip.FileInfoHeader(info)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        header.Name = strings.TrimPrefix(path, filepath.Dir(srcFile) + <span class="string">&quot;/&quot;</span>)</span><br><span class="line">        <span class="comment">// header.Name = path</span></span><br><span class="line">        <span class="keyword">if</span> info.IsDir() &#123;</span><br><span class="line">            header.Name += <span class="string">&quot;/&quot;</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            header.Method = zip.Deflate</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        writer, err := archive.CreateHeader(header)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ! info.IsDir() &#123;</span><br><span class="line">            file, err := os.Open(path)</span><br><span class="line">            <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> err</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">defer</span> file.Close()</span><br><span class="line">            _, err = io.Copy(writer, file)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="21-exec-执行命令"><a href="#21-exec-执行命令" class="headerlink" title="21. exec 执行命令"></a>21. exec 执行命令</h2><h3 id="21-1-打开浏览器"><a href="#21-1-打开浏览器" class="headerlink" title="21.1. 打开浏览器"></a>21.1. 打开浏览器</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">openBrowser</span><span class="params">(url <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	command := <span class="string">&quot;&quot;</span></span><br><span class="line">	args := []<span class="type">string</span>&#123;&#125;</span><br><span class="line">	<span class="keyword">switch</span> runtime.GOOS &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;windows&quot;</span>:</span><br><span class="line">		command = <span class="string">&quot;start&quot;</span></span><br><span class="line">		args = <span class="built_in">append</span>(args, <span class="string">&quot;/c&quot;</span>)</span><br><span class="line">		args = <span class="built_in">append</span>(args, <span class="string">&quot;start&quot;</span>)</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;linux&quot;</span>:</span><br><span class="line">		command = <span class="string">&quot;xdg-open&quot;</span></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&quot;darwin&quot;</span>:</span><br><span class="line">		command = <span class="string">&quot;open&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">	args = <span class="built_in">append</span>(args, url)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;exec&quot;</span>, command, args)</span><br><span class="line">	cmd := exec.Command(command, args...)</span><br><span class="line">	cmd.Start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="22-heap-堆"><a href="#22-heap-堆" class="headerlink" title="22. heap 堆"></a>22. heap 堆</h2><h3 id="22-1-小根堆"><a href="#22-1-小根堆" class="headerlink" title="22.1. 小根堆"></a>22.1. 小根堆</h3><ul><li>基础类型小根堆直接使用<code>sort.IntSlice</code>等可以实现</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> lhp <span class="keyword">struct</span>&#123; sort.IntSlice &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *lhp)</span></span> Push(x <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	l.IntSlice = <span class="built_in">append</span>(l.IntSlice, x.(<span class="type">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *lhp)</span></span> Pop() <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(l.IntSlice)</span><br><span class="line">	x := l.IntSlice[n<span class="number">-1</span>]</span><br><span class="line">	l.IntSlice = l.IntSlice[:n<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>上面代码大致解释就是，使用hp继承<code>sort.IntSlice</code>的各种基础方法</li><li>实现Push和Pop两个接口即可实现最小堆</li></ul><h3 id="22-2-大根堆"><a href="#22-2-大根堆" class="headerlink" title="22.2. 大根堆"></a>22.2. 大根堆</h3><ul><li>照抄小根堆，然后将Less重写一下就好了，j和i互调顺序</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> bhp <span class="keyword">struct</span>&#123; sort.IntSlice &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *bhp)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> l.IntSlice.Less(j, i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *bhp)</span></span> Push(x <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	l.IntSlice = <span class="built_in">append</span>(l.IntSlice, x.(<span class="type">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *bhp)</span></span> Pop() <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(l.IntSlice)</span><br><span class="line">	x := l.IntSlice[n<span class="number">-1</span>]</span><br><span class="line">	l.IntSlice = l.IntSlice[:n<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="23-context"><a href="#23-context" class="headerlink" title="23. context"></a>23. context</h2><h3 id="23-1-关闭子协程的方式"><a href="#23-1-关闭子协程的方式" class="headerlink" title="23.1. 关闭子协程的方式"></a>23.1. 关闭子协程的方式</h3><h4 id="1-手动关闭协程"><a href="#1-手动关闭协程" class="headerlink" title="1) 手动关闭协程"></a>1) 手动关闭协程</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fatherCtx := context.Background()</span><br><span class="line">	childCtx, cancelChild := context.WithCancel(fatherCtx)</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-childCtx.Done():</span><br><span class="line">				fmt.Println(<span class="string">&quot;exit because:&quot;</span>, context.Cause(childCtx))</span><br><span class="line">				wg.Done()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Millisecond):</span><br><span class="line">				fmt.Println(<span class="string">&quot;begin do something&quot;</span>)</span><br><span class="line">				<span class="comment">// 模拟函数执行了5s</span></span><br><span class="line">				time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">	cancelChild()</span><br><span class="line">	fmt.Println(<span class="string">&quot;notify child quit done&quot;</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-定点关闭协程"><a href="#2-定点关闭协程" class="headerlink" title="2) 定点关闭协程"></a>2) 定点关闭协程</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fatherCtx := context.Background()</span><br><span class="line">	childCtx, cancelChild := context.WithDeadline(fatherCtx, time.Now().Add(<span class="number">3</span>*time.Second))</span><br><span class="line">	<span class="keyword">defer</span> cancelChild()</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-childCtx.Done():</span><br><span class="line">				fmt.Println(<span class="string">&quot;exit because:&quot;</span>, context.Cause(childCtx))</span><br><span class="line">				wg.Done()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">				fmt.Println(<span class="string">&quot;reach 1 s&quot;</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	fmt.Println(<span class="string">&quot;begin wait&quot;</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-定时关闭协程"><a href="#3-定时关闭协程" class="headerlink" title="3) 定时关闭协程"></a>3) 定时关闭协程</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fatherCtx := context.Background()</span><br><span class="line">	childCtx, cancelChild := context.WithTimeout(fatherCtx, <span class="number">3</span>*time.Second)</span><br><span class="line">	<span class="keyword">defer</span> cancelChild()</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-childCtx.Done():</span><br><span class="line">				fmt.Println(<span class="string">&quot;exit because:&quot;</span>, context.Cause(childCtx))</span><br><span class="line">				wg.Done()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">				fmt.Println(<span class="string">&quot;reach 1 s&quot;</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	fmt.Println(<span class="string">&quot;begin wait&quot;</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-带原因的取消"><a href="#4-带原因的取消" class="headerlink" title="4) 带原因的取消"></a>4) 带原因的取消</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fatherCtx := context.Background()</span><br><span class="line">	childCtx, cancelChild := context.WithCancelCause(fatherCtx)</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-childCtx.Done():</span><br><span class="line">				fmt.Println(<span class="string">&quot;exit because:&quot;</span>, context.Cause(childCtx))</span><br><span class="line">				wg.Done()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">				fmt.Println(<span class="string">&quot;reach 1 s&quot;</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	cancelChild(fmt.Errorf(<span class="string">&quot;father notify&quot;</span>))</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="23-2-携带上下文"><a href="#23-2-携带上下文" class="headerlink" title="23.2. 携带上下文"></a>23.2. 携带上下文</h3><ul><li>当前找不到会找父级的context</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fatherCtx := context.Background()</span><br><span class="line">	childCtx := context.WithValue(fatherCtx, <span class="string">&quot;test&quot;</span>, <span class="string">&quot;123&quot;</span>)</span><br><span class="line">	child1Ctx, cancel := context.WithTimeout(childCtx, <span class="number">3</span>*time.Second)</span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-child1Ctx.Done():</span><br><span class="line">				fmt.Println(<span class="string">&quot;exit because:&quot;</span>, context.Cause(child1Ctx))</span><br><span class="line">				wg.Done()</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			<span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">				fmt.Println(<span class="string">&quot;reach 1 s, get test: &quot;</span>, child1Ctx.Value(<span class="string">&quot;test&quot;</span>))</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	fmt.Println(<span class="string">&quot;begin wait&quot;</span>)</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="24-os-signal-信号处理库"><a href="#24-os-signal-信号处理库" class="headerlink" title="24. os/signal 信号处理库"></a>24. <code>os/signal</code> 信号处理库</h2><h3 id="24-1-捕获信号"><a href="#24-1-捕获信号" class="headerlink" title="24.1. 捕获信号"></a>24.1. 捕获信号</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c := <span class="built_in">make</span>(<span class="keyword">chan</span> os.Signal, <span class="number">10</span>)</span><br><span class="line">	signal.Notify(c, syscall.SIGTERM, syscall.SIGINT, syscall.SIGQUIT)</span><br><span class="line">	<span class="keyword">for</span> s := <span class="keyword">range</span> c &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;recieve signal&quot;</span>, s)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>常见的操作对应的信号</li></ul><table><thead><tr><th>操作</th><th>信号值</th><th>描述</th></tr></thead><tbody><tr><td><code>ctrl+c</code></td><td>syscall.SIGINT</td><td>中断</td></tr><tr><td><code>ctrl+z</code></td><td>syscall.SIGTSTP</td><td>停止</td></tr><tr><td><code>fg</code>或<code>bg</code></td><td>syscall.SIGCONT</td><td>继续</td></tr></tbody></table><h2 id="25-fmt-格式化输出库"><a href="#25-fmt-格式化输出库" class="headerlink" title="25. fmt 格式化输出库"></a>25. fmt 格式化输出库</h2><h3 id="25-1-Sprintf-格式化字符串"><a href="#25-1-Sprintf-格式化字符串" class="headerlink" title="25.1. Sprintf 格式化字符串"></a>25.1. Sprintf 格式化字符串</h3><h4 id="1-自定义顺序格式化参数"><a href="#1-自定义顺序格式化参数" class="headerlink" title="1) 自定义顺序格式化参数"></a>1) 自定义顺序格式化参数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(fmt.Sprintf(<span class="string">&quot;%[2]d %[1]d %[1]d %[2]d&quot;</span>, <span class="number">10</span>, <span class="number">20</span>))	<span class="comment">// 20 10 10 20</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="26-math-bits-二进制相关"><a href="#26-math-bits-二进制相关" class="headerlink" title="26. math&#x2F;bits 二进制相关"></a>26. math&#x2F;bits 二进制相关</h2><h3 id="26-1-统计二进制中1的个数"><a href="#26-1-统计二进制中1的个数" class="headerlink" title="26.1. 统计二进制中1的个数"></a>26.1. 统计二进制中1的个数</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(bits.OnesCount(<span class="number">1</span>))</span><br><span class="line">	fmt.Println(bits.OnesCount(<span class="number">2</span>))</span><br><span class="line">	fmt.Println(bits.OnesCount(<span class="number">3</span>))</span><br><span class="line">	fmt.Println(bits.OnesCount(<span class="number">4</span>))</span><br><span class="line">	fmt.Println(bits.OnesCount(<span class="number">5</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="五、cgo"><a href="#五、cgo" class="headerlink" title="五、cgo"></a>五、cgo</h1><h2 id="1-多平台编译"><a href="#1-多平台编译" class="headerlink" title="1. 多平台编译"></a>1. 多平台编译</h2><h3 id="1-1-平台不同的flag"><a href="#1-1-平台不同的flag" class="headerlink" title="1.1. 平台不同的flag"></a>1.1. 平台不同的flag</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #cgo CXXFLAGS: -D CGO -D FORCE_POSIX -I $&#123;SRCDIR&#125;/../../Core -std=c++17</span></span><br><span class="line"><span class="comment">// #cgo linux,amd64 LDFLAGS: -L./lib-linux-amd64 -lmmkv -lcore -lz -lpthread</span></span><br><span class="line"><span class="comment">// #cgo windows,amd64 LDFLAGS: -L./lib-windows-amd64 -lmmkv -lcore -lz -lpthread</span></span><br></pre></td></tr></table></figure><h2 id="2-pkg-config-自定义动态库路径"><a href="#2-pkg-config-自定义动态库路径" class="headerlink" title="2. pkg-config 自定义动态库路径"></a>2. pkg-config 自定义动态库路径</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/264984763">将 CGO 与 Pkg-Config 和 自定义动态库位置一起使用</a></p><h1 id="六、go命令相关"><a href="#六、go命令相关" class="headerlink" title="六、go命令相关"></a>六、go命令相关</h1><h2 id="1-go-test-执行单测用例"><a href="#1-go-test-执行单测用例" class="headerlink" title="1. go test 执行单测用例"></a>1. go test 执行单测用例</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">######### 指定目录 ##########</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行当前目录下所有单测文件</span></span><br><span class="line">go test</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行当前目录下及子目录的所有单测文件</span></span><br><span class="line">go test ./...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行package的某个子目录单测文件</span></span><br><span class="line">go test [package]/[dir]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">######### 指定函数 ##########</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行特定函数</span></span><br><span class="line">go test -run ^testFunc$</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行多个特定函数</span></span><br><span class="line">go test -run ^(testFunc|testFunc1)$</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">######### 设定超时时间 ##########</span></span></span><br><span class="line">go test -timeout 30s</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">######### 打印详细信息 ##########</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">默认成功不会打印fmt.Println等，加上-v就会打印</span></span><br><span class="line">go test -v</span><br></pre></td></tr></table></figure><h2 id="2-go-build-编译二进制"><a href="#2-go-build-编译二进制" class="headerlink" title="2. go build 编译二进制"></a>2. go build 编译二进制</h2><ul><li>go build不区分平台，可以在任意系统上编译其他大多数系统的版本</li></ul><h3 id="2-1-windows-32bit和64bit"><a href="#2-1-windows-32bit和64bit" class="headerlink" title="2.1. windows 32bit和64bit"></a>2.1. windows 32bit和64bit</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">32位编译</span></span><br><span class="line">go env -w GOOS=windows</span><br><span class="line">go env -w GOARCH=386</span><br><span class="line">go build</span><br><span class="line">go env -u GOARCH</span><br><span class="line">go env -u GOOS</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">64位编译</span></span><br><span class="line">go env -w GOOS=windows</span><br><span class="line">go env -w GOARCH=amd64</span><br><span class="line">go build</span><br><span class="line">go env -u GOARCH</span><br><span class="line">go env -u GOOS</span><br></pre></td></tr></table></figure><h3 id="2-2-全平台编译makefile示例"><a href="#2-2-全平台编译makefile示例" class="headerlink" title="2.2. 全平台编译makefile示例"></a>2.2. 全平台编译makefile示例</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">TARGET_NAME		= testaaa</span><br><span class="line">BUILD_CMD		= go build</span><br><span class="line">OUTPUT 			= <span class="variable">$(TARGET_NAME)</span>_x86.exe <span class="variable">$(TARGET_NAME)</span>_x64.exe <span class="variable">$(TARGET_NAME)</span>_linux_amd64 <span class="variable">$(TARGET_NAME)</span>_linux_arm64 <span class="variable">$(TARGET_NAME)</span>_mac_amd64 <span class="variable">$(TARGET_NAME)</span>_mac_arm64</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(OUTPUT)</span></span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -f <span class="variable">$(OUTPUT)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_NAME)</span>_x86.exe: *.go</span><br><span class="line">	go env -w GOOS=windows</span><br><span class="line">	go env -w GOARCH=386</span><br><span class="line">	<span class="variable">$(BUILD_CMD)</span> -o <span class="variable">$@</span></span><br><span class="line">	go env -u GOOS</span><br><span class="line">	go env -u GOARCH</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_NAME)</span>_x64.exe: *.go</span><br><span class="line">	go env -w GOOS=windows</span><br><span class="line">	go env -w GOARCH=amd64</span><br><span class="line">	<span class="variable">$(BUILD_CMD)</span> -o <span class="variable">$@</span></span><br><span class="line">	go env -u GOOS</span><br><span class="line">	go env -u GOARCH</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_NAME)</span>_linux_amd64: *.go</span><br><span class="line">	go env -w GOOS=linux</span><br><span class="line">	go env -w GOARCH=amd64</span><br><span class="line">	<span class="variable">$(BUILD_CMD)</span> -o <span class="variable">$@</span></span><br><span class="line">	go env -u GOOS</span><br><span class="line">	go env -u GOARCH</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_NAME)</span>_linux_arm64: *.go</span><br><span class="line">	go env -w GOOS=linux</span><br><span class="line">	go env -w GOARCH=arm64</span><br><span class="line">	<span class="variable">$(BUILD_CMD)</span> -o <span class="variable">$@</span></span><br><span class="line">	go env -u GOOS</span><br><span class="line">	go env -u GOARCH</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_NAME)</span>_mac_amd64: *.go</span><br><span class="line">	go env -w GOOS=darwin</span><br><span class="line">	go env -w GOARCH=arm64</span><br><span class="line">	<span class="variable">$(BUILD_CMD)</span> -o <span class="variable">$@</span></span><br><span class="line">	go env -u GOOS</span><br><span class="line">	go env -u GOARCH</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET_NAME)</span>_mac_arm64: *.go</span><br><span class="line">	go env -w GOOS=darwin</span><br><span class="line">	go env -w GOARCH=arm64</span><br><span class="line">	<span class="variable">$(BUILD_CMD)</span> -o <span class="variable">$@</span></span><br><span class="line">	go env -u GOOS</span><br><span class="line">	go env -u GOARCH</span><br></pre></td></tr></table></figure><h3 id="2-3-编译给c调用的动态库"><a href="#2-3-编译给c调用的动态库" class="headerlink" title="2.3. 编译给c调用的动态库"></a>2.3. 编译给c调用的动态库</h3><p><strong>代码上</strong></p><ul><li>必须有<code>package main</code>和main函数，但是可以什么都不做</li><li>必须包含<code>import &quot;C&quot;</code></li><li>要导出的函数必须加上<code>//export funcName</code>，export前没有空格</li><li>导出函数本身无所谓首字母大小写</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Rectangle define class</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    x <span class="type">int</span></span><br><span class="line">    y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Area define method</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Rectangle)</span></span> Area() <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.x * r.y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//export test</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    rec := Rectangle&#123;</span><br><span class="line">        x: <span class="number">14</span>,</span><br><span class="line">        y: <span class="number">34</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(rec.Area())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>编译</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">要先安装标准库，会生成目录到 /usr/lib/go/pkg/linux_[<span class="built_in">arch</span>]_dynlink/</span></span><br><span class="line">go install -buildmode=shared -linkshared std</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译C动态库</span></span><br><span class="line">go build -buildmode=c-shared -linkshared -o libtest.so</span><br></pre></td></tr></table></figure><p><strong>结果</strong></p><ul><li>会在当前目录生成一个静态库文件（<code>libtest.so</code>）一个头文件（<code>libtest.h</code>）</li><li>strip后查看<code>libtest.so</code>，函数已经导出，依赖上述生成的目录下的<code>libstd.so</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">=&gt; strip libtest.so</span><br><span class="line">=&gt; readelf -Ws libtest.so</span><br><span class="line"></span><br><span class="line">Symbol table &#x27;.dynsym&#x27; contains 33 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</span><br><span class="line">     1: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span><br><span class="line">     2: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND __stack_chk_fail@GLIBC_2.17 (2)</span><br><span class="line">     3: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTable</span><br><span class="line">     4: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable</span><br><span class="line">     5: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.17 (2)</span><br><span class="line">     6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND runtime.morestack_noctxt</span><br><span class="line">     7: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  UND type.int</span><br><span class="line">     8: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  UND type.*os.File</span><br><span class="line">     9: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  UND os.Stdout</span><br><span class="line">    10: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  UND type.io.Writer</span><br><span class="line">    11: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND runtime.addmoduledata</span><br><span class="line">    12: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND os.(*File).Write</span><br><span class="line">    13: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  UND go.link.abihash.libstd.so</span><br><span class="line">    14: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND runtime.unreachableMethod</span><br><span class="line">    15: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND runtime.convT64</span><br><span class="line">    16: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _rt0_arm64_linux_lib</span><br><span class="line">    17: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  UND runtime.lastmoduledatap</span><br><span class="line">    18: 0000000000000000     0 TLS     GLOBAL DEFAULT  UND runtime.tlsg</span><br><span class="line">    19: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND fmt.Fprintln</span><br><span class="line">    20: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  UND __stack_chk_guard@GLIBC_2.17 (3)</span><br><span class="line">    21: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _cgo_wait_runtime_init_done</span><br><span class="line">    22: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND crosscall2</span><br><span class="line">    23: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _cgo_release_context</span><br><span class="line">    24: 000000000001f950     8 OBJECT  GLOBAL DEFAULT   19 _rt0_arm64_linux_lib.ptr</span><br><span class="line">    25: 0000000000020238     0 NOTYPE  GLOBAL DEFAULT   18 _edata</span><br><span class="line">    26: 0000000000020239     0 NOTYPE  GLOBAL DEFAULT   18 _end</span><br><span class="line">    27: 0000000000001270    64 FUNC    GLOBAL DEFAULT   13 _cgoexp_f70364e750d1_test</span><br><span class="line">    28: 00000000000012b0   144 FUNC    GLOBAL DEFAULT   13 main.test</span><br><span class="line">    29: 0000000000001350   128 FUNC    GLOBAL DEFAULT   13 test</span><br><span class="line">    30: 0000000000020238     0 NOTYPE  GLOBAL DEFAULT   18 __bss_start</span><br><span class="line">    31: 000000000001f988    32 OBJECT  GLOBAL DEFAULT   20 go.itab.*os.File,io.Writer</span><br><span class="line">    32: 000000000001f970    24 OBJECT  GLOBAL DEFAULT   20 runtime.textsectionmap</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以看到依赖了go自己的标准库和libc的库</span></span><br><span class="line">=&gt; readelf -d libtest.so</span><br><span class="line"></span><br><span class="line">Dynamic section at offset 0xfce8 contains 32 entries:</span><br><span class="line">  Tag        Type                         Name/Value</span><br><span class="line"> 0x0000000000000003 (PLTGOT)             0x1ff88</span><br><span class="line"> 0x0000000000000002 (PLTRELSZ)           264 (bytes)</span><br><span class="line"> 0x0000000000000017 (JMPREL)             0xf90</span><br><span class="line"> 0x0000000000000014 (PLTREL)             RELA</span><br><span class="line"> 0x0000000000000007 (RELA)               0x948</span><br><span class="line"> 0x0000000000000008 (RELASZ)             1608 (bytes)</span><br><span class="line"> 0x0000000000000009 (RELAENT)            24 (bytes)</span><br><span class="line"> 0x000000006ffffff9 (RELACOUNT)          55</span><br><span class="line"> 0x0000000000000006 (SYMTAB)             0x288</span><br><span class="line"> 0x000000000000000b (SYMENT)             24 (bytes)</span><br><span class="line"> 0x0000000000000005 (STRTAB)             0x5a0</span><br><span class="line"> 0x000000000000000a (STRSZ)              700 (bytes)</span><br><span class="line"> 0x000000006ffffef5 (GNU_HASH)           0x860</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libstd.so]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]</span><br><span class="line"> 0x0000000000000001 (NEEDED)             Shared library: [ld-linux-aarch64.so.1]</span><br><span class="line"> 0x000000000000000c (INIT)               0x1098</span><br><span class="line"> 0x000000000000000d (FINI)               0x13d0</span><br><span class="line"> 0x000000000000001a (FINI_ARRAY)         0x1f940</span><br><span class="line"> 0x000000000000001c (FINI_ARRAYSZ)       8 (bytes)</span><br><span class="line"> 0x0000000000000019 (INIT_ARRAY)         0x1f948</span><br><span class="line"> 0x000000000000001b (INIT_ARRAYSZ)       24 (bytes)</span><br><span class="line"> 0x000000000000001d (RUNPATH)            Library runpath: [/usr/lib/go/pkg/linux_arm64_dynlink/]</span><br><span class="line"> 0x0000000000000010 (SYMBOLIC)           0x0</span><br><span class="line"> 0x000000000000001e (FLAGS)              SYMBOLIC BIND_NOW</span><br><span class="line"> 0x000000006ffffffb (FLAGS_1)            Flags: NOW NODELETE</span><br><span class="line"> 0x000000006ffffff0 (VERSYM)             0x8a8</span><br><span class="line"> 0x000000006ffffffc (VERDEF)             0x8ec</span><br><span class="line"> 0x000000006ffffffd (VERDEFNUM)          1</span><br><span class="line"> 0x000000006ffffffe (VERNEED)            0x908</span><br><span class="line"> 0x000000006fffffff (VERNEEDNUM)         2</span><br><span class="line"> 0x0000000000000000 (NULL)               0x0</span><br></pre></td></tr></table></figure><h2 id="3-go-env-设置环境变量"><a href="#3-go-env-设置环境变量" class="headerlink" title="3. go env 设置环境变量"></a>3. go env 设置环境变量</h2><ul><li>设置的全局变量是全局生效的，重启都会生效</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置环境变量</span></span><br><span class="line">go env -w xxx=xx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">恢复环境变量到默认值</span></span><br><span class="line">go env -u xxx</span><br></pre></td></tr></table></figure><p><strong>实例</strong></p><ul><li>可以写到makefile中，跨平台的makefile</li></ul><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">main.exe: main.go</span></span><br><span class="line">	go env -w GOOS=windows</span><br><span class="line">	go build</span><br><span class="line">	go env -u GOOS</span><br></pre></td></tr></table></figure><h2 id="4-go-install-安装全局包"><a href="#4-go-install-安装全局包" class="headerlink" title="4. go install 安装全局包"></a>4. go install 安装全局包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install -v github.com/cweill/gotests/gotests@v1.6.0</span><br></pre></td></tr></table></figure><h3 id="4-1-常用工具链接"><a href="#4-1-常用工具链接" class="headerlink" title="4.1. 常用工具链接"></a>4.1. 常用工具链接</h3><ul><li>gotest: <code>github.com/cweill/gotests/gotests</code></li><li>go-outline: <code>github.com/ramya-rao-a/go-outline</code></li><li>gopls: <code>golang.org/x/tools/gopls</code></li><li>dlv: <code>github.com/go-delve/delve/cmd/dlv</code></li></ul><h2 id="5-go-generate-执行命令"><a href="#5-go-generate-执行命令" class="headerlink" title="5. go generate 执行命令"></a>5. go generate 执行命令</h2><ul><li>在go文件中定义的命令，调用<code>go generate</code>时会执行</li><li>需要在<code>main.go</code>文件中如下定义，注释和go之间不能有空格，会执行generate后面的命令</li><li>一般用于生成语言文件或错误码信息等可以用命令生成的文件</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//go:generate gf pack -y i18n catalog/catalog.go</span></span><br></pre></td></tr></table></figure><h2 id="6-dlv-调试go程序"><a href="#6-dlv-调试go程序" class="headerlink" title="6. dlv 调试go程序"></a>6. dlv 调试go程序</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install -v github.com/go-delve/delve/cmd/dlv@latest</span><br></pre></td></tr></table></figure><h3 id="6-1-dlv监听远程调试"><a href="#6-1-dlv监听远程调试" class="headerlink" title="6.1. dlv监听远程调试"></a>6.1. dlv监听远程调试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">监听6666端口，挂载16703进程号</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--api-version 设置version为2，默认是1，vscode的客户端会使用2</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--headless=<span class="literal">true</span> 只启动server调试，不清楚什么是headless，但是都加了。。。</span></span><br><span class="line">dlv --listen=:6666 --headless=true --api-version=2 attach 16703</span><br></pre></td></tr></table></figure><ul><li>vscode中launch.json如下</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// Use IntelliSense to learn about possible attributes.</span></span><br><span class="line">    <span class="comment">// Hover to view descriptions of existing attributes.</span></span><br><span class="line">    <span class="comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Connect to server&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;go&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;attach&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;remote&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;remotePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">6666</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;172.22.231.55&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="五、框架"><a href="#五、框架" class="headerlink" title="五、框架"></a>五、框架</h1><h2 id="1-工程知识"><a href="#1-工程知识" class="headerlink" title="1. 工程知识"></a>1. 工程知识</h2><h3 id="1-1-go-mod"><a href="#1-1-go-mod" class="headerlink" title="1.1. go.mod"></a>1.1. go.mod</h3><ul><li><code>go.mod</code>是go工程用来管理包使用的，类似于nodejs的<code>package.json</code>文件</li></ul><h4 id="1-创建新工程"><a href="#1-创建新工程" class="headerlink" title="1) 创建新工程"></a>1) 创建新工程</h4><p><strong>1. 先生成go.mod文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化一个<span class="built_in">test</span>工程</span></span><br><span class="line">go mod init test</span><br></pre></td></tr></table></figure><h4 id="2-go-mod-一些基本操作"><a href="#2-go-mod-一些基本操作" class="headerlink" title="2) go mod 一些基本操作"></a>2) go mod 一些基本操作</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加工程依赖包，会加入到go.mod文件中的require中</span></span><br><span class="line">go mod download github.com/mattn/go-sqlite3</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">根据go.mod文件处理依赖关系</span></span><br><span class="line">go mod tidy</span><br></pre></td></tr></table></figure><h5 id="1-vendor"><a href="#1-vendor" class="headerlink" title="(1) vendor"></a>(1) vendor</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步依赖包到当前的vendor目录</span></span><br><span class="line">go mod vendor</span><br></pre></td></tr></table></figure><h2 id="2-goframe"><a href="#2-goframe" class="headerlink" title="2. goframe"></a>2. goframe</h2><h3 id="2-1-安装配置"><a href="#2-1-安装配置" class="headerlink" title="2.1. 安装配置"></a>2.1. 安装配置</h3><p><strong>安装gf命令行工具</strong></p><ul><li>goframe安装需要一个gf命令行工具</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载安装gf</span></span><br><span class="line">wget -O gf https://github.com/gogf/gf-cli/releases/download/v1.16.3/gf_linux_amd64 &amp;&amp; chmod +x gf &amp;&amp; ./gf install</span><br></pre></td></tr></table></figure><ul><li>默认gf命令行工具不支持sqlite3，如果需要，上面安装完之后，自己编译一版sqlite3的gf工具</li><li>确保有gcc编译环境</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">clone</span>仓库</span></span><br><span class="line">git clone https://github.com/gogf/gf-cli &amp;&amp; cd gf-cli</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置环境变量</span></span><br><span class="line">export CGO_ENABLED=1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将代码中的sqlite3依赖取消注释</span></span><br><span class="line">vim command/gen/gen_dao.go</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行gf的编译命令，需要上述步骤先下载gf工具</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-a指定平台，可以编译下面几种平台</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      darwin    amd64,arm64</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      freebsd   386,amd64,arm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      linux     386,amd64,arm,arm64,ppc64,ppc64le,mips,mipsle,mips64,mips64le</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      netbsd    386,amd64,arm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      openbsd   386,amd64,arm</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">      windows   386,amd64</span></span><br><span class="line">gf build main.go -a amd64 -s linux --cgo</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">cp bin/linux_amd64/gf /usr/local/bin/gf</span><br></pre></td></tr></table></figure><p><strong>初始化</strong></p><ul><li>如果需要使用sqlite3，需要在项目根目录执行</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod download github.com/mattn/go-sqlite3</span><br></pre></td></tr></table></figure><p><strong>代码生成</strong></p><ul><li>根据<code>config.toml</code>生成数据库代码，这个比较方便</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gf gen dao -c config/config.toml</span><br></pre></td></tr></table></figure><h3 id="2-2-开发知识点"><a href="#2-2-开发知识点" class="headerlink" title="2.2. 开发知识点"></a>2.2. 开发知识点</h3><h4 id="2-2-1-orm时间维护功能"><a href="#2-2-1-orm时间维护功能" class="headerlink" title="2.2.1. orm时间维护功能"></a>2.2.1. orm时间维护功能</h4><ul><li>orm的数据库更新操作会自动更新updatedAt、createdAt、deletedAt等字段</li><li>不想要更新字段需要加上<code>Unscoped()</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Table(<span class="string">&quot;user&quot;</span>).Unscoped().Data(g.Map&#123;<span class="string">&quot;name&quot;</span> : <span class="string">&quot;john guo&quot;</span>&#125;).Where(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;john&quot;</span>).Update()</span><br></pre></td></tr></table></figure><h3 id="2-2-2-前后端字段对应"><a href="#2-2-2-前后端字段对应" class="headerlink" title="2.2.2. 前后端字段对应"></a>2.2.2. 前后端字段对应</h3><ul><li>gf中使用下面的方法可以将前端传入参数解析到struct的对应成员中</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/model/xxx.go</span></span><br><span class="line"><span class="keyword">type</span> TaskApiCreateReq <span class="keyword">struct</span> &#123;</span><br><span class="line">	Content  <span class="type">string</span> <span class="string">`json:&quot;content&quot; v:&quot;required|length:1,100#任务内容不能为空|任务内容应当在:min到:max之间&quot;`</span></span><br><span class="line">	TaskType <span class="type">int</span>    <span class="string">`json:&quot;taskType&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// app/api/xxx.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *task)</span></span> Create(r *ghttp.Request) &#123;</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		data *model.TaskApiCreateReq</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> err := r.Parse(&amp;data); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		response.JsonExit(r, <span class="number">1</span>, err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>解析规则，会把前端传入的字段去除除了字母和数字的所有特殊字符，然后不区分大小写比较</li><li>下面的几个key都可以解析到上面的<code>data.Content</code>中</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;Content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;con_tent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;conTent&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xxx&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="六、好用的第三方库"><a href="#六、好用的第三方库" class="headerlink" title="六、好用的第三方库"></a>六、好用的第三方库</h1><h2 id="1-github-com-google-uuid-uuid"><a href="#1-github-com-google-uuid-uuid" class="headerlink" title="1. github.com/google/uuid uuid"></a>1. <code>github.com/google/uuid</code> uuid</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/google/uuid&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	id := uuid.New()</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%s %s\n&quot;</span>, id, id.Version().String())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>输出</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab8d63ef-f0c4-a01d-a6ef-5f2c3efff5af VERSION_4</span><br></pre></td></tr></table></figure><h2 id="2-github-com-makiuchi-d-gozxing-二维码解析和生成"><a href="#2-github-com-makiuchi-d-gozxing-二维码解析和生成" class="headerlink" title="2. github.com/makiuchi-d/gozxing 二维码解析和生成"></a>2. <code>github.com/makiuchi-d/gozxing</code> 二维码解析和生成</h2><ul><li><code>github.com/tuotoo/qrcode</code>没成功的，这个成功了</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;image&quot;</span></span><br><span class="line">	<span class="string">&quot;image/png&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/makiuchi-d/gozxing&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/makiuchi-d/gozxing/common&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/makiuchi-d/gozxing/qrcode&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parseQrcode</span><span class="params">(pngPath <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	originByte, _ := ioutil.ReadFile(pngPath)</span><br><span class="line">	originBuffer := bytes.NewBuffer(originByte)</span><br><span class="line">	originImg, _, err := image.Decode(originBuffer)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err.Error()</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(filename)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 解析二维码返回结果</span></span><br><span class="line">	bmp, _ := gozxing.NewBinaryBitmapFromImage(originImg)</span><br><span class="line">	qrReader := qrcode.NewQRCodeReader()</span><br><span class="line">	result, err := qrReader.Decode(bmp, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err.Error()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result.GetText()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-golang-org-x-mobile-go开发android和ios"><a href="#3-golang-org-x-mobile-go开发android和ios" class="headerlink" title="3. golang.org/x/mobile go开发android和ios"></a>3. <code>golang.org/x/mobile</code> go开发android和ios</h2><p><a href="/blogs/2022-05-24-gomobile">gomobile使用笔记</a></p><h2 id="4-github-com-shirou-gopsutil-process-获取进程相关信息"><a href="#4-github-com-shirou-gopsutil-process-获取进程相关信息" class="headerlink" title="4. github.com/shirou/gopsutil/process 获取进程相关信息"></a>4. <code>github.com/shirou/gopsutil/process</code> 获取进程相关信息</h2><h3 id="4-1-获取进程信息"><a href="#4-1-获取进程信息" class="headerlink" title="4.1. 获取进程信息"></a>4.1. 获取进程信息</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取进程对应的目录</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getProcessDir</span><span class="params">(name <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">	<span class="comment">// 获取所有进程id</span></span><br><span class="line">	pids, _ := process.Pids()</span><br><span class="line">	<span class="keyword">for</span> _, pid := <span class="keyword">range</span> pids &#123;</span><br><span class="line">		p, _ := process.NewProcess(<span class="type">int32</span>(pid))</span><br><span class="line">		tmp, _ := p.Name()</span><br><span class="line">		<span class="keyword">if</span> tmp != name &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(p.Name())		<span class="comment">// 名称，一般是二进制名称</span></span><br><span class="line">		fmt.Println(p.Exe())		<span class="comment">// 二进制路径</span></span><br><span class="line">		fmt.Println(p.Cwd())		<span class="comment">// 二进制运行环境变量</span></span><br><span class="line">		fmt.Println(p.Cmdline())	<span class="comment">// 二进制运行命令行参数</span></span><br><span class="line">		fmt.Println(p.Uids())</span><br><span class="line">		fmt.Println(p.Gids())</span><br><span class="line">		fmt.Println(p.Username())</span><br><span class="line">		fmt.Println(p.CreateTime())</span><br><span class="line">		fmt.Println(p.MemoryInfo())</span><br><span class="line">		fmt.Println(p.MemoryInfoEx())</span><br><span class="line">		fmt.Println(p.NumCtxSwitches())</span><br><span class="line">		fmt.Println(p.NumFDs())</span><br><span class="line">		fmt.Println(p.NumThreads())</span><br><span class="line">		fmt.Println(p.OpenFiles())</span><br><span class="line">		fmt.Println(p.Connections())</span><br><span class="line">		fmt.Println(p.IsRunning())</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-github-com-miekg-dns-构造dns包发送"><a href="#5-github-com-miekg-dns-构造dns包发送" class="headerlink" title="5. github.com/miekg/dns 构造dns包发送"></a>5. <code>github.com/miekg/dns</code> 构造dns包发送</h2><h3 id="5-1-获取域名特定类型的解析"><a href="#5-1-获取域名特定类型的解析" class="headerlink" title="5.1. 获取域名特定类型的解析"></a>5.1. 获取域名特定类型的解析</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">resolveDomain</span><span class="params">(domain <span class="type">string</span>, server <span class="type">string</span>, dnsType <span class="type">uint16</span>)</span></span> (r *dns.Msg, err <span class="type">error</span>) &#123;</span><br><span class="line">	cli := dns.Client&#123;</span><br><span class="line">		Timeout: <span class="number">5</span> * time.Second,</span><br><span class="line">	&#125;</span><br><span class="line">	m := dns.Msg&#123;&#125;</span><br><span class="line">	m.SetQuestion(dns.Fqdn(domain), dnsType)</span><br><span class="line">	m.Id = dns.Id()</span><br><span class="line">	m.RecursionDesired = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">	r, _, err = cli.Exchange(&amp;m, server+<span class="string">&quot;:53&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(r.String())	<span class="comment">// 打印类似dig的输出</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-golang-org-x-text-encoding-simplifiedchinese-中文编码转换"><a href="#6-golang-org-x-text-encoding-simplifiedchinese-中文编码转换" class="headerlink" title="6. golang.org/x/text/encoding/simplifiedchinese 中文编码转换"></a>6. <code>golang.org/x/text/encoding/simplifiedchinese</code> 中文编码转换</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;golang.org/x/text/encoding/simplifiedchinese&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConvertStr2GBK</span><span class="params">(str <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="comment">//将utf-8编码的字符串转换为GBK编码</span></span><br><span class="line">    ret, err := simplifiedchinese.GBK.NewEncoder().String(str)</span><br><span class="line">    <span class="keyword">return</span> ret   <span class="comment">//如果转换失败返回空字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果是[]byte格式的字符串，可以使用Bytes方法</span></span><br><span class="line">    b, err := simplifiedchinese.GBK.NewEncoder().Bytes([]<span class="type">byte</span>(str))</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConvertGBK2Str</span><span class="params">(gbkStr <span class="type">string</span>)</span></span> <span class="type">string</span> &#123;</span><br><span class="line">    <span class="comment">//将GBK编码的字符串转换为utf-8编码</span></span><br><span class="line">    ret, err := simplifiedchinese.GBK.NewDecoder().String(gbkStr)</span><br><span class="line">    <span class="keyword">return</span> ret <span class="comment">//如果转换失败返回空字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果是[]byte格式的字符串，可以使用Bytes方法</span></span><br><span class="line">    b, err := simplifiedchinese.GBK.NewDecoder().Bytes([]<span class="type">byte</span>(gbkStr))</span><br><span class="line">    <span class="keyword">return</span> <span class="type">string</span>(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-github-com-google-gopacket"><a href="#7-github-com-google-gopacket" class="headerlink" title="7. github.com/google/gopacket"></a>7. <code>github.com/google/gopacket</code></h2><h3 id="7-1-构造ip包"><a href="#7-1-构造ip包" class="headerlink" title="7.1. 构造ip包"></a>7.1. 构造ip包</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/google/gopacket/layers&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 构建destination ip</span></span><br><span class="line">	<span class="keyword">const</span> (</span><br><span class="line">		IPv4 = <span class="string">&quot;ip4&quot;</span></span><br><span class="line">		Addr = <span class="string">&quot;199.200.2.170&quot;</span></span><br><span class="line">		Port = <span class="number">12345</span></span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	dstIP, _ := net.ResolveIPAddr(IPv4, Addr)</span><br><span class="line">	dstPort := layers.TCPPort(Port)</span><br><span class="line"></span><br><span class="line">	sIP, _ := net.ResolveIPAddr(IPv4, <span class="string">&quot;2.0.0.1&quot;</span>)</span><br><span class="line">	srcPort := layers.TCPPort(<span class="number">12345</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;Local IP:PORT - %s:%d \n&quot;</span>, sIP, srcPort)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建IP包</span></span><br><span class="line">	ipPack := &amp;layers.IPv4&#123;</span><br><span class="line">		Version:  <span class="number">4</span>,</span><br><span class="line">		SrcIP:    sIP.IP,</span><br><span class="line">		DstIP:    dstIP.IP,</span><br><span class="line">		TTL:      <span class="number">64</span>,</span><br><span class="line">		Protocol: layers.IPProtocolTCP,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建tcp报文段</span></span><br><span class="line">	tcpPack := &amp;layers.TCP&#123;</span><br><span class="line">		SrcPort: srcPort,</span><br><span class="line">		DstPort: dstPort,</span><br><span class="line">		Seq:     <span class="number">1205014776</span>,</span><br><span class="line">		SYN:     <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := tcpPack.SetNetworkLayerForChecksum(ipPack); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	serialBuf := gopacket.NewSerializeBuffer()</span><br><span class="line">	serialOpts := gopacket.SerializeOptions&#123;</span><br><span class="line">		ComputeChecksums: <span class="literal">true</span>,</span><br><span class="line">		FixLengths:       <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := gopacket.SerializeLayers(serialBuf, serialOpts, ipPack, tcpPack); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打印ip包</span></span><br><span class="line">	fmt.Println(serialBuf.Bytes())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-github-com-songgao-water-linux虚拟网卡设备"><a href="#8-github-com-songgao-water-linux虚拟网卡设备" class="headerlink" title="8. github.com/songgao/water linux虚拟网卡设备"></a>8. <code>github.com/songgao/water</code> linux虚拟网卡设备</h2><h3 id="8-1-构造tun设备读写数据"><a href="#8-1-构造tun设备读写数据" class="headerlink" title="8.1. 构造tun设备读写数据"></a>8.1. 构造tun设备读写数据</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建TUN设备</span></span><br><span class="line">	config := water.Config&#123;</span><br><span class="line">		DeviceType: water.TUN,</span><br><span class="line">		PlatformSpecificParams: water.PlatformSpecificParams&#123;</span><br><span class="line">			Name: <span class="string">&quot;tun123&quot;</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	ifce, err := water.New(config)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;create tun&quot;</span>, ifce.Name())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 启用网卡</span></span><br><span class="line">	cmd := exec.Command(<span class="string">&quot;ifconfig&quot;</span>, ifce.Name(), <span class="string">&quot;up&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err := cmd.Run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 接收数据包</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">1500</span>)</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			n, err := ifce.Read(buf)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				log.Fatal(err)</span><br><span class="line">			&#125;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;Received packet: % x\n&quot;</span>, buf[:n])</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	...	<span class="comment">// 构造数据包</span></span><br><span class="line">	<span class="comment">// 发送数据包</span></span><br><span class="line">	fmt.Println(serialBuf.Bytes())</span><br><span class="line">	_, err = ifce.Write(serialBuf.Bytes())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Error sending packet:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	time.Sleep(<span class="number">1000</span> * time.Second)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-github-com-smartystreets-goconvey-convey-单测辅助工具"><a href="#9-github-com-smartystreets-goconvey-convey-单测辅助工具" class="headerlink" title="9. github.com/smartystreets/goconvey/convey 单测辅助工具"></a>9. <code>github.com/smartystreets/goconvey/convey</code> 单测辅助工具</h2><ul><li>按照树的结构执行单测</li></ul><h3 id="9-1-一般用法"><a href="#9-1-一般用法" class="headerlink" title="9.1. 一般用法"></a>9.1. 一般用法</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestConvey</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	Convey(<span class="string">&quot;测试1加上别的数&quot;</span>, t, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		Convey(<span class="string">&quot;1+1=2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			sum := <span class="number">1</span> + <span class="number">1</span></span><br><span class="line">			So(sum, ShouldEqual, <span class="number">2</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">		Convey(<span class="string">&quot;1+2=3&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			sum := <span class="number">1</span> + <span class="number">2</span></span><br><span class="line">			So(sum, ShouldEqual, <span class="number">3</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-2-convey执行顺序"><a href="#9-2-convey执行顺序" class="headerlink" title="9.2. convey执行顺序"></a>9.2. convey执行顺序</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestConvey</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	Convey(<span class="string">&quot;测试1加上别的数&quot;</span>, t, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		i := <span class="number">1</span></span><br><span class="line">		fmt.Println()</span><br><span class="line">		fmt.Print(<span class="string">&quot;set i to &quot;</span>, i)</span><br><span class="line">		Convey(<span class="string">&quot;1+1=2&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			i += <span class="number">1</span></span><br><span class="line">			So(i, ShouldEqual, <span class="number">2</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">		Convey(<span class="string">&quot;1+2=3&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			i += <span class="number">2</span></span><br><span class="line">			So(i, ShouldEqual, <span class="number">3</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">		fmt.Println()</span><br><span class="line">		fmt.Println(<span class="string">&quot;test done&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>实际输出</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">=== RUN   TestConvey</span><br><span class="line"></span><br><span class="line">  测试1加上别的数</span><br><span class="line">set i to 1</span><br><span class="line">    1+1=2 ✔</span><br><span class="line">test done</span><br><span class="line"></span><br><span class="line">set i to 1</span><br><span class="line">    1+2=3 ✔</span><br><span class="line">test done</span><br></pre></td></tr></table></figure><ul><li>从上述代码可以得出结论，每一个Convey的出现，都是把父节点的函数复制了一份，只执行当前的Convey，兄弟Convey不执行</li><li>所以每个父节点有几个子节点，其所在函数都会执行多少遍，每一遍只有一个Convey生效，其他的都是空</li><li>上面代码可以理解为</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestConvey</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 测试1加上别的数</span></span><br><span class="line">	<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		i := <span class="number">1</span></span><br><span class="line">		fmt.Println()</span><br><span class="line">		fmt.Print(<span class="string">&quot;set i to &quot;</span>, i)</span><br><span class="line">		<span class="comment">// 1+1=2</span></span><br><span class="line">		<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			i += <span class="number">1</span></span><br><span class="line">			So(i, ShouldEqual, <span class="number">2</span>)</span><br><span class="line">		&#125;()</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 不执行 1+2=3</span></span><br><span class="line"></span><br><span class="line">		fmt.Println()</span><br><span class="line">		fmt.Println(<span class="string">&quot;test done&quot;</span>)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 测试1加上别的数，第二个convey把父节点整个函数重新执行了一遍</span></span><br><span class="line">	<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		i := <span class="number">1</span></span><br><span class="line">		fmt.Println()</span><br><span class="line">		fmt.Print(<span class="string">&quot;set i to &quot;</span>, i)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 不执行 1+1=2</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// 1+2=3</span></span><br><span class="line">		<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			i += <span class="number">2</span></span><br><span class="line">			So(i, ShouldEqual, <span class="number">3</span>)</span><br><span class="line">		&#125;()</span><br><span class="line">		fmt.Println()</span><br><span class="line">		fmt.Println(<span class="string">&quot;test done&quot;</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>测试集的实际效果</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestConvey</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	Convey(<span class="string">&quot;测试1加上别的数&quot;</span>, t, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		tests := []<span class="keyword">struct</span> &#123;</span><br><span class="line">			name <span class="type">string</span></span><br><span class="line">			add  <span class="type">int</span></span><br><span class="line">			want <span class="type">int</span></span><br><span class="line">		&#125;&#123;</span><br><span class="line">			&#123;</span><br><span class="line">				name: <span class="string">&quot;1+1=2&quot;</span>,</span><br><span class="line">				add:  <span class="number">1</span>,</span><br><span class="line">				want: <span class="number">2</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				name: <span class="string">&quot;1+2=3&quot;</span>,</span><br><span class="line">				add:  <span class="number">2</span>,</span><br><span class="line">				want: <span class="number">3</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				name: <span class="string">&quot;1+3=4&quot;</span>,</span><br><span class="line">				add:  <span class="number">3</span>,</span><br><span class="line">				want: <span class="number">4</span>,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> i, tt := <span class="keyword">range</span> tests &#123;</span><br><span class="line">			fmt.Println()</span><br><span class="line">			fmt.Print(<span class="string">&quot;in &quot;</span>, i, <span class="string">&quot;, tt &quot;</span>, tt)</span><br><span class="line">			Convey(tt.name, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">				So(<span class="number">1</span>+tt.add, ShouldEqual, tt.want)</span><br><span class="line">			&#125;)</span><br><span class="line">			fmt.Println()</span><br><span class="line">			fmt.Print(<span class="string">&quot;out &quot;</span>, i, <span class="string">&quot;, tt &quot;</span>, tt)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println()</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>输出如下，可以看出，循环在每个测试点都重新跑了一遍</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">=== RUN   TestConvey</span><br><span class="line"></span><br><span class="line">  测试1加上别的数</span><br><span class="line">in 0, tt &#123;1+1=2 1 2&#125;</span><br><span class="line">    1+1=2 ✔</span><br><span class="line">out 0, tt &#123;1+1=2 1 2&#125;</span><br><span class="line">in 1, tt &#123;1+2=3 2 3&#125;</span><br><span class="line">out 1, tt &#123;1+2=3 2 3&#125;</span><br><span class="line">in 2, tt &#123;1+3=4 3 4&#125;</span><br><span class="line">out 2, tt &#123;1+3=4 3 4&#125;</span><br><span class="line"></span><br><span class="line">in 0, tt &#123;1+1=2 1 2&#125;</span><br><span class="line">out 0, tt &#123;1+1=2 1 2&#125;</span><br><span class="line">in 1, tt &#123;1+2=3 2 3&#125;</span><br><span class="line">    1+2=3 ✔</span><br><span class="line">out 1, tt &#123;1+2=3 2 3&#125;</span><br><span class="line">in 2, tt &#123;1+3=4 3 4&#125;</span><br><span class="line">out 2, tt &#123;1+3=4 3 4&#125;</span><br><span class="line"></span><br><span class="line">in 0, tt &#123;1+1=2 1 2&#125;</span><br><span class="line">out 0, tt &#123;1+1=2 1 2&#125;</span><br><span class="line">in 1, tt &#123;1+2=3 2 3&#125;</span><br><span class="line">out 1, tt &#123;1+2=3 2 3&#125;</span><br><span class="line">in 2, tt &#123;1+3=4 3 4&#125;</span><br><span class="line">    1+3=4 ✔</span><br><span class="line">out 2, tt &#123;1+3=4 3 4&#125;</span><br></pre></td></tr></table></figure><h2 id="10-国际化库"><a href="#10-国际化库" class="headerlink" title="10. 国际化库"></a>10. 国际化库</h2><h3 id="10-1-github-com-mylukin-easy-i18n-i18n-轻量简单的国际化库"><a href="#10-1-github-com-mylukin-easy-i18n-i18n-轻量简单的国际化库" class="headerlink" title="10.1. github.com/mylukin/easy-i18n/i18n 轻量简单的国际化库"></a>10.1. <code>github.com/mylukin/easy-i18n/i18n</code> 轻量简单的国际化库</h3><h4 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1) 准备工作"></a>1) 准备工作</h4><ul><li>在根目录建立<code>locals</code>目录，里面只能放json文件</li><li>文件名只能是语言名称且只能是<code>golang.org/x/text/language</code>包中可以<code>Make</code>出来的名称</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">locales</span><br><span class="line">├── en-US.json</span><br><span class="line">└── zh-CN.json</span><br></pre></td></tr></table></figure><ul><li>名字限制如下</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;golang.org/x/text/language&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	name := <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line">	tag := language.Make(name)</span><br><span class="line">	<span class="keyword">if</span> tag.String() != name &#123;</span><br><span class="line">		<span class="comment">// 语言包不可用</span></span><br><span class="line">		fmt.Println(<span class="string">&quot;can&#x27;t use language package&quot;</span>, name)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;language package&quot;</span>, name ,<span class="string">&quot;is ok&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>也可以用系统内置的一部分</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(language.SimplifiedChinese.String())  <span class="comment">// zh-Hans</span></span><br><span class="line">	fmt.Println(language.Chinese.String())            <span class="comment">// zh</span></span><br><span class="line">	fmt.Println(language.TraditionalChinese.String()) <span class="comment">// zh-Hant</span></span><br><span class="line">	fmt.Println(language.English.String())            <span class="comment">// en</span></span><br><span class="line">	fmt.Println(language.AmericanEnglish.String())    <span class="comment">// en-US</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>json文件内容如下</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;hello&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello world&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;testFormat&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test %d&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><ul><li>安装命令<code>easy-i18n</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go install github.com/mylukin/easy-i18n/easyi18n@latest</span><br></pre></td></tr></table></figure><ul><li>执行命令将json生成go文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easyi18n generate --pkg=catalog ./locales ./catalog/catalog.go</span><br></pre></td></tr></table></figure><ul><li>然后对应的go文件直接包含即可</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	_ <span class="string">&quot;xtunnel/catalog&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="2-使用"><a href="#2-使用" class="headerlink" title="2) 使用"></a>2) 使用</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">&quot;test/catalog&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/mylukin/easy-i18n/i18n&quot;</span></span><br><span class="line">	<span class="string">&quot;golang.org/x/text/language&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p := i18n.NewPrinter(<span class="string">&quot;zh-CN&quot;</span>)</span><br><span class="line">	<span class="comment">// 使用内置的则可以使用下面语句，不过zh-CN不能用内置的，内置的是zh-Hans</span></span><br><span class="line">	<span class="comment">// p := i18n.NewPrinter(language.SimplifiedChinese)</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 直接打印</span></span><br><span class="line">	p.Printf(<span class="string">&quot;testFormat\r\n&quot;</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="comment">// 翻译成字符串</span></span><br><span class="line">	fmt.Println(p.Sprintf(<span class="string">&quot;hello&quot;</span>), p.Sprintf(<span class="string">&quot;test&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-2-github-com-gogf-gf-i18n-gi18n-强大的gf框架中的语言库"><a href="#10-2-github-com-gogf-gf-i18n-gi18n-强大的gf框架中的语言库" class="headerlink" title="10.2. github.com/gogf/gf/i18n/gi18n 强大的gf框架中的语言库"></a>10.2. <code>github.com/gogf/gf/i18n/gi18n</code> 强大的gf框架中的语言库</h3><h4 id="1-语言文件分离放置"><a href="#1-语言文件分离放置" class="headerlink" title="1) 语言文件分离放置"></a>1) 语言文件分离放置</h4><ul><li>在项目根目录新建<code>i18n</code>目录，按照语言名称新建不同的目录，名字没有限制</li><li><code>i18n</code>是默认的目录名，也可以自定义，自定义则在<code>gi18n.New()</code>设置到Options中就好</li><li>里面可以放很多个文件，根据不同模块命名即可，文件可以是toml、yml、json、xml等</li><li>目录结构如下</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">i18n</span><br><span class="line">├── en-US</span><br><span class="line">│   ├── test1.toml</span><br><span class="line">│   └── test2.toml</span><br><span class="line">├── hhhhh</span><br><span class="line">│   ├── test1.toml</span><br><span class="line">│   └── test2.toml</span><br><span class="line">└── zh-CN</span><br><span class="line">    ├── test1.toml</span><br><span class="line">    └── test2.toml</span><br></pre></td></tr></table></figure><ul><li>toml格式内容如下</li></ul><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这个是注释</span></span><br><span class="line"><span class="attr">test1</span> = <span class="string">&quot;测试1&quot;</span></span><br><span class="line"><span class="attr">testFormat</span> = <span class="string">&quot;测试格式 %d&quot;</span></span><br></pre></td></tr></table></figure><ul><li>使用如下，需要设置语言到ctx中，然后直接翻译成字符串</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gogf/gf/i18n/gi18n&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	g := gi18n.New()</span><br><span class="line">	<span class="comment">// 语言名称设置到ctx中</span></span><br><span class="line">	ctx := gi18n.WithLanguage(context.TODO(), <span class="string">&quot;hhhhh&quot;</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(g.T(ctx, <span class="string">&quot;test1&quot;</span>))</span><br><span class="line">	fmt.Println(g.Tf(ctx, <span class="string">&quot;testFormat&quot;</span>, <span class="number">1</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-语言文件打包到二进制"><a href="#2-语言文件打包到二进制" class="headerlink" title="2) 语言文件打包到二进制"></a>2) 语言文件打包到二进制</h4><ul><li>使用gf命令将文件打包到go文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">直接打包保留i18n的目录</span></span><br><span class="line">gf pack -y i18n catalog/catalog.go</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将locales下文件打包到i18n目录（对于二进制来说）</span></span><br><span class="line">gf pack -y locales -p=i18n catalog/catalog.go</span><br></pre></td></tr></table></figure><ul><li>然后对应的go文件直接包含即可</li><li>不过go自己会找当前工程目录下的i18n目录（绝对路径），所以要测试可以重命名此目录进行测试</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	_ <span class="string">&quot;test/catalog&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gogf/gf/i18n/gi18n&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//go:generate gf pack -y i18n catalog/catalog.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	g := gi18n.New()</span><br><span class="line">	<span class="comment">// 语言名称设置到ctx中</span></span><br><span class="line">	ctx := gi18n.WithLanguage(context.TODO(), <span class="string">&quot;hhhhh&quot;</span>)</span><br><span class="line"></span><br><span class="line">	fmt.Println(g.T(ctx, <span class="string">&quot;test1&quot;</span>))</span><br><span class="line">	fmt.Println(g.Tf(ctx, <span class="string">&quot;testFormat&quot;</span>, <span class="number">1</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-github-com-agiledragon-gomonkey-hook函数很好的一个库"><a href="#11-github-com-agiledragon-gomonkey-hook函数很好的一个库" class="headerlink" title="11. github.com/agiledragon/gomonkey hook函数很好的一个库"></a>11. <code>github.com/agiledragon/gomonkey</code> hook函数很好的一个库</h2><h3 id="11-1-使用"><a href="#11-1-使用" class="headerlink" title="11.1 使用"></a>11.1 使用</h3><h3 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h3><h4 id="1-直接go-test不生效，vscode调试可以"><a href="#1-直接go-test不生效，vscode调试可以" class="headerlink" title="1) 直接go test不生效，vscode调试可以"></a>1) 直接<code>go test</code>不生效，vscode调试可以</h4><ul><li>原因是直接跑编译器会自动优化代码，而此库不能对代码做优化，所以需要加<code>-gcflags &quot;all=-l&quot;</code></li><li>在vscode中点击<code>run test</code>则需要添加下面的配置到<code>settings.json</code>中</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="attr">&quot;go.testFlags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="string">&quot;-gcflags=all=-l&quot;</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="12-github-com-go-redis-redis-v7-redis操作库"><a href="#12-github-com-go-redis-redis-v7-redis操作库" class="headerlink" title="12. github.com/go-redis/redis/v7 redis操作库"></a>12. <code>github.com/go-redis/redis/v7</code> redis操作库</h2><h3 id="12-1-使用示例"><a href="#12-1-使用示例" class="headerlink" title="12.1. 使用示例"></a>12.1. 使用示例</h3><h4 id="1-测试连接"><a href="#1-测试连接" class="headerlink" title="1) 测试连接"></a>1) 测试连接</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis/v7&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	redisCli := redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr: <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		<span class="comment">// Password: &quot;123456&quot;, // no password set</span></span><br><span class="line">		DB: <span class="number">0</span>, <span class="comment">// use default DB</span></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	pong, err := redisCli.Ping().Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;reis 连接失败：&quot;</span>, pong, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;reis 连接成功：&quot;</span>, pong)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-扫描key"><a href="#2-扫描key" class="headerlink" title="2) 扫描key"></a>2) 扫描key</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		cursor <span class="type">uint64</span> = <span class="number">0</span></span><br><span class="line">		keys   []<span class="type">string</span></span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		keys, cursor, err = redisCli.Scan(cursor, <span class="string">&quot;SESS#*&quot;</span>, <span class="number">1000</span>).Result()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(keys)</span><br><span class="line">		<span class="keyword">if</span> cursor == <span class="number">0</span> &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;redis 扫描结束&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-增删改"><a href="#3-增删改" class="headerlink" title="3) 增删改"></a>3) 增删改</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="comment">// 增和改是一样的</span></span><br><span class="line">	err := redisCli.Set(key, value, <span class="number">0</span>).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 删</span></span><br><span class="line">	<span class="keyword">if</span> err := redisCli.Del(key).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;del key&quot;</span>, key, <span class="string">&quot;get err&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-golang-org-x-sync-semaphore-信号量"><a href="#13-golang-org-x-sync-semaphore-信号量" class="headerlink" title="13. golang.org/x/sync/semaphore 信号量"></a>13. <code>golang.org/x/sync/semaphore</code> 信号量</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;math/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;golang.org/x/sync/semaphore&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> lock sync.RWMutex</span><br><span class="line">	coMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">int</span>]<span class="type">bool</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建信号量，资源数为1000</span></span><br><span class="line">	s := semaphore.NewWeighted(<span class="number">10</span>)</span><br><span class="line">	<span class="comment">// 启100个协程竞争资源，同时只有10个协程拿到资源</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">100</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">			<span class="keyword">for</span> &#123;</span><br><span class="line">				err := s.Acquire(context.Background(), <span class="number">1</span>)</span><br><span class="line">				<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">					fmt.Println(err)</span><br><span class="line">					time.Sleep(time.Second)</span><br><span class="line">					<span class="keyword">continue</span></span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				lock.Lock()</span><br><span class="line">				coMap[id] = <span class="literal">true</span></span><br><span class="line">				lock.Unlock()</span><br><span class="line"></span><br><span class="line">				time.Sleep(time.Millisecond * time.Duration(rand.Intn(<span class="number">1000</span>)))</span><br><span class="line"></span><br><span class="line">				lock.Lock()</span><br><span class="line">				<span class="built_in">delete</span>(coMap, id)</span><br><span class="line">				lock.Unlock()</span><br><span class="line"></span><br><span class="line">				s.Release(<span class="number">1</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">		lock.RLock()</span><br><span class="line">		fmt.Println(<span class="string">&quot;currnet&quot;</span>, coMap)</span><br><span class="line">		lock.RUnlock()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="七、实战"><a href="#七、实战" class="headerlink" title="七、实战"></a>七、实战</h1><h2 id="1-搭建简单http服务器"><a href="#1-搭建简单http服务器" class="headerlink" title="1. 搭建简单http服务器"></a>1. 搭建简单http服务器</h2><h3 id="1-1-模板"><a href="#1-1-模板" class="headerlink" title="1.1. 模板"></a>1.1. 模板</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> retJson <span class="keyword">struct</span> &#123;</span><br><span class="line">	Code  <span class="type">int</span>    <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">	LLLL  <span class="type">string</span> <span class="string">`json:&quot;llll&quot;`</span></span><br><span class="line">	AAAA  <span class="type">string</span> <span class="string">`json:&quot;aaaa&quot;`</span></span><br><span class="line">	Token <span class="type">string</span> <span class="string">`json:&quot;token&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">smsServerHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	r.ParseForm()</span><br><span class="line">	fmt.Println(r.Form)</span><br><span class="line">	fmt.Println(<span class="string">&quot;path&quot;</span>, r.URL.Path)</span><br><span class="line">	fmt.Println(<span class="string">&quot;scheme&quot;</span>, r.URL.Scheme)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> ret retJson</span><br><span class="line">	ret.Code = <span class="number">0</span></span><br><span class="line">	ret.LLLL = <span class="string">&quot;test&quot;</span></span><br><span class="line">	ret.AAAA = <span class="string">&quot;stest&quot;</span></span><br><span class="line">	ret.Token = <span class="string">&quot;a454as1bbvd5g5s15155&quot;</span></span><br><span class="line">	retBytes, _ := json.MarshalIndent(&amp;ret, <span class="string">&quot;&quot;</span>, <span class="string">&quot;    &quot;</span>)</span><br><span class="line">	retStr := <span class="type">string</span>(retBytes)</span><br><span class="line">	fmt.Println(retStr)</span><br><span class="line"></span><br><span class="line">	w.Header().Set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application-json&quot;</span>)</span><br><span class="line">	fmt.Fprintf(w, retStr)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 接口处理到函数</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, smsServerHandler)</span><br><span class="line">	<span class="comment">// 接口处理到目录，主要用于静态页面返回</span></span><br><span class="line">	http.Handle(<span class="string">&quot;/&quot;</span>, http.FileServer(http.Dir(<span class="string">&quot;template&quot;</span>)))</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:7878&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;ListenAndServe failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-静态页面路径返回"><a href="#1-2-静态页面路径返回" class="headerlink" title="1.2. 静态页面路径返回"></a>1.2. 静态页面路径返回</h3><p><strong>最简单跟目录返回</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 接口处理到目录，主要用于静态页面返回</span></span><br><span class="line">	http.Handle(<span class="string">&quot;/&quot;</span>, http.FileServer(http.Dir(<span class="string">&quot;template&quot;</span>)))</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:7878&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;ListenAndServe failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>其他路径返回页面</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rootHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 访问根转发到template</span></span><br><span class="line">	<span class="keyword">if</span> r.URL.Path == <span class="string">&quot;/&quot;</span> &#123;</span><br><span class="line">		http.Redirect(w, r, <span class="string">&quot;/template/&quot;</span>, http.StatusFound)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	w.Write([]<span class="type">byte</span>(r.URL.Path))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 返回界面，将 /template/ 裁掉访问目录</span></span><br><span class="line">	http.Handle(<span class="string">&quot;/template/&quot;</span>, http.StripPrefix(<span class="string">&quot;/template/&quot;</span>, http.FileServer(http.Dir(<span class="string">&quot;./template&quot;</span>))))</span><br><span class="line">	<span class="comment">// 处理其他请求</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, rootHandler)</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;start server: http://localhost:4567 &quot;</span>)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:4567&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;Listen port failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-上传文件"><a href="#1-3-上传文件" class="headerlink" title="1.3. 上传文件"></a>1.3. 上传文件</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">uploadHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 获取表单的file字段</span></span><br><span class="line">	file, handler, err := r.FormFile(<span class="string">&quot;file&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;upload failed, err:&quot;</span>, err)</span><br><span class="line">		w.Write([]<span class="type">byte</span>(<span class="string">&quot;upload success&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 本地创建文件</span></span><br><span class="line">	f, err := os.Create(<span class="string">&quot;./upload_dir/&quot;</span> + handler.Filename)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> f.Close()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 文件保存</span></span><br><span class="line">	_, err = io.Copy(f, file)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	w.Write([]<span class="type">byte</span>(<span class="string">&quot;upload success&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.Handle(<span class="string">&quot;/&quot;</span>, http.FileServer(http.Dir(<span class="string">&quot;template&quot;</span>)))</span><br><span class="line">	<span class="comment">// 设置接口处理文件传输</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/uploadfile&quot;</span>, uploadHandler)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:4567&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;Listen port failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-4-302跳转"><a href="#1-4-302跳转" class="headerlink" title="1.4. 302跳转"></a>1.4. 302跳转</h3><p><strong>简单跳转</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 直接跳转</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, http.RedirectHandler(<span class="string">&quot;http://1.1.1.1&quot;</span>, http.StatusFound))</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;start server: http://localhost:4567 &quot;</span>)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:4567&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;Listen port failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>特定目录跳转</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rootHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 访问根转发到template</span></span><br><span class="line">	<span class="keyword">if</span> r.URL.Path == <span class="string">&quot;/&quot;</span> &#123;</span><br><span class="line">		http.Redirect(w, r, <span class="string">&quot;/template/&quot;</span>, http.StatusFound)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	w.Write([]<span class="type">byte</span>(r.URL.Path))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 处理其他请求</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, rootHandler)</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;start server: http://localhost:4567 &quot;</span>)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:4567&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;Listen port failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-代理转发"><a href="#1-5-代理转发" class="headerlink" title="1.5. 代理转发"></a>1.5. 代理转发</h3><ul><li>定义tr忽略证书错误</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;crypto/tls&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http/httputil&quot;</span></span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rootHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// 访问根转发到template</span></span><br><span class="line">	<span class="keyword">if</span> r.URL.Path == <span class="string">&quot;/&quot;</span> &#123;</span><br><span class="line">		http.Redirect(w, r, <span class="string">&quot;/template/&quot;</span>, http.StatusFound)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 请求转发给另一个url</span></span><br><span class="line">	remote, err := url.Parse(<span class="string">&quot;https://1.1.1.1&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatalln(<span class="string">&quot;serverAddr is invalid&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	proxy := httputil.NewSingleHostReverseProxy(remote)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 忽略证书错误</span></span><br><span class="line">	tr := &amp;http.Transport&#123;</span><br><span class="line">		TLSClientConfig: &amp;tls.Config&#123;InsecureSkipVerify: <span class="literal">true</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	proxy.Transport = tr</span><br><span class="line"></span><br><span class="line">	proxy.ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 处理其他请求</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, rootHandler)</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;start server: http://localhost:4567 &quot;</span>)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:4567&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;Listen port failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-处理post的body数据"><a href="#1-4-处理post的body数据" class="headerlink" title="1.4. 处理post的body数据"></a>1.4. 处理post的body数据</h3><ul><li>json数据存在body里面<br><strong><font color="red"><code>r.Body</code>只能读取一次，读完就会关闭，需要再次读取需要加上下面注释说明的代码</font></strong></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;crypto/tls&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http/httputil&quot;</span></span><br><span class="line">	<span class="string">&quot;net/url&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rootHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> body []<span class="type">byte</span></span><br><span class="line">	<span class="keyword">if</span> r.Body != <span class="literal">nil</span> &#123;</span><br><span class="line">		body, err = ioutil.ReadAll(r.Body)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 如果body想要多次读取需要加上下面的语句，重新申请一个readerCloser</span></span><br><span class="line">	r.Body = ioutil.NopCloser(bytes.NewReader(body))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 处理其他请求</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, rootHandler)</span><br><span class="line"></span><br><span class="line">	log.Printf(<span class="string">&quot;start server: http://localhost:4567 &quot;</span>)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:4567&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;Listen port failed, err: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="八、算法和数据结构的实现"><a href="#八、算法和数据结构的实现" class="headerlink" title="八、算法和数据结构的实现"></a>八、算法和数据结构的实现</h1><h2 id="1-数据结构"><a href="#1-数据结构" class="headerlink" title="1. 数据结构"></a>1. 数据结构</h2><h3 id="1-1-队列"><a href="#1-1-队列" class="headerlink" title="1.1. 队列"></a>1.1. 队列</h3><ul><li>可以使用<code>list.List</code>进行实现</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> test list.List</span><br><span class="line">	<span class="comment">// 入队列</span></span><br><span class="line">	test.PushBack(<span class="number">1</span>)</span><br><span class="line">	test.PushBack(<span class="number">2</span>)</span><br><span class="line">	<span class="comment">// 出队列</span></span><br><span class="line">	value := test.Front().Value</span><br><span class="line">	test.Remove(test.Front())</span><br><span class="line">	fmt.Println(value)</span><br><span class="line">	<span class="comment">// 长度</span></span><br><span class="line">	fmt.Println(test.Len())</span><br><span class="line">	<span class="comment">// 遍历</span></span><br><span class="line">	<span class="keyword">for</span> iter := test.Front(); iter != <span class="literal">nil</span>; iter = iter.Next() &#123;</span><br><span class="line">		fmt.Println(iter.Value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-栈"><a href="#1-2-栈" class="headerlink" title="1.2. 栈"></a>1.2. 栈</h3><h4 id="1-list-List实现"><a href="#1-list-List实现" class="headerlink" title="1) list.List实现"></a>1) list.List实现</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> test list.List</span><br><span class="line">	<span class="comment">// 入栈</span></span><br><span class="line">	test.PushFront(<span class="number">1</span>)</span><br><span class="line">	test.PushFront(<span class="number">2</span>)</span><br><span class="line">	test.PushFront(<span class="number">3</span>)</span><br><span class="line">	<span class="comment">// 出栈</span></span><br><span class="line">	value := test.Front().Value</span><br><span class="line">	test.Remove(test.Front())</span><br><span class="line">	fmt.Println(value)</span><br><span class="line">	<span class="comment">// 长度</span></span><br><span class="line">	fmt.Println(test.Len())</span><br><span class="line">	<span class="comment">// 从栈顶遍历</span></span><br><span class="line">	<span class="keyword">for</span> iter := test.Front(); iter != <span class="literal">nil</span>; iter = iter.Next() &#123;</span><br><span class="line">		fmt.Println(iter.Value)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-slice实现"><a href="#2-slice实现" class="headerlink" title="2) slice实现"></a>2) slice实现</h4><ul><li>slice实现有个好处就是，入栈会动态扩容，出栈容量会保留</li><li>slice实现队列会导致重复内存申请</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	test := []<span class="type">int</span>&#123;&#125;</span><br><span class="line">	<span class="comment">// 入栈</span></span><br><span class="line">	test = <span class="built_in">append</span>(test, <span class="number">1</span>)</span><br><span class="line">	test = <span class="built_in">append</span>(test, <span class="number">2</span>)</span><br><span class="line">	test = <span class="built_in">append</span>(test, <span class="number">3</span>)</span><br><span class="line">	<span class="comment">// 出栈</span></span><br><span class="line">	value := test[<span class="built_in">len</span>(test)<span class="number">-1</span>]</span><br><span class="line">	test = test[:<span class="built_in">len</span>(test)<span class="number">-1</span>]</span><br><span class="line">	fmt.Println(value)</span><br><span class="line">	<span class="comment">// 长度</span></span><br><span class="line">	fmt.Println(<span class="built_in">len</span>(test))</span><br><span class="line">	<span class="comment">// 从栈顶遍历</span></span><br><span class="line">	<span class="keyword">for</span> i := <span class="built_in">len</span>(test); i &gt; <span class="number">0</span>; i-- &#123;</span><br><span class="line">		fmt.Println(test[i<span class="number">-1</span>])</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-链表"><a href="#1-3-链表" class="headerlink" title="1.3. 链表"></a>1.3. 链表</h3><ul><li>直接使用<code>list.List</code>就好，单向双向都支持</li></ul><h3 id="1-4-大（小）根堆"><a href="#1-4-大（小）根堆" class="headerlink" title="1.4. 大（小）根堆"></a>1.4. 大（小）根堆</h3><ul><li>官方库有heap，可以进行此操作，但是需要自己实现几个接口</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> bhp <span class="keyword">struct</span>&#123; sort.IntSlice &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *bhp)</span></span> Less(i, j <span class="type">int</span>) <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> l.IntSlice.Less(j, i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *bhp)</span></span> Push(x <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	l.IntSlice = <span class="built_in">append</span>(l.IntSlice, x.(<span class="type">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *bhp)</span></span> Pop() <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">	n := <span class="built_in">len</span>(l.IntSlice)</span><br><span class="line">	x := l.IntSlice[n<span class="number">-1</span>]</span><br><span class="line">	l.IntSlice = l.IntSlice[:n<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	unorderList := []<span class="type">int</span>&#123;<span class="number">12</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">23</span>, <span class="number">45</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">2</span>&#125;</span><br><span class="line">	fmt.Println(unorderList)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 初始化大根堆</span></span><br><span class="line">	b := bhp&#123;unorderList&#125;</span><br><span class="line">	heap.Init(&amp;b)</span><br><span class="line">	<span class="comment">// 堆排序，按照顺序一直将栈顶弹出，就为从大到小排序</span></span><br><span class="line">	<span class="keyword">for</span> b.Len() &gt; <span class="number">0</span> &#123;</span><br><span class="line">		fmt.Println(heap.Pop(&amp;b))</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-二叉树"><a href="#1-5-二叉树" class="headerlink" title="1.5. 二叉树"></a>1.5. 二叉树</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TreeNode <span class="keyword">struct</span> &#123;</span><br><span class="line">	value <span class="type">int</span></span><br><span class="line">	left *TreeNode</span><br><span class="line">	right *TreeNode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-算法"><a href="#2-算法" class="headerlink" title="2. 算法"></a>2. 算法</h2><h3 id="2-1-全排列"><a href="#2-1-全排列" class="headerlink" title="2.1. 全排列"></a>2.1. 全排列</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">permutation</span><span class="params">(str []<span class="type">byte</span>, index <span class="type">int</span>, f <span class="keyword">func</span>(str []<span class="type">byte</span>)</span></span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(str) == index &#123;</span><br><span class="line">		f(str)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 不交换的场景</span></span><br><span class="line">	permutation(str, index+<span class="number">1</span>, f)</span><br><span class="line">	<span class="comment">// index对应位置向后交换</span></span><br><span class="line">	<span class="keyword">for</span> i := index + <span class="number">1</span>; i &lt; <span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line">		str[i], str[index] = str[index], str[i]</span><br><span class="line">		permutation(str, index+<span class="number">1</span>, f)</span><br><span class="line">		str[i], str[index] = str[index], str[i]</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	permutation([]<span class="type">byte</span>(<span class="string">&quot;abcd&quot;</span>), <span class="number">0</span>, <span class="function"><span class="keyword">func</span><span class="params">(str []<span class="type">byte</span>)</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="type">string</span>(str))</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-bfs-广度优先算法"><a href="#2-2-bfs-广度优先算法" class="headerlink" title="2.2. bfs 广度优先算法"></a>2.2. bfs 广度优先算法</h3><h4 id="1-二叉树的广度优先遍历"><a href="#1-二叉树的广度优先遍历" class="headerlink" title="1) 二叉树的广度优先遍历"></a>1) 二叉树的广度优先遍历</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> TreeNode <span class="keyword">struct</span> &#123;</span><br><span class="line">	value <span class="type">int</span></span><br><span class="line">	left  *TreeNode</span><br><span class="line">	right *TreeNode</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bfs</span><span class="params">(root *TreeNode)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> queue list.List</span><br><span class="line">	queue.PushBack(&amp;root)</span><br><span class="line">	<span class="keyword">for</span> queue.Len() &gt; <span class="number">0</span> &#123;</span><br><span class="line">		node := queue.Front().Value.(*TreeNode)</span><br><span class="line">		queue.Remove(queue.Front())</span><br><span class="line">		<span class="keyword">if</span> node.left != <span class="literal">nil</span> &#123;</span><br><span class="line">			queue.PushBack(node.left)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> node.right != <span class="literal">nil</span> &#123;</span><br><span class="line">			queue.PushBack(node.right)</span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Println(node.value)	<span class="comment">// 这里取值</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-方格中找两点最短路径"><a href="#2-方格中找两点最短路径" class="headerlink" title="2) 方格中找两点最短路径"></a>2) 方格中找两点最短路径</h4><ul><li>两格之间步数为1，<code>#</code>作为墙不可走</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> pointT <span class="keyword">struct</span> &#123;</span><br><span class="line">	x <span class="type">int</span></span><br><span class="line">	y <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	<span class="comment">// 按照上下左右的相对位置设定，用于后面方便找四周的点</span></span><br><span class="line">	kRoundPoints = [][]<span class="type">int</span>&#123;</span><br><span class="line">		&#123;<span class="number">0</span>, <span class="number">-1</span>&#125;,</span><br><span class="line">		&#123;<span class="number">0</span>, <span class="number">1</span>&#125;,</span><br><span class="line">		&#123;<span class="number">-1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">		&#123;<span class="number">1</span>, <span class="number">0</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回从src到dst的最短路径长度，带层间隔版本</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bfsFloor</span><span class="params">(src pointT, dst pointT, grid []<span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// 减小计算量，走过的路不再走，记录一下哪里走过了</span></span><br><span class="line">	seen := <span class="built_in">make</span>([][]<span class="type">bool</span>, <span class="built_in">len</span>(grid))</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> seen &#123;</span><br><span class="line">		seen[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="built_in">len</span>(grid[<span class="number">0</span>]))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 源地址记录走过了，注意x是第二维的坐标</span></span><br><span class="line">	seen[src.y][src.x] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用层数作为步数</span></span><br><span class="line">	curDepth := <span class="number">0</span></span><br><span class="line">	<span class="keyword">var</span> queue list.List</span><br><span class="line">	<span class="comment">// 插入源地址，作为第一层，使用nil作为层间隔</span></span><br><span class="line">	queue.PushBack(src)</span><br><span class="line">	queue.PushBack(<span class="literal">nil</span>)</span><br><span class="line">	<span class="comment">// 队列一定含有一个层间隔，不在头就在尾，如果只剩一个层间隔，说明没路可走</span></span><br><span class="line">	<span class="keyword">for</span> queue.Len() &gt; <span class="number">1</span> &#123;</span><br><span class="line">		tmp := queue.Front().Value</span><br><span class="line">		queue.Remove(queue.Front())</span><br><span class="line">		<span class="keyword">if</span> tmp == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="comment">// 找到层间隔，说明当前层遍历完了，步数加一准备下一层</span></span><br><span class="line">			curDepth++</span><br><span class="line">			<span class="comment">// 当前层遍历完，队列剩余的都是下一层，加入一个层间隔</span></span><br><span class="line">			queue.PushBack(<span class="literal">nil</span>)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断当前点是不是目标点，如果是，说明走到了，返回步数</span></span><br><span class="line">		tx, ty := tmp.(pointT).x, tmp.(pointT).y</span><br><span class="line">		<span class="keyword">if</span> tx == dst.x &amp;&amp; ty == dst.y &#123;</span><br><span class="line">			<span class="keyword">return</span> curDepth</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 不是目标点，从此点出发，向四周走一下</span></span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> kRoundPoints &#123;</span><br><span class="line">			px, py := tx+kRoundPoints[i][<span class="number">0</span>], ty+kRoundPoints[i][<span class="number">1</span>]</span><br><span class="line">			<span class="comment">// 如果超出边界或者已经走过了或者碰到墙，就继续</span></span><br><span class="line">			<span class="keyword">if</span> py &lt; <span class="number">0</span> || py &gt;= <span class="built_in">len</span>(grid) || px &lt; <span class="number">0</span> || px &gt;= <span class="built_in">len</span>(grid[<span class="number">0</span>]) || seen[py][px] || grid[py][px] == <span class="string">&#x27;#&#x27;</span> &#123;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 这个点可以走，走上去，记录到队列中，作为下一层的起点</span></span><br><span class="line">			seen[py][px] = <span class="literal">true</span></span><br><span class="line">			queue.PushBack(pointT&#123;px, py&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> pointST <span class="keyword">struct</span> &#123;</span><br><span class="line">	x    <span class="type">int</span></span><br><span class="line">	y    <span class="type">int</span></span><br><span class="line">	step <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 返回从src到dst的最短路径长度</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bfs</span><span class="params">(src pointST, dst pointST, grid []<span class="type">string</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="comment">// 减小计算量，走过的路不再走，记录一下哪里走过了</span></span><br><span class="line">	seen := <span class="built_in">make</span>([][]<span class="type">bool</span>, <span class="built_in">len</span>(grid))</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> seen &#123;</span><br><span class="line">		seen[i] = <span class="built_in">make</span>([]<span class="type">bool</span>, <span class="built_in">len</span>(grid[<span class="number">0</span>]))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 源地址记录走过了，注意x是第二维的坐标</span></span><br><span class="line">	seen[src.y][src.x] = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> queue list.List</span><br><span class="line">	<span class="comment">// 插入源地址</span></span><br><span class="line">	queue.PushBack(src)</span><br><span class="line">	<span class="keyword">for</span> queue.Len() &gt; <span class="number">0</span> &#123;</span><br><span class="line">		tmp := queue.Front().Value.(pointST)</span><br><span class="line">		queue.Remove(queue.Front())</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断当前点是不是目标点，如果是，说明走到了，返回步数</span></span><br><span class="line">		<span class="keyword">if</span> tmp.x == dst.x &amp;&amp; tmp.y == dst.y &#123;</span><br><span class="line">			<span class="keyword">return</span> tmp.step</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 不是目标点，从此点出发，向四周走一下</span></span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> kRoundPoints &#123;</span><br><span class="line">			px, py := tmp.x+kRoundPoints[i][<span class="number">0</span>], tmp.y+kRoundPoints[i][<span class="number">1</span>]</span><br><span class="line">			<span class="comment">// 如果超出边界或者已经走过了或者碰到墙，就继续</span></span><br><span class="line">			<span class="keyword">if</span> py &lt; <span class="number">0</span> || py &gt;= <span class="built_in">len</span>(grid) || px &lt; <span class="number">0</span> || px &gt;= <span class="built_in">len</span>(grid[<span class="number">0</span>]) || seen[py][px] || grid[py][px] == <span class="string">&#x27;#&#x27;</span> &#123;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 这个点可以走，走上去，记录到队列中，作为下一层的起点</span></span><br><span class="line">			seen[py][px] = <span class="literal">true</span></span><br><span class="line">			queue.PushBack(pointST&#123;px, py, tmp.step+<span class="number">1</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">		@ # . . *</span></span><br><span class="line"><span class="comment">		. . . # .</span></span><br><span class="line"><span class="comment">		# . . . .</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	grid := []<span class="type">string</span>&#123;<span class="string">&quot;@#..*&quot;</span>, <span class="string">&quot;...#.&quot;</span>, <span class="string">&quot;#....&quot;</span>&#125;</span><br><span class="line">	<span class="comment">// @ 到 * 的最短距离为6</span></span><br><span class="line">	fmt.Println(bfs(pointST&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, pointST&#123;<span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, grid))</span><br><span class="line">	fmt.Println(bfsFloor(pointT&#123;<span class="number">0</span>, <span class="number">0</span>&#125;, pointT&#123;<span class="number">4</span>, <span class="number">0</span>&#125;, grid))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="九、go-work-大工程开发利器"><a href="#九、go-work-大工程开发利器" class="headerlink" title="九、go.work 大工程开发利器"></a>九、go.work 大工程开发利器</h1><p>vscode只能当go.mod在根目录的情况下才能进行提示，而在大工程情况下，go.mod可能不止一个。使用go.work之后，可以解决这个问题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">初始化go.work</span></span><br><span class="line">go work init</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加一个目录</span></span><br><span class="line">go work use path/to/project</span><br></pre></td></tr></table></figure><h1 id="踩坑记-1"><a href="#踩坑记-1" class="headerlink" title="踩坑记"></a>踩坑记</h1><h2 id="1-编译报错"><a href="#1-编译报错" class="headerlink" title="1. 编译报错"></a>1. 编译报错</h2><h3 id="1-1-method-has-pointer-receiverd"><a href="#1-1-method-has-pointer-receiverd" class="headerlink" title="1.1. method has pointer receiverd"></a>1.1. method has pointer receiverd</h3><ul><li>由于定义的接口多个方法的接受不一致导致</li><li>部分方法实现使用了指针，部分使用了原始类型</li><li>golang编译器发现<code>*T</code>类型实现了接口，调用的时候传入的又是<code>T</code>就给报错了</li></ul><h2 id="2-协程相关"><a href="#2-协程相关" class="headerlink" title="2. 协程相关"></a>2. 协程相关</h2><h3 id="2-1-循环起协程"><a href="#2-1-循环起协程" class="headerlink" title="2.1. 循环起协程"></a>2.1. 循环起协程</h3><ul><li>迭代器会被更改，最终留下的是最后一个</li><li>应该当参数传入</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	a := []<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> a &#123;</span><br><span class="line">		wg.Add(<span class="number">2</span>)</span><br><span class="line">		<span class="comment">// 拿到的是最后一个</span></span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			fmt.Println(<span class="string">&quot;wrong&quot;</span>, i)</span><br><span class="line">		&#125;()</span><br><span class="line">		<span class="comment">// 这样就可以了</span></span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			fmt.Println(<span class="string">&quot;right&quot;</span>, i)</span><br><span class="line">		&#125;(i)</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="reward-container"><div></div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.png" alt="王钰博 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/alipay.jpg" alt="王钰博 支付宝"><p>支付宝</p></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/go/" rel="tag"># go</a></div><div class="post-nav"><div class="post-nav-item"><a href="/blogs/2021-04-02-archlinux/" rel="prev" title="archlinux 安装和配置"><i class="fa fa-chevron-left"></i> archlinux 安装和配置</a></div><div class="post-nav-item"><a href="/blogs/2021-04-23-nginx/" rel="next" title="nginx配置和源码分析">nginx配置和源码分析 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80"><span class="nav-text">一、前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%8E%AF%E5%A2%83"><span class="nav-text">1. 环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%AE%89%E8%A3%85gvm%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="nav-text">2. 安装gvm版本管理工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%AE%89%E8%A3%85"><span class="nav-text">2.1. 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E4%BD%BF%E7%94%A8"><span class="nav-text">2.2. 使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E8%AF%AD%E6%B3%95%E7%9B%B8%E5%85%B3"><span class="nav-text">二、语法相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="nav-text">1. 基本类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%8E%BB%E9%99%A4%E5%8F%98%E9%87%8F%E6%9C%AA%E5%AE%9A%E4%B9%89%E6%8F%90%E7%A4%BA"><span class="nav-text">1.1. 去除变量未定义提示</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-int"><span class="nav-text">1.2. int</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-%E5%A4%A7%E5%B0%8F"><span class="nav-text">1) 大小</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-text">2) 类型转换</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-text">1.2. 类型转换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#float32-float64"><span class="nav-text">float32 float64</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#byte"><span class="nav-text">[]byte</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#interface"><span class="nav-text">interface</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-string"><span class="nav-text">1.2. string</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%BD%AC%E6%8D%A2"><span class="nav-text">1) 转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8C%E5%8F%8C%E5%BC%95%E5%8F%B7%EF%BC%8C%E5%8F%8D%E5%BC%95%E5%8F%B7%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">2) 单引号，双引号，反引号的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E5%8F%96"><span class="nav-text">2) 字符串截取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E9%81%8D%E5%8E%86"><span class="nav-text">3) 遍历</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E4%BF%AE%E6%94%B9"><span class="nav-text">4) 修改</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-map"><span class="nav-text">2. map</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">2.1. 一些基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-map%E5%8F%96%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%80%BC"><span class="nav-text">2.2. map取不存在的值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-text">2.3. 底层实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-array"><span class="nav-text">3. array</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">3.1. 一些基本操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="nav-text">5. 流程控制语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-for-%E5%BE%AA%E7%8E%AF"><span class="nav-text">5.1. for 循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-switch"><span class="nav-text">5.2. switch</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%87%BD%E6%95%B0"><span class="nav-text">6. 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E5%AE%9A%E4%B9%89%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-text">6.1. 定义和返回值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E5%80%BC%E4%BC%A0%E9%80%92"><span class="nav-text">6.2. 值传递</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-go%E5%87%BD%E6%95%B0%E9%83%BD%E6%98%AF%E5%80%BC%E4%BC%A0%E9%80%92"><span class="nav-text">(1) go函数都是值传递</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-slice%E3%80%81map%E3%80%81channel%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%9C%8B%E4%BC%BC%E5%BC%95%E7%94%A8%E4%BC%A0%E9%80%92%E7%9A%84%E8%A7%A3%E9%87%8A"><span class="nav-text">(2) slice、map、channel类型的看似引用传递的解释</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#slice"><span class="nav-text">slice</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#map%E5%92%8Cchannel%E9%83%BD%E6%98%AF%E6%8C%87%E9%92%88"><span class="nav-text">map和channel都是指针</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E7%BB%84%E5%90%88%E8%B5%8B%E5%80%BC"><span class="nav-text">7. 组合赋值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-i-%E3%80%81i%E2%80%93"><span class="nav-text">8. i++、i–</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-const-iota"><span class="nav-text">9. const &amp; iota</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-itoa"><span class="nav-text">9.1. itoa</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%AF%8F%E6%AC%A1-const-%E5%87%BA%E7%8E%B0%E6%97%B6%EF%BC%8C%E9%83%BD%E4%BC%9A%E8%AE%A9-iota-%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%BA0"><span class="nav-text">(1) 每次 const 出现时，都会让 iota 初始化为0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B"><span class="nav-text">(2) 自定义类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%8F%AF%E8%B7%B3%E8%BF%87%E7%9A%84%E5%80%BC"><span class="nav-text">(3) 可跳过的值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E4%BD%8D%E6%8E%A9%E7%A0%81%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-text">(4) 位掩码表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E5%AE%9A%E4%B9%89%E6%95%B0%E9%87%8F%E7%BA%A7"><span class="nav-text">(5) 定义数量级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%AE%9A%E4%B9%89%E5%9C%A8%E4%B8%80%E8%A1%8C%E7%9A%84%E6%83%85%E5%86%B5"><span class="nav-text">(6) 定义在一行的情况</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E4%B8%AD%E9%97%B4%E6%8F%92%E9%98%9F"><span class="nav-text">(7) 中间插队</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E5%B9%B6%E5%8F%91"><span class="nav-text">10. 并发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">10.1. 基础概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-sync-WaitGroup-%E7%AD%89%E5%BE%85%E9%80%80%E5%87%BA"><span class="nav-text">10.2. sync.WaitGroup 等待退出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-runtime-GOMAXPROCS-i-int-%E9%99%90%E5%AE%9A%E5%8D%A0%E7%94%A8%E6%A0%B8%E5%BF%83%E6%95%B0"><span class="nav-text">10.3. runtime.GOMAXPROCS(i int) 限定占用核心数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4-%E4%BA%92%E6%96%A5%E9%94%81"><span class="nav-text">10.4. 互斥锁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="nav-text">11. 面向对象编程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95"><span class="nav-text">11.1. 属性和方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="nav-text">11.2. 访问权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-%E7%BB%A7%E6%89%BF"><span class="nav-text">11.3. 继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-4-%E5%A4%9A%E6%80%81"><span class="nav-text">11.4. 多态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="nav-text">11.5. 析构函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-6-%E7%BA%AF%E8%99%9A%E5%87%BD%E6%95%B0"><span class="nav-text">11.6. 纯虚函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E6%8C%87%E9%92%88"><span class="nav-text">12. 指针</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-int%E8%BD%AC%E6%8C%87%E9%92%88"><span class="nav-text">12.1. int转指针</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-GC-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6"><span class="nav-text">13. GC 垃圾回收机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-text">13.1. 内存管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-GC%E8%A7%A6%E5%8F%91%E6%97%B6%E6%9C%BA"><span class="nav-text">13.2. GC触发时机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-3-GC%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%BE%BF%E5%88%A9%E5%92%8C%E5%9D%91"><span class="nav-text">13.3. GC带来的便利和坑</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BE%BF%E5%88%A9"><span class="nav-text">1) 便利</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-struct"><span class="nav-text">14. struct</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-1-String-%E9%BB%98%E8%AE%A4%E6%89%93%E5%8D%B0%E6%96%B9%E6%B3%95"><span class="nav-text">14.1. String() 默认打印方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-%E5%88%9D%E5%A7%8B%E5%8C%96%E7%88%B6%E7%B1%BB%E5%B1%9E%E6%80%A7"><span class="nav-text">14.2. 初始化父类属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-%E5%B8%B8%E9%87%8F"><span class="nav-text">15. 常量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-package-%E5%8C%85"><span class="nav-text">16. package 包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-1-init%E5%87%BD%E6%95%B0"><span class="nav-text">16.1. init函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-channel"><span class="nav-text">17. channel</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#17-1-%E5%9F%BA%E6%9C%AC%E7%9F%A5%E8%AF%86"><span class="nav-text">17.1. 基本知识</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-2-close%E5%90%8E%E7%9A%84%E7%89%B9%E6%80%A7"><span class="nav-text">17.2. close后的特性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-close%E4%B9%8B%E5%90%8E%E4%B8%8D%E8%83%BD%E5%86%99%EF%BC%8C%E6%AD%A3%E5%9C%A8%E5%86%99%E7%9A%84%E4%BC%9A%E5%B4%A9%E6%BA%83"><span class="nav-text">1) close之后不能写，正在写的会崩溃</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-close%E4%B9%8B%E5%90%8E%E5%8F%AF%E4%BB%A5%E8%AF%BB%EF%BC%8C%E6%8A%8A%E6%B2%A1%E8%AF%BB%E5%AE%8C%E7%9A%84%E8%AF%BB%E5%AE%8C%E5%B0%B1%E9%80%80%E5%87%BA%E4%BA%86%EF%BC%8Cfor%E5%B0%B1%E8%AF%BB%E5%AE%8C%E9%80%80%E5%87%BA%EF%BC%8C%E6%B2%A1%E6%95%B0%E6%8D%AE%E7%9B%B4%E6%8E%A5%E8%AF%BB%E6%8B%BF%E5%88%B0%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="nav-text">2) close之后可以读，把没读完的读完就退出了，for就读完退出，没数据直接读拿到默认值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-3-%E7%BC%93%E5%86%B2%E4%B8%8E%E6%97%A0%E7%BC%93%E5%86%B2"><span class="nav-text">17.3. 缓冲与无缓冲</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-4-%E5%8F%AA%E8%AF%BB%E5%92%8C%E5%8F%AA%E5%86%99chan"><span class="nav-text">17.4. 只读和只写chan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#17-5-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="nav-text">17.5. 底层原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-slice"><span class="nav-text">18. slice</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#18-1-%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">18.1. 一些基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-2-%E5%88%87%E7%89%87%E6%88%AA%E5%8F%96"><span class="nav-text">18.2. 切片截取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-3-%E5%8A%A8%E6%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%EF%BC%88%E7%9F%A9%E9%98%B5%EF%BC%89"><span class="nav-text">18.3. 动态初始化二维数组（矩阵）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#18-4-%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-text">18.4. 底层实现原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">底层数据结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%AE%B9"><span class="nav-text">扩容</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-import-%E5%AF%BC%E5%85%A5%E5%8C%85"><span class="nav-text">19. import 导入包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#19-1-%E6%99%AE%E9%80%9A%E5%AF%BC%E5%85%A5"><span class="nav-text">19.1. 普通导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-2-%E5%88%AB%E5%90%8D%E5%AF%BC%E5%85%A5"><span class="nav-text">19.2. 别名导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-3-%E9%9A%90%E8%97%8F%E5%AF%BC%E5%85%A5"><span class="nav-text">19.3. 隐藏导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#19-4-%E4%B8%8D%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E5%8C%85%E5%90%8D%E5%AD%97%E8%B0%83%E7%94%A8"><span class="nav-text">19.4. 不需要使用包名字调用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-%E6%B3%9B%E5%9E%8B"><span class="nav-text">20. 泛型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#20-1-%E6%B3%9B%E5%9E%8B%E5%87%BD%E6%95%B0"><span class="nav-text">20.1. 泛型函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-2-%E6%B3%9B%E5%9E%8B%E7%9A%84%E9%99%90%E5%88%B6"><span class="nav-text">20.2. 泛型的限制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%9B%E5%9E%8B%E7%B1%BB%E5%9E%8B"><span class="nav-text">20.3. 自定义泛型类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#comparable"><span class="nav-text">comparable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%B6%E4%BB%96%E7%B1%BB%E5%9E%8B"><span class="nav-text">自定义其他类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%8D%E7%94%9F%E7%B1%BB%E5%9E%8B"><span class="nav-text">衍生类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E5%AE%9A%E4%B9%89%E7%9A%84%E8%A1%8D%E7%94%9F%E7%B1%BB%E5%9E%8B-golang-org-x-exp-constraints"><span class="nav-text">官方定义的衍生类型 golang.org&#x2F;x&#x2F;exp&#x2F;constraints</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-defer"><span class="nav-text">21. defer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#21-1-defer%E8%B0%83%E7%94%A8%E6%97%B6%E6%9C%BA%E5%92%8C%E9%A1%BA%E5%BA%8F"><span class="nav-text">21.1. defer调用时机和顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#21-2-defer%E5%92%8C%E5%91%BD%E5%90%8D%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-text">21.2. defer和命名返回值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-text">22. 作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#22-1-%E4%BD%9C%E7%94%A8%E5%9F%9F%E5%8F%98%E5%8C%96%E7%9A%84"><span class="nav-text">22.1. 作用域变化的:&#x3D;</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-%E8%B7%A8%E5%B9%B3%E5%8F%B0"><span class="nav-text">23. 跨平台</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81GMP%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%9E%8B"><span class="nav-text">三、GMP运行模型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%87%A0%E4%B8%AA%E5%8E%9F%E5%88%99"><span class="nav-text">1. 几个原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95"><span class="nav-text">2. 调试方法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%A0%87%E5%87%86%E5%BA%93"><span class="nav-text">四、标准库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-encoding-json"><span class="nav-text">1. encoding&#x2F;json</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">1.1. 一些基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-key%E6%8E%92%E5%BA%8F%E8%BD%ACjson"><span class="nav-text">1.2. key排序转json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E5%8D%95%E7%BA%AF%E6%83%B3%E5%8E%8B%E7%BC%A9json%E4%B8%8D%E4%BF%AE%E6%94%B9key%E9%A1%BA%E5%BA%8F"><span class="nav-text">1.3. 单纯想压缩json不修改key顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-testing-%E5%8D%95%E6%B5%8B"><span class="nav-text">2. testing 单测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-text">2.2. 性能分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-flag-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="nav-text">3. flag 控制台参数解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E8%8E%B7%E5%8F%96%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="nav-text">3.1. 获取命令行参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-path-filepath-%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C%E5%BA%93"><span class="nav-text">4. path&#x2F;filepath 目录操作库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E9%81%8D%E5%8E%86%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6%E5%92%8C%E7%9B%AE%E5%BD%95%EF%BC%8C%E7%B1%BB%E4%BC%BC-find-xxx"><span class="nav-text">4.1. 遍历目录下所有文件和目录，类似 find xxx</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E8%B7%AF%E5%BE%84%E5%A4%84%E7%90%86"><span class="nav-text">4.2. 路径处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-os-exec-%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%B0%83%E7%94%A8"><span class="nav-text">5. os&#x2F;exec 命令行调用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E9%98%BB%E5%A1%9E%E5%BC%8F%E7%AD%89%E5%BE%85%E8%BF%94%E5%9B%9E%EF%BC%8C%E5%B9%B6%E8%BE%93%E5%87%BAstdout"><span class="nav-text">5.1. 阻塞式等待返回，并输出stdout</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-net-http-http%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%BA%93"><span class="nav-text">6. net&#x2F;http http网络请求库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E5%8F%91%E9%80%81post%E8%AF%B7%E6%B1%82"><span class="nav-text">6.1. 发送post请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E5%BF%BD%E7%95%A5https%E7%9A%84%E8%AF%81%E4%B9%A6%E9%94%99%E8%AF%AF"><span class="nav-text">6.2. 忽略https的证书错误</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-text">(1) 修改默认客户端</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-302%E4%B8%8D%E8%B7%B3%E8%BD%AC"><span class="nav-text">6.3. 302不跳转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4-%E8%8E%B7%E5%8F%96tcp%E7%9A%84%E5%9B%9B%E5%85%83%E7%BB%84"><span class="nav-text">6.4. 获取tcp的四元组</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-strings-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E5%BA%93"><span class="nav-text">7. strings 字符串操作库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9B%BF%E6%8D%A2"><span class="nav-text">7.1. 字符串替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E8%A3%81%E5%89%AA%E4%B8%A4%E7%AB%AF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">7.2. 裁剪两端字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%86%E5%89%B2"><span class="nav-text">7.3. 字符串分割</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%AF%94%E8%BE%83"><span class="nav-text">7.4. 字符串比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-encoding-hex-%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%93%8D%E4%BD%9C%E5%BA%93"><span class="nav-text">8. encoding&#x2F;hex 十六进制操作库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E5%B0%86%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%88%90%E6%95%B0%E7%BB%84"><span class="nav-text">8.1. 将十六进制字符串转成数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-%E5%B0%86-byte%E6%8C%89%E7%85%A7%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%89%93%E5%8D%B0%E6%88%90%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">8.2. 将[]byte按照十六进制打印成字符串</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-io-ioutil-io%E6%93%8D%E4%BD%9C%EF%BC%88%E5%88%B0go1-16%E4%B9%8B%E5%90%8E%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8io%E6%88%96os%E5%BA%93%E6%9B%BF%E4%BB%A3%EF%BC%89"><span class="nav-text">9. io&#x2F;ioutil io操作（到go1.16之后可以使用io或os库替代）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-text">9.1. 文件读取</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-os-%E7%B3%BB%E7%BB%9F%E6%93%8D%E4%BD%9C"><span class="nav-text">10. os 系统操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C"><span class="nav-text">10.1. 目录操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">1) 基本操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-text">10.2. 文件操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%95%B4%E4%B8%AA%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-text">1) 整个文件读取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%8C%89%E8%A1%8C%E8%AF%BB%E5%8F%96"><span class="nav-text">2) 按行读取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="nav-text">3) 写入文件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-stronv"><span class="nav-text">11. stronv</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-net-%E7%BD%91%E7%BB%9C%E5%BA%93"><span class="nav-text">12. net 网络库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-udp%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6"><span class="nav-text">12.1. udp发送和接收</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2-%E7%BB%99socket%E8%AE%BE%E7%BD%AEopt"><span class="nav-text">12.2. 给socket设置opt</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%99%AE%E9%80%9A%E7%B1%BB%E5%9E%8B%E8%AE%BE%E7%BD%AE"><span class="nav-text">1) 普通类型设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93%E8%AE%BE%E7%BD%AE"><span class="nav-text">2) 自定义结构体设置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-time-%E6%97%B6%E9%97%B4%E5%BA%93"><span class="nav-text">13. time 时间库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">13.1. 基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2-%E6%97%B6%E9%92%9F%E8%AF%B4%E6%98%8E"><span class="nav-text">13.2. 时钟说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-sort-%E6%8E%92%E5%BA%8F"><span class="nav-text">14. sort 排序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#14-1-%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B%E6%8E%92%E5%BA%8F"><span class="nav-text">14.1. 基本类型排序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%8D%87%E5%BA%8F"><span class="nav-text">1) 升序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E9%99%8D%E5%BA%8F"><span class="nav-text">2) 降序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-2-%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE"><span class="nav-text">14.2. 二分查找</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%99%AE%E9%80%9A%E7%B1%BB%E5%9E%8B"><span class="nav-text">1) 普通类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BD%BF%E7%94%A8strings-Compare"><span class="nav-text">2) 字符串使用strings.Compare()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-3-%E4%BB%BB%E6%84%8F%E7%B1%BB%E5%9E%8B%E7%9A%84slice%E6%8E%92%E5%BA%8F"><span class="nav-text">14.3. 任意类型的slice排序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B"><span class="nav-text">1) 数字类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="nav-text">2) 字符串类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E6%8E%92%E5%BA%8F"><span class="nav-text">14.4. 自定义类型排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#14-5-sort%E5%86%85%E7%BD%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">14.5. sort内置类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-image-%E5%9B%BE%E5%83%8F%E5%BA%93"><span class="nav-text">15. image 图像库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#15-1-png%E5%A4%84%E7%90%86"><span class="nav-text">15.1. png处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-container-list-%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8"><span class="nav-text">16. container&#x2F;list 双向链表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#16-1-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">16.1. 基本操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B8%A9%E5%9D%91%E8%AE%B0"><span class="nav-text">踩坑记</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-list%E6%94%BE%E5%88%B0%E7%BB%93%E6%9E%84%E4%BD%93%E9%87%8C%E9%9D%A2%E4%B8%80%E5%AE%9A%E8%A6%81%E6%B3%A8%E6%84%8F%E7%BB%93%E6%9E%84%E4%BD%93%E6%8B%B7%E8%B4%9D%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%8C%E5%BB%BA%E8%AE%AE%E5%9C%A8%E7%BB%93%E6%9E%84%E4%BD%93%E9%87%8C%E9%9D%A2%E4%BD%BF%E7%94%A8%E6%8C%87%E9%92%88"><span class="nav-text">1) list放到结构体里面一定要注意结构体拷贝的问题，建议在结构体里面使用指针</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-runtime-%E4%B8%80%E4%BA%9B%E8%BF%90%E8%A1%8C%E9%9C%80%E8%A6%81%E7%9A%84%E5%8F%98%E9%87%8F%E5%92%8C%E6%96%B9%E6%B3%95"><span class="nav-text">17. runtime 一些运行需要的变量和方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#17-1-%E5%B8%B8%E7%94%A8%E5%8F%98%E9%87%8F"><span class="nav-text">17.1. 常用变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-runtime-GOOS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%B1%BB%E5%9E%8B"><span class="nav-text">1) runtime.GOOS 操作系统类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-io-io%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="nav-text">18. io io相关操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-regexp-%E6%AD%A3%E5%88%99%E5%BA%93"><span class="nav-text">19. regexp 正则库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#19-1-%E6%8F%90%E5%8F%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">19.1. 提取字符串</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-archive-zip-zip%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="nav-text">20. archive&#x2F;zip zip相关操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#20-1-%E8%A7%A3%E5%8E%8B%E7%BC%A9"><span class="nav-text">20.1. 解压缩</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#20-2-%E5%8E%8B%E7%BC%A9"><span class="nav-text">20.2. 压缩</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-exec-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="nav-text">21. exec 执行命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#21-1-%E6%89%93%E5%BC%80%E6%B5%8F%E8%A7%88%E5%99%A8"><span class="nav-text">21.1. 打开浏览器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-heap-%E5%A0%86"><span class="nav-text">22. heap 堆</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#22-1-%E5%B0%8F%E6%A0%B9%E5%A0%86"><span class="nav-text">22.1. 小根堆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#22-2-%E5%A4%A7%E6%A0%B9%E5%A0%86"><span class="nav-text">22.2. 大根堆</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-context"><span class="nav-text">23. context</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#23-1-%E5%85%B3%E9%97%AD%E5%AD%90%E5%8D%8F%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-text">23.1. 关闭子协程的方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%89%8B%E5%8A%A8%E5%85%B3%E9%97%AD%E5%8D%8F%E7%A8%8B"><span class="nav-text">1) 手动关闭协程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%AE%9A%E7%82%B9%E5%85%B3%E9%97%AD%E5%8D%8F%E7%A8%8B"><span class="nav-text">2) 定点关闭协程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%AE%9A%E6%97%B6%E5%85%B3%E9%97%AD%E5%8D%8F%E7%A8%8B"><span class="nav-text">3) 定时关闭协程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E5%B8%A6%E5%8E%9F%E5%9B%A0%E7%9A%84%E5%8F%96%E6%B6%88"><span class="nav-text">4) 带原因的取消</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#23-2-%E6%90%BA%E5%B8%A6%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-text">23.2. 携带上下文</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-os-signal-%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86%E5%BA%93"><span class="nav-text">24. os&#x2F;signal 信号处理库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#24-1-%E6%8D%95%E8%8E%B7%E4%BF%A1%E5%8F%B7"><span class="nav-text">24.1. 捕获信号</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-fmt-%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA%E5%BA%93"><span class="nav-text">25. fmt 格式化输出库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#25-1-Sprintf-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">25.1. Sprintf 格式化字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%BA%E5%BA%8F%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8F%82%E6%95%B0"><span class="nav-text">1) 自定义顺序格式化参数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-math-bits-%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%9B%B8%E5%85%B3"><span class="nav-text">26. math&#x2F;bits 二进制相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#26-1-%E7%BB%9F%E8%AE%A1%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%AD1%E7%9A%84%E4%B8%AA%E6%95%B0"><span class="nav-text">26.1. 统计二进制中1的个数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81cgo"><span class="nav-text">五、cgo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%A4%9A%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91"><span class="nav-text">1. 多平台编译</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%B9%B3%E5%8F%B0%E4%B8%8D%E5%90%8C%E7%9A%84flag"><span class="nav-text">1.1. 平台不同的flag</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-pkg-config-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%A8%E6%80%81%E5%BA%93%E8%B7%AF%E5%BE%84"><span class="nav-text">2. pkg-config 自定义动态库路径</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81go%E5%91%BD%E4%BB%A4%E7%9B%B8%E5%85%B3"><span class="nav-text">六、go命令相关</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-go-test-%E6%89%A7%E8%A1%8C%E5%8D%95%E6%B5%8B%E7%94%A8%E4%BE%8B"><span class="nav-text">1. go test 执行单测用例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-go-build-%E7%BC%96%E8%AF%91%E4%BA%8C%E8%BF%9B%E5%88%B6"><span class="nav-text">2. go build 编译二进制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-windows-32bit%E5%92%8C64bit"><span class="nav-text">2.1. windows 32bit和64bit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%85%A8%E5%B9%B3%E5%8F%B0%E7%BC%96%E8%AF%91makefile%E7%A4%BA%E4%BE%8B"><span class="nav-text">2.2. 全平台编译makefile示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E7%BC%96%E8%AF%91%E7%BB%99c%E8%B0%83%E7%94%A8%E7%9A%84%E5%8A%A8%E6%80%81%E5%BA%93"><span class="nav-text">2.3. 编译给c调用的动态库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-go-env-%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">3. go env 设置环境变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-go-install-%E5%AE%89%E8%A3%85%E5%85%A8%E5%B1%80%E5%8C%85"><span class="nav-text">4. go install 安装全局包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%E9%93%BE%E6%8E%A5"><span class="nav-text">4.1. 常用工具链接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-go-generate-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="nav-text">5. go generate 执行命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-dlv-%E8%B0%83%E8%AF%95go%E7%A8%8B%E5%BA%8F"><span class="nav-text">6. dlv 调试go程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-dlv%E7%9B%91%E5%90%AC%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95"><span class="nav-text">6.1. dlv监听远程调试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%A1%86%E6%9E%B6"><span class="nav-text">五、框架</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%B7%A5%E7%A8%8B%E7%9F%A5%E8%AF%86"><span class="nav-text">1. 工程知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-go-mod"><span class="nav-text">1.1. go.mod</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E6%96%B0%E5%B7%A5%E7%A8%8B"><span class="nav-text">1) 创建新工程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-go-mod-%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">2) go mod 一些基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-vendor"><span class="nav-text">(1) vendor</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-goframe"><span class="nav-text">2. goframe</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="nav-text">2.1. 安装配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">2.2. 开发知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-orm%E6%97%B6%E9%97%B4%E7%BB%B4%E6%8A%A4%E5%8A%9F%E8%83%BD"><span class="nav-text">2.2.1. orm时间维护功能</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-2-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%AD%97%E6%AE%B5%E5%AF%B9%E5%BA%94"><span class="nav-text">2.2.2. 前后端字段对应</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%A5%BD%E7%94%A8%E7%9A%84%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93"><span class="nav-text">六、好用的第三方库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-github-com-google-uuid-uuid"><span class="nav-text">1. github.com&#x2F;google&#x2F;uuid uuid</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-github-com-makiuchi-d-gozxing-%E4%BA%8C%E7%BB%B4%E7%A0%81%E8%A7%A3%E6%9E%90%E5%92%8C%E7%94%9F%E6%88%90"><span class="nav-text">2. github.com&#x2F;makiuchi-d&#x2F;gozxing 二维码解析和生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-golang-org-x-mobile-go%E5%BC%80%E5%8F%91android%E5%92%8Cios"><span class="nav-text">3. golang.org&#x2F;x&#x2F;mobile go开发android和ios</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-github-com-shirou-gopsutil-process-%E8%8E%B7%E5%8F%96%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="nav-text">4. github.com&#x2F;shirou&#x2F;gopsutil&#x2F;process 获取进程相关信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E8%8E%B7%E5%8F%96%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="nav-text">4.1. 获取进程信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-github-com-miekg-dns-%E6%9E%84%E9%80%A0dns%E5%8C%85%E5%8F%91%E9%80%81"><span class="nav-text">5. github.com&#x2F;miekg&#x2F;dns 构造dns包发送</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E8%8E%B7%E5%8F%96%E5%9F%9F%E5%90%8D%E7%89%B9%E5%AE%9A%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%A7%A3%E6%9E%90"><span class="nav-text">5.1. 获取域名特定类型的解析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-golang-org-x-text-encoding-simplifiedchinese-%E4%B8%AD%E6%96%87%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2"><span class="nav-text">6. golang.org&#x2F;x&#x2F;text&#x2F;encoding&#x2F;simplifiedchinese 中文编码转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-github-com-google-gopacket"><span class="nav-text">7. github.com&#x2F;google&#x2F;gopacket</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E6%9E%84%E9%80%A0ip%E5%8C%85"><span class="nav-text">7.1. 构造ip包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-github-com-songgao-water-linux%E8%99%9A%E6%8B%9F%E7%BD%91%E5%8D%A1%E8%AE%BE%E5%A4%87"><span class="nav-text">8. github.com&#x2F;songgao&#x2F;water linux虚拟网卡设备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E6%9E%84%E9%80%A0tun%E8%AE%BE%E5%A4%87%E8%AF%BB%E5%86%99%E6%95%B0%E6%8D%AE"><span class="nav-text">8.1. 构造tun设备读写数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-github-com-smartystreets-goconvey-convey-%E5%8D%95%E6%B5%8B%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7"><span class="nav-text">9. github.com&#x2F;smartystreets&#x2F;goconvey&#x2F;convey 单测辅助工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-%E4%B8%80%E8%88%AC%E7%94%A8%E6%B3%95"><span class="nav-text">9.1. 一般用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-convey%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-text">9.2. convey执行顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E5%9B%BD%E9%99%85%E5%8C%96%E5%BA%93"><span class="nav-text">10. 国际化库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-github-com-mylukin-easy-i18n-i18n-%E8%BD%BB%E9%87%8F%E7%AE%80%E5%8D%95%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96%E5%BA%93"><span class="nav-text">10.1. github.com&#x2F;mylukin&#x2F;easy-i18n&#x2F;i18n 轻量简单的国际化库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-text">1) 准备工作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E4%BD%BF%E7%94%A8"><span class="nav-text">2) 使用</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-github-com-gogf-gf-i18n-gi18n-%E5%BC%BA%E5%A4%A7%E7%9A%84gf%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84%E8%AF%AD%E8%A8%80%E5%BA%93"><span class="nav-text">10.2. github.com&#x2F;gogf&#x2F;gf&#x2F;i18n&#x2F;gi18n 强大的gf框架中的语言库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E5%88%86%E7%A6%BB%E6%94%BE%E7%BD%AE"><span class="nav-text">1) 语言文件分离放置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E6%89%93%E5%8C%85%E5%88%B0%E4%BA%8C%E8%BF%9B%E5%88%B6"><span class="nav-text">2) 语言文件打包到二进制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-github-com-agiledragon-gomonkey-hook%E5%87%BD%E6%95%B0%E5%BE%88%E5%A5%BD%E7%9A%84%E4%B8%80%E4%B8%AA%E5%BA%93"><span class="nav-text">11. github.com&#x2F;agiledragon&#x2F;gomonkey hook函数很好的一个库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-%E4%BD%BF%E7%94%A8"><span class="nav-text">11.1 使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B8%A9%E5%9D%91"><span class="nav-text">踩坑</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9B%B4%E6%8E%A5go-test%E4%B8%8D%E7%94%9F%E6%95%88%EF%BC%8Cvscode%E8%B0%83%E8%AF%95%E5%8F%AF%E4%BB%A5"><span class="nav-text">1) 直接go test不生效，vscode调试可以</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-github-com-go-redis-redis-v7-redis%E6%93%8D%E4%BD%9C%E5%BA%93"><span class="nav-text">12. github.com&#x2F;go-redis&#x2F;redis&#x2F;v7 redis操作库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-text">12.1. 使用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5"><span class="nav-text">1) 测试连接</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%89%AB%E6%8F%8Fkey"><span class="nav-text">2) 扫描key</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="nav-text">3) 增删改</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-golang-org-x-sync-semaphore-%E4%BF%A1%E5%8F%B7%E9%87%8F"><span class="nav-text">13. golang.org&#x2F;x&#x2F;sync&#x2F;semaphore 信号量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%AE%9E%E6%88%98"><span class="nav-text">七、实战</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%90%AD%E5%BB%BA%E7%AE%80%E5%8D%95http%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-text">1. 搭建简单http服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%A8%A1%E6%9D%BF"><span class="nav-text">1.1. 模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2%E8%B7%AF%E5%BE%84%E8%BF%94%E5%9B%9E"><span class="nav-text">1.2. 静态页面路径返回</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="nav-text">1.3. 上传文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-302%E8%B7%B3%E8%BD%AC"><span class="nav-text">1.4. 302跳转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E4%BB%A3%E7%90%86%E8%BD%AC%E5%8F%91"><span class="nav-text">1.5. 代理转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E5%A4%84%E7%90%86post%E7%9A%84body%E6%95%B0%E6%8D%AE"><span class="nav-text">1.4. 处理post的body数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">八、算法和数据结构的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">1. 数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E9%98%9F%E5%88%97"><span class="nav-text">1.1. 队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E6%A0%88"><span class="nav-text">1.2. 栈</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-list-List%E5%AE%9E%E7%8E%B0"><span class="nav-text">1) list.List实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-slice%E5%AE%9E%E7%8E%B0"><span class="nav-text">2) slice实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E9%93%BE%E8%A1%A8"><span class="nav-text">1.3. 链表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-%E5%A4%A7%EF%BC%88%E5%B0%8F%EF%BC%89%E6%A0%B9%E5%A0%86"><span class="nav-text">1.4. 大（小）根堆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-%E4%BA%8C%E5%8F%89%E6%A0%91"><span class="nav-text">1.5. 二叉树</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%AE%97%E6%B3%95"><span class="nav-text">2. 算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%85%A8%E6%8E%92%E5%88%97"><span class="nav-text">2.1. 全排列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-bfs-%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95"><span class="nav-text">2.2. bfs 广度优先算法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E9%81%8D%E5%8E%86"><span class="nav-text">1) 二叉树的广度优先遍历</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%96%B9%E6%A0%BC%E4%B8%AD%E6%89%BE%E4%B8%A4%E7%82%B9%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84"><span class="nav-text">2) 方格中找两点最短路径</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%9D%E3%80%81go-work-%E5%A4%A7%E5%B7%A5%E7%A8%8B%E5%BC%80%E5%8F%91%E5%88%A9%E5%99%A8"><span class="nav-text">九、go.work 大工程开发利器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B8%A9%E5%9D%91%E8%AE%B0-1"><span class="nav-text">踩坑记</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%BC%96%E8%AF%91%E6%8A%A5%E9%94%99"><span class="nav-text">1. 编译报错</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-method-has-pointer-receiverd"><span class="nav-text">1.1. method has pointer receiverd</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%8D%8F%E7%A8%8B%E7%9B%B8%E5%85%B3"><span class="nav-text">2. 协程相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%BE%AA%E7%8E%AF%E8%B5%B7%E5%8D%8F%E7%A8%8B"><span class="nav-text">2.1. 循环起协程</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="王钰博" src="/images/12.jpg"><p class="site-author-name" itemprop="name">王钰博</p><div class="site-description" itemprop="description">个人博客</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">122</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">14</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/Githubwyb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Githubwyb" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:1061322005@qq.com" title="E-Mail → mailto:1061322005@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> 友情链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://githubwyb.github.io/bookPages/" title="https:&#x2F;&#x2F;githubwyb.github.io&#x2F;bookPages&#x2F;">markdown books</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="noopener" target="_blank">豫ICP备16023189号 </a><img src="/images/beian.png" style="display:inline-block"></div><div class="copyright">&copy; <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">王钰博</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="站点总字数">941k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">14:16</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动</div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e1986d4e4e2d132" async></script></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/medium-zoom.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script><script>document.querySelectorAll(".pdfobject-container").forEach(e=>{let t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&"),i=`/lib/pdf/web/viewer.html?file=${encodeURIComponent(t)}${a}`;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${i}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><script>"undefined"==typeof MathJax?(window.MathJax={loader:{source:{"[tex]/amsCd":"[tex]/amscd","[tex]/AMScd":"[tex]/amscd"}},tex:{inlineMath:{"[+]":[["$","$"]]},tags:"ams"},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const a=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],a),d=document.createTextNode("");t.parentNode.replaceChild(d,t),n.start={node:d,delim:"",n:0},n.end={node:d,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}},function(){var e=document.createElement("script");e.src="/lib/mathjax/tex-mml-chtml.js",e.defer=!0,document.head.appendChild(e)}()):(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset())</script><script>NexT.utils.loadComments(document.querySelector("#valine-comments"),()=>{NexT.utils.getScript("//unpkg.com/valine/dist/Valine.min.js",()=>{var e=["nick","mail","link"],a="nick,mail";a=a.split(",").filter(a=>e.includes(a)),new Valine({el:"#valine-comments",verify:!1,notify:!1,appId:"qmLbUHV1HOr841BOYkl84riu-gzGzoHsz",appKey:"j4fgTcf1yHRDD5X3HUH5EH95",placeholder:"^_^ happy everyday!",avatar:"wavatar",meta:a,pageSize:"10",visitor:!1,lang:"zh-cn",path:location.pathname,recordIP:!1,serverURLs:""})},window.Valine)})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":true,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"bottom":-30,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body><script type="text/javascript" src="/lib/jquery-3.4.1.min.js"></script><script type="text/javascript" src="/js/src/love.js"></script></html>